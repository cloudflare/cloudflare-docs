---
let range = (n: number) => [...Array(n).keys()];
---

<div class="ArchitectureDiagram not-content">
	<div class="ArchitectureDiagram--diagram">
		<div class="ArchitectureDiagram--content">
			{
				range(9).map(() => (
					<div class="ArchitectureDiagram--process-overhead">
						<div class="ArchitectureDiagram--user-code" />
						<div class="ArchitectureDiagram--process-overhead-background" />
					</div>
				))
			}
		</div>
		<div class="ArchitectureDiagram--caption">Traditional architecture</div>
	</div>
	<div class="ArchitectureDiagram--diagram">
		<div class="ArchitectureDiagram--content">
			{
				range(8).map(() => (
					<div class="ArchitectureDiagram--process-overhead">
						{range(9).map(() => (
							<div class="ArchitectureDiagram--user-code" />
						))}
						<div class="ArchitectureDiagram--process-overhead-background" />
					</div>
				))
			}
			<div class="ArchitectureDiagram--process-overhead">
				<div class="ArchitectureDiagram--user-code"></div>
				<div class="ArchitectureDiagram--process-overhead-background"></div>
			</div>
		</div>
		<div class="ArchitectureDiagram--caption">Workers V8 isolates</div>
	</div>
	<div class="ArchitectureDiagram--key">
		<div class="ArchitectureDiagram--key-content">
			<div class="ArchitectureDiagram--key-user-code">
				<div class="ArchitectureDiagram--user-code"></div>
				<div class="ArchitectureDiagram--key-label">User code</div>
			</div>
			<div class="ArchitectureDiagram--key-process-overhead">
				<div class="ArchitectureDiagram--process-overhead">
					<div class="ArchitectureDiagram--process-overhead-background"></div>
				</div>
				<div class="ArchitectureDiagram--key-label">Process overhead</div>
			</div>
		</div>
	</div>
</div>

<style>
	.ArchitectureDiagram {
		--user-code-size: 25px;
		--accent-color-rgb: var(--sl-color-text-accent);
		position: relative;
		display: flex;
		flex-wrap: wrap;
		justify-content: space-between;
		width: 100%;
		max-width: 100%;
	}

	@media (max-width: 1350px) {
		.ArchitectureDiagram {
			--user-code-size: 22px;
		}
	}

	@media (max-width: 1280px) {
		.ArchitectureDiagram {
			--user-code-size: 24px;
		}
	}

	@media (max-width: 1250px) {
		.ArchitectureDiagram {
			--user-code-size: 22px;
		}
	}

	@media (max-width: 1195px) {
		.ArchitectureDiagram {
			--user-code-size: 20px;
		}
	}

	@media (max-width: 1152px) {
		.ArchitectureDiagram {
			--user-code-size: 25px;
		}
	}

	@media (max-width: 1080px) {
		.ArchitectureDiagram {
			--user-code-size: 22px;
		}
	}

	@media (max-width: 986px) {
		.ArchitectureDiagram {
			--user-code-size: 20px;
		}
	}

	@media (max-width: 920px) {
		.ArchitectureDiagram {
			--user-code-size: 15px;
		}
	}

	@media (max-width: 820px) {
		.ArchitectureDiagram {
			--user-code-size: 12px;
		}
	}

	@media (max-width: 768px) {
		.ArchitectureDiagram {
			--user-code-size: 20px;
		}
	}

	@media (max-width: 576px) {
		.ArchitectureDiagram {
			--user-code-size: 18px;
		}
	}

	@media (max-width: 520px) {
		.ArchitectureDiagram {
			--user-code-size: 16px;
		}
	}

	.ArchitectureDiagram--diagram {
		--size: calc(var(--user-code-size) * 9);
		width: var(--size);
	}

	@media (max-width: 480px) {
		.ArchitectureDiagram {
			--user-code-size: 25px;
			justify-content: flex-start;
		}

		.ArchitectureDiagram--diagram {
			width: 100%;
		}

		.ArchitectureDiagram--diagram + .ArchitectureDiagram--diagram {
			margin-top: 2em;
		}

		.ArchitectureDiagram--key {
			position: absolute;
			top: 0;
			right: 0;
			bottom: 0;
		}

		.ArchitectureDiagram--key-content {
			position: -webkit-sticky;
			position: sticky;
			top: calc(var(--docs-header-height) + var(--user-code-size));
		}

		.ArchitectureDiagram--caption {
			width: var(--size);
		}
	}

	@media (max-width: 374px) {
		.ArchitectureDiagram--key {
			width: 5em;
		}
	}

	@media (max-width: 414px) {
		.ArchitectureDiagram {
			--user-code-size: 22px;
		}
	}

	@media (max-width: 375px) {
		.ArchitectureDiagram {
			--user-code-size: 20px;
		}
	}

	@media (max-width: 360px) {
		.ArchitectureDiagram {
			--user-code-size: 19px;
		}
	}

	@media (max-width: 340px) {
		.ArchitectureDiagram {
			--user-code-size: 18px;
		}
	}

	@media (max-width: 330px) {
		.ArchitectureDiagram {
			--user-code-size: 17px;
		}
	}

	@media (max-width: 319px) {
		.ArchitectureDiagram {
			display: none;
		}
	}

	.ArchitectureDiagram--content {
		position: relative;
		display: flex;
		flex-wrap: wrap;
		flex-shrink: 0;
		width: var(--size);
		height: var(--size);
	}

	.ArchitectureDiagram--caption {
		margin-top: 0.666em;
		max-width: 100%;
		line-height: 1.3;
	}

	.ArchitectureDiagram--process-overhead {
		--size: calc(var(--user-code-size) * 3);
		position: relative;
		display: flex;
		flex-wrap: wrap;
		flex-shrink: 0;
		width: var(--size);
		height: var(--size);
	}

	.ArchitectureDiagram--process-overhead:after {
		content: "\21BB";
		display: block;
		position: absolute;
		top: 0;
		right: 0;
		bottom: 0;
		left: 0;
		height: 1em;
		width: 1em;
		margin: auto;
		font-size: 2em;
		line-height: 1;
		text-align: center;
		color: rgb(var(--sl-color-text-accent));
	}

	.ArchitectureDiagram--process-overhead-background {
		position: absolute;
		top: 0;
		right: 0;
		bottom: 0;
		left: 0;
		background: color-mix(
			in srgb,
			var(--sl-color-accent-high) 25%,
			transparent
		);
	}

	.ArchitectureDiagram--user-code {
		position: relative;
		z-index: 1;
		width: var(--user-code-size);
		height: var(--user-code-size);
		background: color-mix(
			in srgb,
			var(--sl-color-accent-high) 90%,
			transparent
		);
	}

	.ArchitectureDiagram--process-overhead-background,
	.ArchitectureDiagram--user-code {
		--box-shadow: inset 0 0 0 1px var(--sl-color-bg);
		box-shadow: var(--box-shadow);
	}

	.ArchitectureDiagram--user-code:after {
		content: "{ }";
		display: block;
		font-size: calc(var(--user-code-size) * 0.5);
		line-height: calc(var(--user-code-size) * 0.93);
		font-weight: 700;
		height: 100%;
		width: 100%;
		text-align: center;
		color: color-mix(in srgb, var(--sl-color-bg) 70%, transparent);
	}

	.ArchitectureDiagram--key-user-code {
		margin-bottom: 1em;
	}

	.ArchitectureDiagram--key-label {
		opacity: 0.8;
		padding-top: 0.25em;
	}
</style>
