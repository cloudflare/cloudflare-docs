---
pcx_content_type: how-to
title: Microsoft Entra ID
---

import { Render } from "~/components";

You can integrate Microsoft Entra ID (formerly Azure Active Directory) with Cloudflare Zero Trust and build policies based on user identity and group membership. Users will authenticate to Zero Trust using their Entra ID credentials.

## Set up Entra ID as an identity provider

### 1. Obtain Entra ID settings

The following Entra ID values are required to set up the integration:

- Application (client) ID
- Directory (tenant) ID
- Client secret

To retrieve those values:

1. Log in to the [Azure dashboard](https://portal.azure.com/).

2. Go to **All services** > **Microsoft Entra ID**.

3. In the sidebar, go to **Manage** > **Enterprise applications**.

4. Select **New application**, then select **Create your own application**.

5. Name your application.

6. Select **Register an application to integrate with Microsoft Entra ID (App you're developing)** and then select **Create**.

7. Under **Redirect URI**, select the _Web_ platform and enter the following URL:

   ```txt
   https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/callback
   ```

   You can find your team name in Zero Trust under **Settings** > **Custom Pages**.

   ![Registering an application in Azure](~/assets/images/cloudflare-one/identity/azure/name-app.png)

8. Select **Register**.

9. Next, return to Microsoft Entra ID and go to go to **Manage** > **App registrations**.

10. Select the app you just created. Copy the **Application (client) ID** and **Directory (tenant) ID**.

    ![Viewing the Application ID and Directory ID in Azure](~/assets/images/cloudflare-one/identity/azure/azure-values.png)

11. Under **Client credentials**, go to **Add a certificate or secret**. Select **New client secret**.

12. Name the client secret and choose an expiration period.

13. After the client secret is created, copy its **Value** field. Store the client secret in a safe place, as it can only be viewed immediately after creation.

    ![Location of client secret in Azure](~/assets/images/cloudflare-one/identity/azure/client-cert-value.png)

### 2. Configure API permissions in Entra ID

1. From the **App registrations** page for your application, go to **API permissions**.

2. Select **Add a permission**.

3. Select **Microsoft Graph**.

4. Select **Delegated permissions** and enable the following [permissions](https://learn.microsoft.com/graph/permissions-reference):

   - `email`
   - `offline_access`
   - `openid`
   - `profile`
   - `User.Read`
   - `Directory.Read.All`
   - `GroupMember.Read.All`

:::note
More narrow permissions may be used, however this is the set of permissions that are tested and supported by Cloudflare.
:::

5. Once all seven permissions are enabled, select **Add permissions**.

6. Select **Grant admin consent**.

   ![Configured permissions list in Azure](~/assets/images/cloudflare-one/identity/azure/configured-perms.png)

### 3. Add Entra ID as an identity provider

1. In [Zero Trust](https://one.dash.cloudflare.com), go to **Settings** > **Authentication**.

2. Under **Login methods**, select **Add new**.

3. Select **Azure AD**.

4. Enter the **Application (client) ID**, **Client secret**, and **Directory (tenant) ID** obtained from Microsoft Entra ID.

5. (Optional) Configure the following settings:

   - **Proof Key for Code Exchange**: Perform [PKCE](https://www.oauth.com/oauth2-servers/pkce/) on all login attempts.
   - **Support Groups**: Allow Cloudflare to read a user's Entra ID group membership.
   - **Entra ID Policy Sync**: Refer to our [Entra ID Conditional Access tutorial](/cloudflare-one/tutorials/entra-id-conditional-access/).
   - **Enable SCIM**: Refer to [Synchronize users and groups](#synchronize-users-and-groups).
   - **Email claim**: Enter the Entra ID claim that you wish to use for user identification (for example, `preferred_username`).
   - **OIDC Claims**: Enter [custom OIDC claims](/cloudflare-one/identity/idp-integration/generic-oidc/#oidc-claims) that you wish to add to your users' identity. This information will be available in the [user identity endpoint](/cloudflare-one/identity/authorization-cookie/application-token/#user-identity).

6. Select **Save**.

To [test](/cloudflare-one/identity/idp-integration/#test-idps-in-zero-trust) that your connection is working, select **Test**.

## Synchronize users and groups

The Microsoft Entra ID integration allows you to synchronize IdP groups and automatically deprovision users using [SCIM](/cloudflare-one/identity/users/scim/).

### Prerequisites

- Microsoft Entra ID P1 or P2 license

### 1. Enable SCIM in Zero Trust

<Render
	file="access/enable-scim-on-dashboard"
	params={{ one: "Enable SCIM and Support groups" }}
/>

### 2. Configure SCIM in Entra ID

:::note
SCIM requires a separate enterprise application from the one created during [initial setup](#set-up-entra-id-as-an-identity-provider).
:::

1. In the Microsoft Entra ID menu, go to **Enterprise applications**.

2. Select **New application** > **Create your own application**.

3. Name your application (for example, `Cloudflare Access SCIM`).

4. Select **Integrate any other application you don't find in the gallery (Non-gallery)**.

5. Once the SCIM application is created, [assign users and groups to the application](https://learn.microsoft.com/entra/identity/enterprise-apps/assign-user-or-group-access-portal).

	:::note
	Groups in this SCIM application should match the groups in your other [Cloudflare Access enterprise application](/cloudflare-one/identity/idp-integration/entra-id/#set-up-entra-id-as-an-identity-provider). Because SCIM group membership updates will overwrite any groups in a user's identity, assigning the same groups to each app ensures consistent policy evaluation.
	:::

6. Go to **Provisioning** and select **Get started**.

7. For **Provisioning Mode**, choose _Automatic_.

8. In the **Tenant URL** field, enter the **SCIM Endpoint** obtained from Zero Trust.

9. In the **Secret Token** field, enter the **SCIM Secret** obtained from Zero Trust.

10. Select **Test Connection** to ensure that the credentials were entered correctly.

11. Select **Save**.

12. On the **Provisioning** page, select **Start provisioning**. You will see the synchronization status in Entra ID.

To check which users and groups were synchronized, select **View provisioning logs**.

### Provisioning attributes

Provisioning attributes define the user properties that Entra ID will synchronize with Cloudflare Access. To modify your provisioning attributes, go to the **Provisioning** page in Entra ID and select **Edit attribute mappings**.

We recommend enabling the following user attribute mappings:

| customappsso Attribute         | Entra ID Attribute | Recommendation |
| ------------------------------ | ------------------ | -------------- |
| `emails[type eq "work"].value` | `mail`             | Required       |
| `name.givenName`               | `givenName`        | Recommended    |
| `name.familyName`              | `surname`          | Recommended    |

## Entra groups in Zero Trust policies

### Automatic entry

When [SCIM synchronization is enabled](#synchronize-users-and-groups), your Entra group names will automatically appear in the Access and Gateway policy builders.

If building an Access policy, choose the _Azure Groups_ selector.
![Azure group names displayed in the Access policy builder](~/assets/images/cloudflare-one/identity/azure/azure-scim-groups.png)

If building a Gateway policy, choose the [_User Group Names_](/cloudflare-one/policies/gateway/identity-selectors/#user-group-names) selector.

### Manual entry

You can create Access and Gateway policies for groups that are not synchronized with SCIM. Entra ID exposes directory groups in a format that consists of random strings, the `Object Id`, that is distinct from the `Name`.

1. Make sure you enable **Support groups** as you set up Microsoft Entra ID in Zero Trust.

2. On your Azure dashboard, note the `Object Id` for the Entra group. In the example below, the group named Admins has an ID of `61503835-b6fe-4630-af88-de551dd59a2`.

   ![Viewing the Azure group ID on the Azure dashboard](~/assets/images/cloudflare-one/identity/azure/object-id.png)

3. If building an Access policy, choose the _Azure Groups_ selector. If building a Gateway policy, choose the _User Group IDs_ selector.

4. In the **Value** field, enter the `Object Id` for the Entra group.

   ![Entering an Azure group ID in Zero Trust](~/assets/images/cloudflare-one/identity/azure/configure-group-n.png)

### Nested groups

Access and Gateway policies for an Entra group will also apply to all [nested groups](https://learn.microsoft.com/entra/fundamentals/how-to-manage-groups#add-a-group-to-another-group). For example, if a user belongs to the group `US devs`, and `US devs` is part of the broader group `Devs`, the user would be allowed or blocked by all policies created for `Devs`.

## Force user interaction during WARP reauthentication

You can require users to re-enter their credentials into Entra ID whenever they [re-authenticate their WARP session](/cloudflare-one/connections/connect-devices/warp/configure-warp/warp-sessions/). To configure this setting, make a [`PUT` request](/api/operations/access-identity-providers-update-an-access-identity-provider) and set the `prompt` parameter to either `login` or `select_account`.

## Example API Configuration

```json
{
	"config": {
		"client_id": "<your client id>",
		"client_secret": "<your client secret>",
		"directory_id": "<your azure directory uuid>",
		"support_groups": true
	},
	"type": "azureAD",
	"name": "my example idp"
}
```
