---
title: Deploy a Worker
pcx_content_type: tutorial
products:
  - Workers
updated: 2024-01-08
difficulty: Beginner
languages:
  - JavaScript
  - TypeScript
  - Python
  - Go
  - Java
  - .NET
  - YAML
sidebar:
  order: 3
head:
  - tag: title
    content: Deploy a Worker
---

In this tutorial, you will go through step-by-step instructions to deploy a Hello World web application using Cloudflare Workers and Pulumi Infrastructure as Code (IaC) so that you can become familiar with the resource management lifecycle. In particular, you will create a Worker, a Route, and a DNS Record to access the application before cleaning up all the resources.

:::note

You will provision resources that qualify under free tier offerings for both Pulumi Cloud and Cloudflare.

:::

## Before you begin

Ensure you have:

- A Cloudflare account and API Token with permission to edit the resources in this tutorial. If you need to, sign up for a [Cloudflare account](https://dash.cloudflare.com/sign-up/workers-and-pages) before continuing.
- A Pulumi Cloud account. You can sign up for an [always-free, individual tier](https://app.pulumi.com/signup).
- The [Pulumi CLI](/pulumi/installing/) is installed on your machine.
- A [Pulumi-supported programming language](https://github.com/pulumi/pulumi?tab=readme-ov-file#languages) is configured. (TypeScript, JavaScript, Python, Go, .NET, Java, or use YAML)
- A domain name. You may use `example.com` to complete the tutorial.

## 1. Initialize Pulumi

### a. Create a directory

Use a new and empty directory for this tutorial.

```sh
mkdir serverless-cloudflare
cd serverless-cloudflare
```

### b. Login

At the prompt, press Enter to log into your Pulumi Cloud account via the browser. Alternatively, you may provide a [Pulumi Cloud access token](https://www.pulumi.com/docs/pulumi-cloud/access-management/access-tokens/).

```sh
pulumi login
```

### c. Create a program

:::note

A Pulumi program is code written in a [supported programming language](https://github.com/pulumi/pulumi?tab=readme-ov-file#languages) that defines infrastructure resources.
:::

To create a program, select your language of choice and run the `pulumi` command:


<Tabs> <TabItem label="JavaScript" icon="seti:javascript">

```sh
pulumi new javascript --name serverless-cloudflare --yes
# wait a few seconds while the project is initialized
```

</TabItem> <TabItem label="TypeScript" icon="seti:typescript">

```sh
pulumi new typescript --name serverless-cloudflare --yes
# wait a few seconds while the project is initialized
```

</TabItem> <TabItem label="Python" icon="seti:python">

```sh
pulumi new python --name serverless-cloudflare --yes
# wait a few seconds while the project is initialized
```

</TabItem> <TabItem label="go">

```sh
pulumi new go --name serverless-cloudflare --yes
# wait a few seconds while the project is initialized
```

</TabItem> <TabItem label="Java">

```sh
pulumi new java --name serverless-cloudflare --yes
# wait a few seconds while the project is initialized
```

</TabItem> <TabItem label=".NET">

```sh
pulumi new csharp --name serverless-cloudflare --yes
# wait a few seconds while the project is initialized
```

</TabItem> <TabItem label="YAML">

```sh
pulumi new yaml --name serverless-cloudflare --yes
```

</TabItem> </Tabs>

### d. Save your settings

You will need:

- Your Cloudflare [account ID](/fundamentals/setup/find-account-and-zone-ids/).
- A valid Cloudflare API [token](/fundamentals/api/get-started/create-token/).
- A domain. For instance, `example.com`.

:::note

A Pulumi [ESC Environment](https://www.pulumi.com/docs/esc/environments/) is a YAML file containing configurations and secrets that pertain to your application and infrastructure. These can be accessed in several ways, including a Pulumi program. All ESC Environments reside in your Pulumi Cloud account.
:::

todo todo todo todo todo todo!!

### e. Create a stack

:::note

A Pulumi [stack](https://www.pulumi.com/docs/concepts/stack/) is an instance of a Pulumi program. Stacks are independently configurable and may represent different environments (development, staging, production) or feature branches. For this tutorial, you'll use the `dev` stack.
:::

To instantiate your `dev` stack, run:

```sh
pulumi up --yes --stack dev
# wait a few seconds for the stack to be instantiated.
```

At this point, you have not defined any resources so you'll have an empty stack.

TODO next step here

## Add a Worker

You will now add the Pulumi Cloudflare package and a Cloudflare Worker to your Pulumi program.


### a. Install dependencies

<Tabs> <TabItem label="JavaScript" icon="seti:javascript">

```sh
npm install @pulumi/cloudflare
```

```sh output
added 1 package ...
```

</TabItem> <TabItem label="TypeScript" icon="seti:typescript">

```sh
npm install @pulumi/cloudflare
```

```sh output
added 1 package ...
```

</TabItem> <TabItem label="Python" icon="seti:python">

```sh
echo "pulumi_cloudflare>=5.35,<6.0.0" >> requirements.txt
source venv/bin/activate
pip install -r requirements.txt
```

```sh output
...
Collecting pulumi-cloudflare
...
```

</TabItem> <TabItem label="go">

```sh
go get github.com/pulumi/pulumi-cloudflare/sdk/v3/go/cloudflare
```

```sh output
go: downloading github.com/pulumi/pulumi-cloudflare ...
```

</TabItem> <TabItem label="Java">

Below are Apache Maven instructions. For other Java project managers such as Gradle, see the official [Maven repository](https://central.sonatype.com/artifact/com.pulumi/cloudflare/overview)

1. Open your `pom.xml` file.
2. Add the Pulumi Cloudflare dependency inside the `<dependencies>` section.

```xml
<dependency>
    <groupId>com.pulumi</groupId>
    <artifactId>cloudflare</artifactId>
    <version>5.35.1</version>
</dependency>
```

1. Run:

```sh
mvn clean install
```

```sh output
...
[INFO] BUILD SUCCESS
...
```

</TabItem> <TabItem label=".NET">

```sh
dotnet add package Pulumi.Cloudflare
```

```sh output
...
info : Adding PackageReference for package 'Pulumi.Cloudflare' into project
...
```

</TabItem> <TabItem label="YAML">

There are no dependencies to download for YAML. Skip ahead.

</TabItem> </Tabs>

### b. Modify the program

Replace the contents of your entrypoint file with the following:

<Tabs> <TabItem label="JavaScript" icon="seti:javascript">

```typescript
import * as pulumi from "@pulumi/pulumi";
import * as cloudflare from "@pulumi/cloudflare";
import * as fs from "fs";

const config = new pulumi.Config();
const accountId = config.require("accountId");

// A Worker script to invoke
export const script = new cloudflare.WorkerScript("hello-world-script", {
	accountId: accountId,
	name: "hello-world",
	// Read the content of the worker from a file
	content: fs.readFileSync("./app/worker.ts", "utf8"),
});
```
</TabItem>

TODO -- ADD OTHER LANGUAGES


### b. Apply the changes

```sh
pulumi up --yes --stack dev
```

## Add a Worker route

You will now add a Worker Route to the Pulumi stack, `dev` so the script can have an endpoint.

### a. Add Worker Route to index.ts

Replace the contents of your `index.ts` file with the following:

```typescript
import * as pulumi from "@pulumi/pulumi";
import * as cloudflare from "@pulumi/cloudflare";
import * as fs from "fs";

const config = new pulumi.Config();
const accountId = config.require("accountId");
const zoneId = config.require("zoneId");
const domain = config.require("domain");

// A Worker script to invoke
export const script = new cloudflare.WorkerScript("hello-world-script", {
	accountId: accountId,
	name: "hello-world",
	// Read the content of the worker from a file
	content: fs.readFileSync("./app/worker.ts", "utf8"),
});

// A Worker route to serve requests and the Worker script
export const route = new cloudflare.WorkerRoute("hello-world-route", {
	zoneId: zoneId,
	pattern: "hello-world." + domain,
	scriptName: script.name,
});
```


## Add a DNS record

You will now add a DNS record to your domain so the previously configured route can be accessed via a URL.


Replace the contents of your `index.ts` file with the following:

```typescript
import * as pulumi from "@pulumi/pulumi";
import * as cloudflare from "@pulumi/cloudflare";
import * as fs from "fs";

const config = new pulumi.Config();
const accountId = config.require("accountId");
const zoneId = config.require("zoneId");
const domain = config.require("domain");

// A Worker script to invoke
export const script = new cloudflare.WorkerScript("hello-world-script", {
	accountId: accountId,
	name: "hello-world",
	// Read the content of the worker from a file
	content: fs.readFileSync("./app/worker.ts", "utf8"),
});

// A Worker route to serve requests and the Worker script
export const route = new cloudflare.WorkerRoute("hello-world-route", {
	zoneId: zoneId,
	pattern: "hello-world." + domain,
	scriptName: script.name,
});

// A DNS record to access the route from the domain
export const record = new cloudflare.Record("hello-world-record", {
	zoneId: zoneId,
	name: script.name,
	value: "192.0.2.1",
	type: "A",
	proxied: true,
});

export const url = route.pattern;
```

:::note

The last line in the code will create an output with the endpoint for the Hello World app.

:::

### b. Apply the changes

```sh
pulumi up --yes
```

## Test the app

You have incrementally added all the Cloudflare resources needed to run and access your Hello World application. This was done by defining the resources in TypeScript and letting Pulumi handle the rest.

You can test your application via the terminal or browser.

- In the terminal

```sh
pulumi stack output url
```


```sh
curl "https://$(pulumi stack output url)"
```

```sh output
<!DOCTYPE html>
  <html>
    <head>
      <title>  Hello World </title>
    </head>
    <body>
      <h1>Serverless with Pulumi</h1>
      <p>The current time is: <span id="date">Thu Oct 05 2023 22:02:17 GMT+0000 (Coordinated Universal Time)</span>.</p>
    <script defer src="https://static.cloudflareinsights.com/beacon.min.js/v8b253dfea2ab4077af8c6f58422dfbfd1689876627854" integrity="sha512-bjgnUKX4azu3dLTVtie9u6TKqgx29RBwfj3QXYt5EKfWM/9hPSAI/4qcV5NACjwAo8UtTeWefx6Zq5PHcMm7Tg==" data-cf-beacon='{"rayId":"8118f2b5ddb5eb02","version":"2023.8.0","r":1,"b":1,"token":"240f365d9d42457597f861e6e46c6ce9","si":100}' crossorigin="anonymous"></script>
</body>
  </html>
```

:::note

Depending on your domain settings, you may need to use "http" instead.

:::

## Clean up

In this last step, you will run a couple of commands to clean up the resources and stack you used throughout the tutorial.

### a. Delete the Cloudflare resources

```sh
pulumi destroy
```

### b. Remove the Pulumi stack

```sh
pulumi stack rm dev
```

## Next steps

TODO