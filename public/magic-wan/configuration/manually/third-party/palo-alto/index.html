<!doctype html>
<html lang="en" theme="light" is-docs-page js-focus-visible-polyfill-available >
  <head>

  <meta charset="utf-8">
  <title>Palo Alto Networks Next-Generation Firewall · Cloudflare Magic WAN docs</title>
  <meta name="title" content="Palo Alto Networks Next-Generation Firewall · Cloudflare Magic WAN docs" />
  <meta name="image" content="https://developers.cloudflare.com/zt-preview.png" />

  <meta http-equiv="cleartype" content="on" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="application-name" content="Palo Alto Networks Next-Generation Firewall · Cloudflare Magic WAN docs" />
  <meta name="msapplication-tap-highlight" content="no" />
  <meta name="apple-mobile-web-app-title" content="Palo Alto Networks Next-Generation Firewall · Cloudflare Magic WAN docs" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="theme-color" content="#f38020" />

  <meta name="description" content="This tutorial includes the steps required to configure IPsec tunnels to connect a Palo Alto Networks Next-Generation Firewall (NGFW) to Cloudflare …" />

  <meta property="og:site_name" content="Cloudflare Docs" />
  <meta property="og:image" content="https://developers.cloudflare.com/zt-preview.png" />
  <meta property="og:title" content="Palo Alto Networks Next-Generation Firewall · Cloudflare Magic WAN docs" />
  <meta property="og:description" content="This tutorial includes the steps required to configure IPsec tunnels to connect a Palo Alto Networks Next-Generation Firewall (NGFW) to Cloudflare …" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://developers.cloudflare.com/magic-wan/configuration/manually/third-party/palo-alto/" />

  <meta name="twitter:title" content="Palo Alto Networks Next-Generation Firewall · Cloudflare Magic WAN docs" />
  <meta name="twitter:image" content="https://developers.cloudflare.com/zt-preview.png" />
  <meta name="twitter:description" content="This tutorial includes the steps required to configure IPsec tunnels to connect a Palo Alto Networks Next-Generation Firewall (NGFW) to Cloudflare …" />
  <meta name="twitter:card" content="summary_large_image" />

  <meta name="pcx_product" content="magic-wan"><meta name="algolia_product_filter" content="Magic WAN"><meta name="algolia_page_title" content="Palo Alto Networks Next-Generation Firewall">
  <meta name="pcx_word_count" content="4900"><meta name="pcx_last_modified" content="31"><meta name="pcx_last_reviewed" content="500" /><meta name="pcx_content_type" content="integration-guide" />
  <meta name="algolia_content_type" content="Integration Guide"><meta name="pcx_content_group" content="Cloudflare One" />
  
  
  <link rel="icon" href="/favicon-32x32.png" />
  <link rel="canonical" href="https://developers.cloudflare.com/magic-wan/configuration/manually/third-party/palo-alto/" />
  <link rel="sitemap" href="/sitemap.xml" type="application/xml" />
  <link rel="manifest" href="/manifest.webmanifest" />

  <link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png" />
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png" />
  <link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png" />
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png" />
  <link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png" />
  <link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png" />
  <link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png" />
  <link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png" /><script type="module" src="/search.js" defer></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3.5.1" />
  <script defer async src="https://cdn.jsdelivr.net/npm/@docsearch/js@3.5.1"></script>
  <script>window.algoliaConfig = {"apikey":"4edb0a6cef3338ff4bcfbc6b3d2db56b","index":"developers-cloudflare2","product":"magic-wan"}</script>
  <meta name="docsearch:product" content="magic-wan" /><link rel="stylesheet preconnect" href="/style.css" />
      <link rel="stylesheet preconnect" href="/codeBlock.css" /><link rel="preload" href="https://unpkg.com/littlefoot@4.0.0-11/dist/littlefoot.css" as="style">
    <link rel="preload" href="https://unpkg.com/littlefoot@4.0.0-11/dist/littlefoot.js" as="script" />
    <link rel="stylesheet" href="https://unpkg.com/littlefoot@4.0.0-11/dist/littlefoot.css" /><script>// <stdin>
(function() {
  let tooEarly = false;
  let btn;
  let media;
  if (document.readyState !== "loading") init();
  else addEventListener("DOMContentLoaded", init);
  btn = document.querySelector("#ThemeToggle");
  tooEarly = !btn;
  function setter(isDark) {
    try {
      let theme = isDark ? "dark" : "light";
      document.documentElement.setAttribute("theme", theme);
      document.documentElement.setAttribute("data-theme", theme);
      localStorage.theme = JSON.stringify({ theme });
      if (btn) {
        btn.checked = isDark;
        tooEarly = false;
      } else if (tooEarly) {
        setTimeout(setter, 1, isDark);
      }
    } catch (err) {
    }
    const themeToggleTooltip = document.querySelector("#ThemeToggle--tooltip");
    if (!themeToggleTooltip) return;
    if (isDark) {
      themeToggleTooltip.textContent = "Set theme to light (\u21E7+D)";
    } else {
      themeToggleTooltip.textContent = "Set theme to dark (\u21E7+D)";
    }
  }
  function init() {
    btn = btn || document.querySelector("#ThemeToggle");
    btn.addEventListener("change", () => setter(!!btn.checked));
    addEventListener("keydown", (ev) => {
      if (ev.target !== document.body || ev.repeat) return;
      if (ev.which === 68 && ev.shiftKey) {
        ev.preventDefault();
        setter(!btn.checked);
      }
    });
  }
  try {
    media = window.matchMedia("(prefers-color-scheme:dark)");
    media.onchange = (ev) => setter(ev.matches);
  } catch (err) {
  }
  try {
    let value = localStorage.theme;
    let row = value && JSON.parse(value);
    setter(row ? /dark/.test(row.theme) : !!(media && media.matches));
  } catch (err) {
  }
})();
</script><script type="module" src="/main.js" defer></script></head>
  <body><div class="DocsPage"><div>
    <a class="skip-link" href='#main'>Skip to content</a>
</div><div class="DocsMobileHeader">
  <a class="DocsMobileHeader--cloudflare-logo-link Link Link-without-underline" href="/">
    <div class="DocsNavLogoLockup DocsNavLogoLockup-with-small-gap">
      
<div class="DocsNavLogoLockup--logo">
  <svg viewBox="0 0 48 48" fill="currentColor" role="img" aria-labelledby="title - c8dca4d4ec651c8c4dc8c4feaf52fdbb" xmlns="http://www.w3.org/2000/svg">
    <title id="title - c8dca4d4ec651c8c4dc8c4feaf52fdbb">Cloudflare Docs logomark</title>
    <path d="M31.236 28.717c-.373-.548-1.003-.864-1.76-.9l-14.353-.195a.262.262 0 01-.221-.122.348.348 0 01-.035-.267.396.396 0 01.338-.268l14.48-.195c1.714-.085 3.58-1.533 4.232-3.309l.828-2.25a.503.503 0 00.023-.292c-.932-4.404-4.698-7.689-9.198-7.689-4.15 0-7.672 2.798-8.931 6.679a4.156 4.156 0 00-2.973-.864c-1.994.207-3.59 1.874-3.789 3.954a4.84 4.84 0 00.105 1.545c-3.253.097-5.853 2.871-5.853 6.29 0 .304.024.608.059.912.023.146.14.256.28.256h26.488c.151 0 .291-.11.338-.268l.198-.742c.245-.876.152-1.68-.256-2.275zM36.062 21.39c-.128 0-.268 0-.396.012-.093 0-.175.073-.21.17l-.56 2.032c-.244.876-.151 1.679.257 2.275.373.548 1.003.864 1.76.9l3.055.195c.093 0 .175.049.222.122a.356.356 0 01.035.267.396.396 0 01-.339.268l-3.182.195c-1.726.085-3.58 1.532-4.232 3.309l-.234.62c-.046.122.035.243.164.243h10.935a.289.289 0 00.28-.219 8.654 8.654 0 00.292-2.214c0-4.501-3.521-8.175-7.847-8.175"></path>
  </svg>
</div>
<span class="DocsNavLogoLockup--text">
  <span data-text="Cloudflare">Cloudflare </span>
  <span data-text="Docs">Docs</span>
</span>
    </div>
  </a>
</div>

<div class="DocsMobileTitleHeader">
  <a aria-current="page" class="DocsMobileTitleHeader--logo-link Link Link-without-underline" href="/magic-wan/">
    <div class="DocsNavLogoLockup DocsNavLogoLockup-with-small-gap">
      <div class="DocsNavLogoLockup--logo">
        <span title="Cloudflare Magic WAN logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path d="M43.5 22.5H31.567l11.003-4.575-1.148-2.775-11.047 4.56 8.453-8.46-2.123-2.123-8.415 8.423 4.575-10.988-2.775-1.155-4.59 11.04V4.5h-3v11.895L18 5.393 15.225 6.54l4.56 11.047-8.49-8.452-2.123 2.115 8.415 8.422L6.6 15.105l-1.155 2.767L16.5 22.5h-12v3h11.933L5.43 30l1.147 2.775 11.048-4.56-8.453 8.452 2.123 2.123 8.415-8.415-4.575 10.987 2.775 1.155L22.5 31.5v11.932h3V31.5L30 42.502l2.775-1.14-4.522-11.025 8.452 8.453 2.123-2.123-8.416-8.415L41.4 32.828l1.155-2.776L31.5 25.5h12v-3Zm-12 0v3l-1.14 2.76-2.107 2.107-2.753 1.088h-3l-2.753-1.14-2.107-2.108-1.14-2.76V22.5l1.14-2.76 2.107-2.107L22.5 16.5h3l2.753 1.14 2.107 2.107L31.5 22.5Z"/></svg></span>
      </div>

      <span class="DocsNavLogoLockup--text">
        <span class="DocsSidebar--docs-title-text-scaler" style="--length:9">Magic WAN</span>
      </span>
    </div>
  </a>

  <button class="Button DocsMobileTitleHeader--sidebar-toggle-button">
    <span class="DocsMobileTitleHeader--sidebar-toggle-button-icon" aria-hidden="true">
      <svg viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" role="img" aria-labelledby="title-1332672649688018"
        xmlns="http://www.w3.org/2000/svg">
        <title id="title-1332672649688018">Navigation menu icon</title>
        <path data-index="1" d="M5, 7h10" transform-origin="10  7"></path>
        <path data-index="2" d="M5,10h10" transform-origin="10 10"></path>
        <path data-index="3" d="M5,13h10" transform-origin="10 13"></path>
      </svg>
      <span is-visually-hidden="">Open external link</span>
    </span>
  </button>
</div>

<div class="DocsMobileNavBackdrop"></div><div class="DocsSidebar">
  <div class="DocsSidebar--sections">
    <div class="DocsSidebar--section DocsSidebar--header-section">
      <a class="DocsSidebar--cloudflare-logo-link DocsSidebar--link" href="/">
        <div class="DocsNavLogoLockup">
          
<div class="DocsNavLogoLockup--logo">
  <svg viewBox="0 0 48 48" fill="currentColor" role="img" aria-labelledby="title - edd654a852ebffcc8adccc4c14cdf4b8" xmlns="http://www.w3.org/2000/svg">
    <title id="title - edd654a852ebffcc8adccc4c14cdf4b8">Cloudflare Docs logomark</title>
    <path d="M31.236 28.717c-.373-.548-1.003-.864-1.76-.9l-14.353-.195a.262.262 0 01-.221-.122.348.348 0 01-.035-.267.396.396 0 01.338-.268l14.48-.195c1.714-.085 3.58-1.533 4.232-3.309l.828-2.25a.503.503 0 00.023-.292c-.932-4.404-4.698-7.689-9.198-7.689-4.15 0-7.672 2.798-8.931 6.679a4.156 4.156 0 00-2.973-.864c-1.994.207-3.59 1.874-3.789 3.954a4.84 4.84 0 00.105 1.545c-3.253.097-5.853 2.871-5.853 6.29 0 .304.024.608.059.912.023.146.14.256.28.256h26.488c.151 0 .291-.11.338-.268l.198-.742c.245-.876.152-1.68-.256-2.275zM36.062 21.39c-.128 0-.268 0-.396.012-.093 0-.175.073-.21.17l-.56 2.032c-.244.876-.151 1.679.257 2.275.373.548 1.003.864 1.76.9l3.055.195c.093 0 .175.049.222.122a.356.356 0 01.035.267.396.396 0 01-.339.268l-3.182.195c-1.726.085-3.58 1.532-4.232 3.309l-.234.62c-.046.122.035.243.164.243h10.935a.289.289 0 00.28-.219 8.654 8.654 0 00.292-2.214c0-4.501-3.521-8.175-7.847-8.175"></path>
  </svg>
</div>
<span class="DocsNavLogoLockup--text">
  <span data-text="Cloudflare">Cloudflare </span>
  <span data-text="Docs">Docs</span>
</span>
        </div>
      </a>
    </div>

    <div class="DocsSidebar--section-separator"></div>

    <div class="DocsSidebar--section DocsSidebar--docs-title-section">
      <a aria-current="page" class="DocsSidebar--docs-title-logo-link DocsSidebar--link" href="/magic-wan/">
        <div class="DocsNavLogoLockup">
          <div class="DocsNavLogoLockup--logo">
            <span title="Cloudflare Magic WAN logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path d="M43.5 22.5H31.567l11.003-4.575-1.148-2.775-11.047 4.56 8.453-8.46-2.123-2.123-8.415 8.423 4.575-10.988-2.775-1.155-4.59 11.04V4.5h-3v11.895L18 5.393 15.225 6.54l4.56 11.047-8.49-8.452-2.123 2.115 8.415 8.422L6.6 15.105l-1.155 2.767L16.5 22.5h-12v3h11.933L5.43 30l1.147 2.775 11.048-4.56-8.453 8.452 2.123 2.123 8.415-8.415-4.575 10.987 2.775 1.155L22.5 31.5v11.932h3V31.5L30 42.502l2.775-1.14-4.522-11.025 8.452 8.453 2.123-2.123-8.416-8.415L41.4 32.828l1.155-2.776L31.5 25.5h12v-3Zm-12 0v3l-1.14 2.76-2.107 2.107-2.753 1.088h-3l-2.753-1.14-2.107-2.108-1.14-2.76V22.5l1.14-2.76 2.107-2.107L22.5 16.5h3l2.753 1.14 2.107 2.107L31.5 22.5Z"/></svg></span>
          </div>

          <span class="DocsNavLogoLockup--text">
            <span class="DocsSidebar--docs-title-text-scaler" style="--length:9">Magic WAN</span>
          </span>
        </div>
      </a>

      <div class="DocsSidebar--section-more Dropdown" data-expanded="false">
        <button class="DocsSidebar--section-more-button Button" aria-expanded="false">
          <div class="DocsSidebar--section-more-button-icon">
            <svg viewBox="0 0 4 16" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" fill="currentColor" role="img" aria-labelledby="title-6032186738345315"
              xmlns="http://www.w3.org/2000/svg">
              <title id="title-6032186738345315">Dropdown icon</title>
              <path d="M2,2v0m0,6v0m0,6v0z"></path>
            </svg>
            <span is-visually-hidden>Magic WAN menu</span>
          </div>
        </button>

        <div class="DocsSidebar--section-more-dropdown Dropdown--dropdown">
          <ul class="Dropdown--list"><li class="Dropdown--item">
                <a class="Dropdown--link" href="https://www.cloudflare.com/magic-wan/" tabindex="-1">Magic WAN home</a>
              </li><li class="Dropdown--item">
                <a class="Dropdown--link" href="https://blog.cloudflare.com/magic-wan-firewall/" tabindex="-1">Blog: Magic WAN &amp; Magic Firewall</a>
              </li><li class="Dropdown--item">
                <a class="Dropdown--link" href="https://cloudflare.com" tabindex="-1">Cloudflare homepage</a>
              </li></ul>
        </div>
      </div>
    </div>

    <div class="DocsSidebar--section DocsSidebar--nav-section" style="position:relative;overflow:hidden;width:100%;height:100%">
      <div style="position: absolute; inset: 0px; overflow-y: auto; margin-right: 0px; margin-bottom: 0px;">
        <div class="DocsSidebar--nav-section-shadow" style="opacity: 0;"></div>

        <ul class="DocsSidebar--nav">
          <li class="DocsSidebar--nav-item">
            <a class="DocsSidebar--nav-link" href="/magic-wan/">
              <span class="DocsSidebar--nav-link-highlight"></span>
              <span class="DocsSidebar--nav-link-text">Overview</span>
            </a>
          </li>
          <li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/get-started/"  >
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Get started</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/on-ramps/"  >
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">On-ramps</span></a></li><li class="DocsSidebar--nav-item" is-active-root is-expanded><button class="Button DocsSidebar--nav-expand-collapse-button">
      <span class="DocsSidebar--nav-expand-collapse-button-content" aria-hidden="true"></span>
      <span is-visually-hidden>Expand: Configuration</span>
    </button><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/"  >
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Configuration</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-expanded" style="min-height:0px;transition-duration:400ms" is-expanded><div class="DocsSidebar--nav-item-collapse-wrapper">
          <div class="DocsSidebar--nav-item-collapse-wrapperInner">
            <div class="DocsSidebar--nav-item-collapse-content">
              <ul class="DocsSidebar--nav-subnav" depth="1" style="--depth:1"><li class="DocsSidebar--nav-item" is-active-root is-expanded><button class="Button DocsSidebar--nav-expand-collapse-button">
      <span class="DocsSidebar--nav-expand-collapse-button-content" aria-hidden="true"></span>
      <span is-visually-hidden>Expand: Manual configuration</span>
    </button><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/manually/"  >
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Manual configuration</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-expanded" style="min-height:0px;transition-duration:400ms" is-expanded><div class="DocsSidebar--nav-item-collapse-wrapper">
          <div class="DocsSidebar--nav-item-collapse-wrapperInner">
            <div class="DocsSidebar--nav-item-collapse-content">
              <ul class="DocsSidebar--nav-subnav" depth="2" style="--depth:2"><li class="DocsSidebar--nav-item"><button class="Button DocsSidebar--nav-expand-collapse-button">
      <span class="DocsSidebar--nav-expand-collapse-button-content" aria-hidden="true"></span>
      <span is-visually-hidden>Expand: How to</span>
    </button><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/manually/how-to/"  >
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">How to</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-hidden" style="min-height:0px;"><div class="DocsSidebar--nav-item-collapse-wrapper">
          <div class="DocsSidebar--nav-item-collapse-wrapperInner">
            <div class="DocsSidebar--nav-item-collapse-content">
              <ul class="DocsSidebar--nav-subnav" depth="3" style="--depth:3"><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/manually/how-to/configure-tunnels/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Configure tunnel endpoints</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/manually/how-to/configure-static-routes/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Configure static routes</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/manually/how-to/tunnel-health-checks/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Update tunnel health checks frequency</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/manually/how-to/traceroute/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Run traceroute</span></a></li></ul>
            </div>
          </div>
        </div>
      </div></li><li class="DocsSidebar--nav-item" is-active-root is-expanded><button class="Button DocsSidebar--nav-expand-collapse-button">
      <span class="DocsSidebar--nav-expand-collapse-button-content" aria-hidden="true"></span>
      <span is-visually-hidden>Expand: Third-party integration</span>
    </button><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/manually/third-party/"  >
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Third-party integration</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-expanded" style="min-height:0px;transition-duration:400ms" is-expanded><div class="DocsSidebar--nav-item-collapse-wrapper">
          <div class="DocsSidebar--nav-item-collapse-wrapperInner">
            <div class="DocsSidebar--nav-item-collapse-content">
              <ul class="DocsSidebar--nav-subnav" depth="3" style="--depth:3"><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/manually/third-party/alibaba-cloud/"  >
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Alibaba Cloud VPN Gateway</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/manually/third-party/aws/"  >
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Amazon AWS Transit Gateway</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/manually/third-party/aruba-edgeconnect/"  >
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Aruba EdgeConnect Enterprise</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/manually/third-party/cisco-ios-xe/"  >
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Cisco IOS XE</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/manually/third-party/viptela/"  >
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Cisco SD-WAN</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/manually/third-party/fortinet/"  >
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Fortinet</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/manually/third-party/fitelnet/"  >
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Furukawa Electric FITELnet</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/manually/third-party/google/"  >
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Google Cloud VPN</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/manually/third-party/azure/"  >
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Microsoft Azure</span></a></li><li class="DocsSidebar--nav-item" is-active><a aria-current="page" class="DocsSidebar--nav-link"  href="/magic-wan/configuration/manually/third-party/palo-alto/"   is-active>
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Palo Alto Networks NGFW</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/manually/third-party/pfsense/"  >
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">pfSense</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/manually/third-party/sonicwall/"  >
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">SonicWall</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/manually/third-party/sophos-firewall/"  >
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Sophos Firewall</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/manually/third-party/strongswan/"  >
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">strongSwan</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/manually/third-party/vyos/"  >
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">VyOS</span></a></li></ul>
            </div>
          </div>
        </div>
      </div></li></ul>
            </div>
          </div>
        </div>
      </div></li><li class="DocsSidebar--nav-item"><button class="Button DocsSidebar--nav-expand-collapse-button">
      <span class="DocsSidebar--nav-expand-collapse-button-content" aria-hidden="true"></span>
      <span is-visually-hidden>Expand: Configure with Connector</span>
    </button><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/connector/"  >
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Configure with Connector</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-hidden" style="min-height:0px;"><div class="DocsSidebar--nav-item-collapse-wrapper">
          <div class="DocsSidebar--nav-item-collapse-wrapperInner">
            <div class="DocsSidebar--nav-item-collapse-content">
              <ul class="DocsSidebar--nav-subnav" depth="2" style="--depth:2"><li class="DocsSidebar--nav-item"><button class="Button DocsSidebar--nav-expand-collapse-button" tabindex="-1">
      <span class="DocsSidebar--nav-expand-collapse-button-content" aria-hidden="true"></span>
      <span is-visually-hidden>Expand: Configure hardware Connector</span>
    </button><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/connector/configure-hardware-connector/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Configure hardware Connector</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-hidden" style="min-height:0px;"><div class="DocsSidebar--nav-item-collapse-wrapper">
          <div class="DocsSidebar--nav-item-collapse-wrapperInner">
            <div class="DocsSidebar--nav-item-collapse-content">
              <ul class="DocsSidebar--nav-subnav" depth="3" style="--depth:3"><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/connector/configure-hardware-connector/sfp-port-information/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">SFP&#43; port information</span></a></li></ul>
            </div>
          </div>
        </div>
      </div></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/connector/configure-virtual-connector/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Configure virtual Connector</span></a></li><li class="DocsSidebar--nav-item"><button class="Button DocsSidebar--nav-expand-collapse-button" tabindex="-1">
      <span class="DocsSidebar--nav-expand-collapse-button-content" aria-hidden="true"></span>
      <span is-visually-hidden>Expand: Network options</span>
    </button><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/connector/network-options/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Network options</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-hidden" style="min-height:0px;"><div class="DocsSidebar--nav-item-collapse-wrapper">
          <div class="DocsSidebar--nav-item-collapse-wrapperInner">
            <div class="DocsSidebar--nav-item-collapse-content">
              <ul class="DocsSidebar--nav-subnav" depth="3" style="--depth:3"><li class="DocsSidebar--nav-item"><button class="Button DocsSidebar--nav-expand-collapse-button" tabindex="-1">
      <span class="DocsSidebar--nav-expand-collapse-button-content" aria-hidden="true"></span>
      <span is-visually-hidden>Expand: Application-aware policies</span>
    </button><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/connector/network-options/application-based-policies/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Application-aware policies</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-hidden" style="min-height:0px;"><div class="DocsSidebar--nav-item-collapse-wrapper">
          <div class="DocsSidebar--nav-item-collapse-wrapperInner">
            <div class="DocsSidebar--nav-item-collapse-content">
              <ul class="DocsSidebar--nav-subnav" depth="4" style="--depth:4"><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/connector/network-options/application-based-policies/breakout-traffic/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Breakout traffic</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/connector/network-options/application-based-policies/prioritized-traffic/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Prioritized traffic</span></a></li></ul>
            </div>
          </div>
        </div>
      </div></li><li class="DocsSidebar--nav-item"><button class="Button DocsSidebar--nav-expand-collapse-button" tabindex="-1">
      <span class="DocsSidebar--nav-expand-collapse-button-content" aria-hidden="true"></span>
      <span is-visually-hidden>Expand: DHCP options</span>
    </button><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/connector/network-options/dhcp/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">DHCP options</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-hidden" style="min-height:0px;"><div class="DocsSidebar--nav-item-collapse-wrapper">
          <div class="DocsSidebar--nav-item-collapse-wrapperInner">
            <div class="DocsSidebar--nav-item-collapse-content">
              <ul class="DocsSidebar--nav-subnav" depth="4" style="--depth:4"><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/connector/network-options/dhcp/dhcp-relay/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">DHCP relay</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/connector/network-options/dhcp/dhcp-server/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">DHCP server</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/connector/network-options/dhcp/dhcp-static-address-reservation/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">DHCP static address reservation</span></a></li></ul>
            </div>
          </div>
        </div>
      </div></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/connector/network-options/nat-subnet/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Enable NAT for a subnet</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/connector/network-options/network-segmentation/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Network segmentation</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/connector/network-options/routed-subnets/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Routed subnets</span></a></li></ul>
            </div>
          </div>
        </div>
      </div></li><li class="DocsSidebar--nav-item"><button class="Button DocsSidebar--nav-expand-collapse-button" tabindex="-1">
      <span class="DocsSidebar--nav-expand-collapse-button-content" aria-hidden="true"></span>
      <span is-visually-hidden>Expand: Maintenance</span>
    </button><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/connector/maintenance/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Maintenance</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-hidden" style="min-height:0px;"><div class="DocsSidebar--nav-item-collapse-wrapper">
          <div class="DocsSidebar--nav-item-collapse-wrapperInner">
            <div class="DocsSidebar--nav-item-collapse-content">
              <ul class="DocsSidebar--nav-subnav" depth="3" style="--depth:3"><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/connector/maintenance/deactivate-connector/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Deactivate Magic WAN Connector</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/connector/maintenance/heartbeat/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Heartbeat</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/connector/maintenance/interrupt-service-window/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Interrupt window</span></a></li></ul>
            </div>
          </div>
        </div>
      </div></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/connector/device-metrics/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Device metrics</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/connector/reference/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Reference</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/connector/troubleshooting/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Troubleshooting</span></a></li></ul>
            </div>
          </div>
        </div>
      </div></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/magic-cloud-networking/"  >
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Configure cloud on-ramps (beta)</span></a></li><li class="DocsSidebar--nav-item"><button class="Button DocsSidebar--nav-expand-collapse-button">
      <span class="DocsSidebar--nav-expand-collapse-button-content" aria-hidden="true"></span>
      <span is-visually-hidden>Expand: Common settings</span>
    </button><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/common-settings/"  >
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Common settings</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-hidden" style="min-height:0px;"><div class="DocsSidebar--nav-item-collapse-wrapper">
          <div class="DocsSidebar--nav-item-collapse-wrapperInner">
            <div class="DocsSidebar--nav-item-collapse-content">
              <ul class="DocsSidebar--nav-subnav" depth="2" style="--depth:2"><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/common-settings/check-tunnel-health-dashboard/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Check tunnel health in the dashboard</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/common-settings/configure-magic-tunnel-alerts/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Configure Magic Tunnel health alerts</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/configuration/common-settings/enable-magic-roles/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Enable Magic user roles</span></a></li></ul>
            </div>
          </div>
        </div>
      </div></li></ul>
            </div>
          </div>
        </div>
      </div></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/security/"  >
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Security filters</span></a></li><li class="DocsSidebar--nav-item"><button class="Button DocsSidebar--nav-expand-collapse-button">
      <span class="DocsSidebar--nav-expand-collapse-button-content" aria-hidden="true"></span>
      <span is-visually-hidden>Expand: Zero Trust integration</span>
    </button><a class="DocsSidebar--nav-link"  href="/magic-wan/zero-trust/"  >
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Zero Trust integration</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-hidden" style="min-height:0px;"><div class="DocsSidebar--nav-item-collapse-wrapper">
          <div class="DocsSidebar--nav-item-collapse-wrapperInner">
            <div class="DocsSidebar--nav-item-collapse-content">
              <ul class="DocsSidebar--nav-subnav" depth="1" style="--depth:1"><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/zero-trust/cloudflare-gateway/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Cloudflare Gateway</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/zero-trust/cloudflare-tunnel/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Cloudflare Tunnel</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/zero-trust/warp/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">WARP</span></a></li></ul>
            </div>
          </div>
        </div>
      </div></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/network-interconnect/"  >
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Network Interconnect (CNI)</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/load-balancing/"  >
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Load Balancing</span></a></li><li class="DocsSidebar--nav-item"><button class="Button DocsSidebar--nav-expand-collapse-button">
      <span class="DocsSidebar--nav-expand-collapse-button-content" aria-hidden="true"></span>
      <span is-visually-hidden>Expand: Analytics</span>
    </button><a class="DocsSidebar--nav-link"  href="/magic-wan/analytics/"  >
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Analytics</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-hidden" style="min-height:0px;"><div class="DocsSidebar--nav-item-collapse-wrapper">
          <div class="DocsSidebar--nav-item-collapse-wrapperInner">
            <div class="DocsSidebar--nav-item-collapse-content">
              <ul class="DocsSidebar--nav-subnav" depth="1" style="--depth:1"><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/analytics/site-analytics/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Site Analytics</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/analytics/network-analytics/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Network Analytics</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/analytics/traceroutes/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Traceroutes</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-firewall/packet-captures/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Packet captures</span><span class="DocsMarkdown--link-external-icon" aria-hidden="true">
  <svg fill="none" stroke="currentColor" stroke-width="1.5" width="23px" height="12px" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg">
    <title id="title-4744738674102027">External link icon</title>
    <path d="M6.75,1.75h-5v12.5h12.5v-5m0,-4v-3.5h-3.5M8,8l5.5-5.5"></path>
  </svg>
  <span is-visually-hidden>Open external link</span>
</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/analytics/query-bandwidth/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Querying Magic WAN tunnel bandwidth analytics with GraphQL</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/analytics/query-tunnel-health/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Querying Magic WAN tunnel health check results with GraphQL</span></a></li></ul>
            </div>
          </div>
        </div>
      </div></li><li class="DocsSidebar--nav-item"><button class="Button DocsSidebar--nav-expand-collapse-button">
      <span class="DocsSidebar--nav-expand-collapse-button-content" aria-hidden="true"></span>
      <span is-visually-hidden>Expand: Reference</span>
    </button><a class="DocsSidebar--nav-link"  href="/magic-wan/reference/"  >
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Reference</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-hidden" style="min-height:0px;"><div class="DocsSidebar--nav-item-collapse-wrapper">
          <div class="DocsSidebar--nav-item-collapse-wrapperInner">
            <div class="DocsSidebar--nav-item-collapse-content">
              <ul class="DocsSidebar--nav-subnav" depth="1" style="--depth:1"><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/reference/anti-replay-protection/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Anti-replay protection</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/reference/bandwidth-measurement/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Bandwidth measurement</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/reference/device-compatibility/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Device compatibility</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/reference/tunnels/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">GRE and IPsec tunnels</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/reference/magic-tunnels/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Magic Tunnels background information</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/reference/traffic-steering/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Traffic steering</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/reference/tunnel-health-checks/"   tabindex="-1">
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Tunnel health checks</span></a></li></ul>
            </div>
          </div>
        </div>
      </div></li><li class="DocsSidebar--nav-item"><button class="Button DocsSidebar--nav-expand-collapse-button">
      <span class="DocsSidebar--nav-expand-collapse-button-content" aria-hidden="true"></span>
      <span is-visually-hidden>Expand: Legal</span>
    </button><a class="DocsSidebar--nav-link"  href="/magic-wan/legal/"  >
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Legal</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-hidden" style="min-height:0px;"><div class="DocsSidebar--nav-item-collapse-wrapper">
          <div class="DocsSidebar--nav-item-collapse-wrapperInner">
            <div class="DocsSidebar--nav-item-collapse-content">
              <ul class="DocsSidebar--nav-subnav" depth="1" style="--depth:1"></ul>
            </div>
          </div>
        </div>
      </div></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/changelog/"  >
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Changelog</span></a></li><li class="DocsSidebar--nav-item"><a class="DocsSidebar--nav-link"  href="/magic-wan/glossary/"  >
      <span class="DocsSidebar--nav-link-highlight"></span>
      <span class="DocsSidebar--nav-link-text">Glossary</span></a></li></ul>
      </div>
      <div style="position:absolute;height:6px;display:none;right:2px;bottom:2px;left:2px;border-radius:3px">
        <div style="position:relative;display:block;height:100%;cursor:pointer;border-radius:inherit;background-color:rgba(0,0,0,.2)"></div>
      </div>
      <div style="position:absolute;width:6px;display:none" class="Scrollbars--track Scrollbars--track-vertical">
        <div style="position:relative;display:block;width:100%" class="Scrollbars--thumb Scrollbars--thumb-vertical"></div>
      </div>
    </div>
  </div>
  <div class="DocsSidebar--shadow"></div>
</div><div class="DocsToolbar">

<div class="DocsToolbar--search">
  <div class="DocsSearch">
    <div id="algolia"></div>
  </div>
</div>
<div class="DocsToolbar--tools"><div class="Tooltip---root">
  <a class="DocsToolbar--feedback Button Button-is-docs-secondary" href="https://github.com/cloudflare/cloudflare-docs/blob/production/content/magic-wan/configuration/manually/third-party/palo-alto.md" target="_blank">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
      <path d="M22.742 47.456L23.757 46.912L52.175 18.573V15.743L42.254 5.823H39.428L11.012 34.16L10.461 35.193L8.03899 47.614L10.399 49.957L22.742 47.456ZM14.27 36.56L40.84 10.06L47.932 17.152L21.358 43.652L12.538 45.439L14.27 36.56Z" fill="currentColor"/>
      <path d="M56.002 54H7.99799V58H56.002V54Z" fill="currentColor"/>
      </svg>Edit
  </a>
  <span class="Tooltip" role="tooltip" position="bottom-end">
    Edit this page
  </span>
</div>
  <div class="DocsToolbar--tools-spacer"></div>
  <div class="Tooltip---root">
  <a class="DocsToolbar--feedback Button Button-is-docs-secondary" href="https://github.com/cloudflare/cloudflare-docs/issues/new/choose" target="_blank">
    <svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 17">
      <path d="M14 2.5H2l-.5.5v11.165l.863.345 2.852-3.01H14l.5-.5V3l-.5-.5Zm-.5 8H4.785L2.5 12.911V3.5h11v7Z"
        fill="currentColor"></path>
      <path d="M12.5 5.003h-9v1h9v-1ZM12.5 7.5h-9v1h9v-1Z" fill="currentColor"></path>
    </svg>Issue
  </a>
  <span class="Tooltip" role="tooltip" position="bottom-end">
    Report an issue with this page
  </span>
  </div>

  <div class="DocsToolbar--tools-spacer"></div>
  <div class="Tooltip---root">
  <a class="DocsToolbar--feedback Button Button-is-docs-primary" href="https://dash.cloudflare.com/login" target="_blank">
    <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 64 64">
      <path d="M36.85 34.76H27.17C21.5587 34.7653 16.1786 36.996 12.2099 40.9629C8.24121 44.9297 6.00794 50.3087 6 55.92L8 57.92H56L58 55.92C57.9921 50.3122 55.7615 44.9362 51.7972 40.9699C47.8328 37.0037 42.4578 34.7706 36.85 34.76ZM10.12 53.92C10.6165 49.7453 12.6256 45.8972 15.7674 43.1037C18.9092 40.3102 22.9659 38.7648 27.17 38.76H36.85C41.0455 38.777 45.09 40.3278 48.2213 43.1202C51.3526 45.9126 53.3546 49.7538 53.85 53.92H10.12Z" fill="currentColor"/>
      <path d="M32.05 32C34.8189 32 37.5257 31.1789 39.828 29.6406C42.1303 28.1022 43.9247 25.9157 44.9843 23.3576C46.0439 20.7994 46.3212 17.9845 45.781 15.2687C45.2408 12.553 43.9074 10.0584 41.9495 8.10051C39.9916 6.14258 37.497 4.80921 34.7813 4.26901C32.0655 3.72882 29.2506 4.00607 26.6924 5.06569C24.1343 6.12532 21.9478 7.91973 20.4094 10.222C18.8711 12.5243 18.05 15.2311 18.05 18C18.05 21.713 19.525 25.274 22.1505 27.8995C24.776 30.525 28.337 32 32.05 32ZM32.05 8.00001C34.0278 8.00001 35.9612 8.5865 37.6057 9.68531C39.2502 10.7841 40.5319 12.3459 41.2888 14.1732C42.0457 16.0004 42.2437 18.0111 41.8579 19.9509C41.472 21.8907 40.5196 23.6725 39.1211 25.0711C37.7225 26.4696 35.9407 27.422 34.0009 27.8079C32.0611 28.1937 30.0504 27.9957 28.2232 27.2388C26.3959 26.4819 24.8341 25.2002 23.7353 23.5557C22.6365 21.9112 22.05 19.9778 22.05 18C22.05 15.3478 23.1036 12.8043 24.9789 10.9289C26.8543 9.05357 29.3978 8.00001 32.05 8.00001Z"  fill="currentColor"/>
      </svg>Log&nbsp;in
  </a>
  <span class="Tooltip" role="tooltip" position="bottom-end">
    Log into the Cloudflare dashboard
  </span>
  </div>
  

  <div class="DocsToolbar--tools-spacer"></div>

  <div class="DocsToolbar--theme-toggle">
    <button id="MobileSearch" onclick='document.querySelector(".DocSearch.DocSearch-Button").click()'>
      <svg viewBox="0 0 16 16" fill="currentColor" role="img" aria-labelledby="title-9701125841014673"
        xmlns="http://www.w3.org/2000/svg">
        <title id="title-9701125841014673">Search icon (depiction of a magnifying glass)</title>
        <path
          d="M11.999 10.585l3.458 3.458a1 1 0 01-1.414 1.414L10.585 12a6.5 6.5 0 111.414-1.414zM6.75 11.5a4.75 4.75 0 100-9.5 4.75 4.75 0 000 9.5z">
        </path>
      </svg>
    </button><div class="Tooltip---root">
  <div class="ThemeToggle">
    <input type="checkbox" id="ThemeToggle" class="ThemeToggle--input">

    <label class="ThemeToggle--toggle" for="ThemeToggle">
      <div class="ThemeToggle--toggle-handle"></div>

      <div class="ThemeToggle--toggle-handle-icon ThemeToggle--sun">
        <svg viewBox="0 0 16 16" fill="currentColor" role="img" aria-labelledby="title-8812071124069258"
          xmlns="http://www.w3.org/2000/svg">
          <title id="title-8812071124069258">Light theme icon (depiction of a sun)</title>
          <path
            d="M7.5 11.465a3.482 3.482 0 01-1.596-.662L4.11 12.596a.5.5 0 01-.707-.707l1.793-1.793A3.482 3.482 0 014.535 8.5H2a.5.5 0 010-1h2.535a3.482 3.482 0 01.662-1.596L3.404 4.11a.5.5 0 01.707-.707l1.793 1.793A3.482 3.482 0 017.5 4.535V2a.5.5 0 011 0v2.535a3.482 3.482 0 011.596.662l1.793-1.793a.5.5 0 01.707.707l-1.793 1.793c.343.458.577 1.003.662 1.596H14a.5.5 0 110 1h-2.535a3.482 3.482 0 01-.662 1.596l1.793 1.793a.5.5 0 01-.707.707l-1.793-1.793a3.482 3.482 0 01-1.596.662V14a.5.5 0 11-1 0v-2.535z">
          </path>
        </svg>
      </div>

      <div class="ThemeToggle--toggle-handle-icon ThemeToggle--moon">
        <svg viewBox="0 0 16 16" fill="currentColor" role="img" aria-labelledby="title-5971296394189265"
          xmlns="http://www.w3.org/2000/svg">
          <title id="title-5971296394189265">Dark theme icon (depiction of a moon)</title>
          <path d="M7.067 3.087a5 5 0 005.466 7.026 5 5 0 11-5.466-7.026z"></path>
        </svg>
      </div>
    </label>

    <span class="Tooltip" id="ThemeToggle--tooltip" role="tooltip" position="bottom-end">Set theme to dark (⇧+D)</span>
  </div>
</div></div>
</div>
</div>

    <main class="DocsBody"><div class="DocsBody--sidebar" with-styled-webkit-scrollbars="">
  <div class="DocsBody--sidebar-content-scroll-fade"></div>
  <div class="DocsBody--sidebar-content">
      <ul class="DocsTableOfContents" hidden>
        <li><a class="DocsTableOfContents-link" href="#docs-content">↑ Top</a></li>
      </ul>
  </div>
</div>
<div id="docs-content" data-reach-skip-nav-content></div>
<ol class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
    <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
      <a href="/products/" class="DocsMarkdown--link" itemprop="item">
        <span itemprop="name" class="DocsMarkdown--link-content">Products</span></a>
      <meta itemprop="position" content="1" />
    </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/magic-wan/" itemprop="item" class="DocsMarkdown--link" >
            <span class="DocsMarkdown--link-content"  itemprop="name" >Magic WAN</span></a><meta itemprop="position" content="2" />
        </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/magic-wan/configuration/" itemprop="item" class="DocsMarkdown--link" aria-label="Configuration" title="Configuration">
            <span class="DocsMarkdown--link-content" >...</span></a><meta itemprop="name" content="Configuration" /><meta itemprop="position" content="3" />
        </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/magic-wan/configuration/manually/" itemprop="item" class="DocsMarkdown--link" aria-label="Manual configuration" title="Manual configuration">
            <span class="DocsMarkdown--link-content" >...</span></a><meta itemprop="name" content="Manual configuration" /><meta itemprop="position" content="4" />
        </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/magic-wan/configuration/manually/third-party/" itemprop="item" class="DocsMarkdown--link" >
            <span class="DocsMarkdown--link-content"  itemprop="name" >Third-party integration</span></a><meta itemprop="position" content="5" />
        </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/magic-wan/configuration/manually/third-party/palo-alto/" itemprop="item" class="DocsMarkdown--link" >
            <span class="DocsMarkdown--link-content"  itemprop="name" >Palo Alto Networks NGFW</span></a><meta itemprop="position" content="6" />
        </li></ol><div class="DocsContent" id="main" page-type="document">

        <article class="DocsMarkdown">
  <h1 id="palo-alto-networks-next-generation-firewall">Palo Alto Networks Next-Generation Firewall</h1><p>This tutorial includes the steps required to configure IPsec tunnels to connect a Palo Alto Networks Next-Generation Firewall (NGFW) to Cloudflare Magic WAN through a Layer 3 deployment.</p>
<h2 id="software-version-tested">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#software-version-tested">&#8203;​</a>
    </span>
    <span>Software version tested</span>
  </h2><ul>
<li>PAN-OS 9.1.14-h4</li>
</ul>
<h2 id="use-cases">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#use-cases">&#8203;​</a>
    </span>
    <span>Use Cases</span>
  </h2><ul>
<li><strong>Magic WAN</strong>: Connecting two or more locations with <a href="https://datatracker.ietf.org/doc/html/rfc1918" class="DocsMarkdown--link" target="_blank" rel="noopener">
  <span class="DocsMarkdown--link-content">RFC-1918</span><span class="DocsMarkdown--link-external-icon" aria-hidden="true">
  <svg fill="none" stroke="currentColor" stroke-width="1.5" width="23px" height="12px" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg">
    <title id="title-4744738674102027">External link icon</title>
    <path d="M6.75,1.75h-5v12.5h12.5v-5m0,-4v-3.5h-3.5M8,8l5.5-5.5"></path>
  </svg>
  <span is-visually-hidden>Open external link</span>
</span></a> private non-routable address space.</li>
<li><strong>Magic WAN with Cloudflare Zero Trust (Gateway egress)</strong>: Same as Magic WAN, with the addition of outbound Internet access from Magic WAN protected sites egressing the Cloudflare edge network.</li>
</ul>
<h2 id="prerequisites">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#prerequisites">&#8203;​</a>
    </span>
    <span>Prerequisites</span>
  </h2><p>This tutorial assumes you have a standalone NGFW with two network interfaces:</p>
<ul>
<li>One in a trust security zone (<code>Trust_L3_Zone</code>) with an <a href="https://datatracker.ietf.org/doc/html/rfc1918" class="DocsMarkdown--link" target="_blank" rel="noopener">
  <span class="DocsMarkdown--link-content">RFC-1918</span><span class="DocsMarkdown--link-external-icon" aria-hidden="true">
  <svg fill="none" stroke="currentColor" stroke-width="1.5" width="23px" height="12px" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg">
    <title id="title-4744738674102027">External link icon</title>
    <path d="M6.75,1.75h-5v12.5h12.5v-5m0,-4v-3.5h-3.5M8,8l5.5-5.5"></path>
  </svg>
  <span is-visually-hidden>Open external link</span>
</span></a> non-Internet routable IP address (internal network);</li>
<li>And the other in an untrust security zone (<code>Untrust_L3_Zone</code>) with a legally routable IP address (Internet facing).</li>
</ul>
<p>Additionally, there must be a default gateway set on the Virtual Router (default) pointing to the router of your Internet service provider(s).</p>
<h2 id="environment">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#environment">&#8203;​</a>
    </span>
    <span>Environment</span>
  </h2><p>The following IP addresses are used throughout this tutorial. Any legally routable IP addresses have been replaced with IPv4 Address Blocks Reserved for Documentation (<a href="https://datatracker.ietf.org/doc/html/rfc5737" class="DocsMarkdown--link" target="_blank" rel="noopener">
  <span class="DocsMarkdown--link-content">RFC5737</span><span class="DocsMarkdown--link-external-icon" aria-hidden="true">
  <svg fill="none" stroke="currentColor" stroke-width="1.5" width="23px" height="12px" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg">
    <title id="title-4744738674102027">External link icon</title>
    <path d="M6.75,1.75h-5v12.5h12.5v-5m0,-4v-3.5h-3.5M8,8l5.5-5.5"></path>
  </svg>
  <span is-visually-hidden>Open external link</span>
</span></a>) addresses within the <code>203.0.113.0/24</code> subnet.</p>
<table>
<thead>
<tr>
<th>Description</th>
<th>Address</th>
<th>Address</th>
</tr>
</thead>
<tbody>
<tr>
<td>NGFW external interface</td>
<td><code>203.0.113.254/24</code></td>
<td></td>
</tr>
<tr>
<td>NGFW internal interface</td>
<td><code>10.1.100.254/24</code></td>
<td></td>
</tr>
<tr>
<td>Local trust subnet (LAN)</td>
<td><code>10.1.100.0/24</code></td>
<td></td>
</tr>
<tr>
<td>NGFW tunnel interface 01</td>
<td><code>10.252.2.26/31</code> (Cloudflare side)</td>
<td><code>10.252.2.27/31</code> (NGFW side)</td>
</tr>
<tr>
<td>NGFW tunnel interface 02</td>
<td><code>10.252.2.28/31</code> (Cloudflare side)</td>
<td><code>10.252.2.29/31</code> (NGFW side)</td>
</tr>
<tr>
<td>Magic WAN anycast IP</td>
<td><code>162.159.66.164</code></td>
<td><code>172.64.242.164</code></td>
</tr>
<tr>
<td>Magic WAN health check anycast IP</td>
<td><code>172.64.240.253</code></td>
<td><code>172.64.240.254</code></td>
</tr>
<tr>
<td>VLAN0010 - remote Magic WAN site</td>
<td><code>10.1.10.0/24</code></td>
<td></td>
</tr>
<tr>
<td>VLAN0020 - remote Magic WAN site</td>
<td><code>10.1.20.0/24</code></td>
<td></td>
</tr>
</tbody>
</table>
<hr>
<h2 id="cloudflare-magic-wan">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#cloudflare-magic-wan">&#8203;​</a>
    </span>
    <span>Cloudflare Magic WAN</span>
  </h2><h3 id="magic-ipsec-tunnels">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#magic-ipsec-tunnels">&#8203;​</a>
    </span>
    <span>Magic IPsec Tunnels</span>
  </h3><p>Use the Cloudflare dashboard or API to <a href=/magic-wan/configuration/manually/how-to/configure-tunnels/#add-tunnels class="DocsMarkdown--link"><span class="DocsMarkdown--link-content">configure two IPsec Tunnels</span></a>. The settings mentioned in <a href=#add-ipsec-tunnels class="DocsMarkdown--link"><span class="DocsMarkdown--link-content">Add IPsec tunnels</span></a> below are used for the IPsec tunnels referenced throughout the remainder of this guide.</p>
<p>These are the target IP addresses for bidirectional tunnel health checks:</p>
<ul>
<li><code>172.64.240.253</code>: Use with the primary IPsec tunnel.</li>
<li><code>172.64.240.254</code>: Use with the secondary IPsec tunnel.</li>
</ul>
<aside class="DocsMarkdown--aside" role="note" data-type="warning"><p>You need to <a href=/magic-wan/configuration/manually/how-to/configure-tunnels/#add-tunnels class="DocsMarkdown--link"><span class="DocsMarkdown--link-content">configure bidirectional health checks</span></a> with Magic WAN. The settings must include custom target IP addresses for each tunnel. Additionally, Cloudflare recommends that you lower the rate at which health check probes are sent.</p>
</aside>

<h4 id="add-ipsec-tunnels">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#add-ipsec-tunnels">&#8203;​</a>
    </span>
    <span>Add IPsec tunnels</span>
  </h4><ol>
<li>
<p>Follow the <a href=/magic-wan/configuration/manually/how-to/configure-tunnels/ class="DocsMarkdown--link"><span class="DocsMarkdown--link-content">Add tunnels</span></a> instructions to create the required IPsec tunnels with the following options:</p>
<ul>
<li><strong>Tunnel name</strong>: <code>SFO_IPSEC_TUN01</code></li>
<li><strong>Interface address</strong>: <code>10.252.2.96/31</code></li>
<li><strong>Customer endpoint</strong>: <code>203.0.113.254</code></li>
<li><strong>Cloudflare endpoint</strong>: <code>162.159.66.164</code></li>
<li><strong>Health check rate</strong>: <em>Low</em> (default value is <em>Medium</em>)</li>
<li><strong>Health check type</strong>: <em>Reply</em></li>
<li><strong>Health check target</strong>: <em>Custom</em> (default is <em>Default</em>)</li>
<li><strong>Target address</strong>: <code>172.64.240.253</code></li>
</ul>
</li>
<li>
<p>Select <strong>Add pre-shared key later</strong> &gt; <strong>Add tunnels</strong>.</p>
</li>
<li>
<p>Repeat the process to create a second IPsec tunnel with the following options:</p>
<ul>
<li><strong>Tunnel name</strong>: <code>SFO_IPSEC_TUN02</code></li>
<li><strong>Interface address</strong>: <code>10.252.2.98/31</code></li>
<li><strong>Customer endpoint</strong>: <code>203.0.113.254</code></li>
<li><strong>Cloudflare endpoint</strong>: <code>172.64.242.164</code></li>
<li><strong>Health check rate</strong>: <em>Low</em> (default value is <em>Medium</em>)</li>
<li><strong>Health check type</strong>: <em>Reply</em></li>
<li><strong>Health check target</strong>: <em>Custom</em> (default is <em>Default</em>)</li>
<li><strong>Target address</strong>: <code>172.64.240.254</code></li>
</ul>
</li>
</ol>
<h4 id="generate-pre-shared-keys">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#generate-pre-shared-keys">&#8203;​</a>
    </span>
    <span>Generate Pre-shared keys</span>
  </h4><p>When you create IPsec tunnels with the option <strong>Add pre-shared key later</strong>, the Cloudflare dashboard will show you a warning indicator:</p>
<p><figure class="image-caption">
    <img alt="Magic IPsec Tunnels - No PSK" src="/images/magic-wan/third-party/palo-alto/cloudflare_dash_ipsec/03_magic_ipsec_tun_no_psk_hu40f24def344c433160ec2d9a5930e3f6_50242_831x216_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="216" width="831"
    style="aspect-ratio:3.8472685185185185;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<ol>
<li>Select <strong>Edit</strong> to edit the properties of each tunnel.</li>
<li>Select <strong>Generate a new pre-shared key</strong> &gt; <strong>Update and generate pre-shared key</strong>.
<figure class="image-caption">
    <img alt="Generatre a new pre-shared key for each of your IPsec tunnels" src="/images/magic-wan/third-party/palo-alto/cloudflare_dash_ipsec/04_magic_ipsec_tun_01_gen_psk_hufd4d9357800df8a73939b3d88c969462_201160_1058x841_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="841" width="1058"
    style="aspect-ratio:1.258038049940547;height: auto;"/>
    <figcaption></figcaption>
</figure></li>
<li>Copy the pre-shared key value for each of your IPsec tunnels, and save these values somewhere safe. Then, select <strong>Done</strong>.
<figure class="image-caption">
    <img alt="Take note of your pre-shared key, and keep it in a safe place" src="/images/magic-wan/third-party/palo-alto/cloudflare_dash_ipsec/05_magic_ipsec_tun_01_show_psk_huea604936ce55335d52cf5a44c5bec19e_35868_892x276_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="276" width="892"
    style="aspect-ratio:3.2319202898550725;height: auto;"/>
    <figcaption></figcaption>
</figure></li>
</ol>
<h4 id="ipsec-identifier---fqdn-fully-qualified-domain-name">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#ipsec-identifier---fqdn-fully-qualified-domain-name">&#8203;​</a>
    </span>
    <span>IPsec identifier - FQDN (Fully Qualified Domain Name)</span>
  </h4><p>After creating your IPsec tunnels, the Cloudflare dashboard will list them under the <strong>Tunnels</strong> tab. Select the arrow (<strong>&gt;</strong>) on each of your IPsec tunnel to collect the FQDN ID value from each of them. The FQDN ID value will be required when configuring IKE Phase 1 on the Palo Alto Networks Next-Generation Firewall.</p>
<p><figure class="image-caption">
    <img alt="Take note of the FQDN ID value for each of your IPsec tunnels" src="/images/magic-wan/third-party/palo-alto/cloudflare_dash_ipsec/08_magic_ipsec_tun_01_fqdn_hu81a78132f1218324a4bd047d050442f8_143190_706x733_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="733" width="706"
    style="aspect-ratio:0.9631787175989086;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<h3 id="magic-static-routes">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#magic-static-routes">&#8203;​</a>
    </span>
    <span>Magic Static Routes</span>
  </h3><p>If you refer to the <a href=#environment class="DocsMarkdown--link"><span class="DocsMarkdown--link-content">Environment section</span></a>, you will notice there is one subnet within <code>Trust_L3_Zone</code>: <code>10.1.100.0/24</code>.</p>
<p>Create a <a href=/magic-wan/configuration/manually/how-to/configure-static-routes/#create-a-static-route class="DocsMarkdown--link"><span class="DocsMarkdown--link-content">static route</span></a> for each of the two IPsec tunnels configured in the previous section, with the following settings (settings not mentioned here can be left with their default settings):</p>
<h4 id="tunnel-01">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#tunnel-01">&#8203;​</a>
    </span>
    <span>Tunnel 01</span>
  </h4><ul>
<li><strong>Description</strong>: <code>SFO_VLAN100_01</code></li>
<li><strong>Prefix</strong>: <code>10.1.100.0/24</code></li>
<li><strong>Tunnel/Next hop</strong>: <code>SFO_IPSEC_TUN01</code></li>
</ul>
<h4 id="tunnel-02">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#tunnel-02">&#8203;​</a>
    </span>
    <span>Tunnel 02</span>
  </h4><ul>
<li><strong>Description</strong>: <code>SFO_VLAN100_02</code></li>
<li><strong>Prefix</strong>: <code>10.1.100.0/24</code></li>
<li><strong>Tunnel/Next hop</strong>: <code>SFO_IPSEC_TUN02</code></li>
</ul>
<p><figure class="image-caption">
    <img alt="Add static routes for each of the IPsec tunnels you created in the previous step" src="/images/magic-wan/third-party/palo-alto/cloudflare_dash_ipsec/10_magic_ipsec_static_routes_hucdf31a25a94cecd754a3b9d117ada7de_126276_1058x736_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="736" width="1058"
    style="aspect-ratio:1.4375135869565216;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<h2 id="palo-alto-networks-next-generation-firewall-1">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#palo-alto-networks-next-generation-firewall-1">&#8203;​</a>
    </span>
    <span>Palo Alto Networks Next-Generation Firewall</span>
  </h2><h3 id="tags">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#tags">&#8203;​</a>
    </span>
    <span>Tags</span>
  </h3><p>While <a href="https://docs.paloaltonetworks.com/pan-os/9-1/pan-os-admin/policy/use-tags-to-group-and-visually-distinguish-objects/create-and-apply-tags" class="DocsMarkdown--link" target="_blank" rel="noopener">
  <span class="DocsMarkdown--link-content">Tags are optional</span><span class="DocsMarkdown--link-external-icon" aria-hidden="true">
  <svg fill="none" stroke="currentColor" stroke-width="1.5" width="23px" height="12px" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg">
    <title id="title-4744738674102027">External link icon</title>
    <path d="M6.75,1.75h-5v12.5h12.5v-5m0,-4v-3.5h-3.5M8,8l5.5-5.5"></path>
  </svg>
  <span is-visually-hidden>Open external link</span>
</span></a>, they can greatly improve object and policy visibility. The following color scheme was implemented in this configuration:</p>
<table>
<thead>
<tr>
<th>Tag</th>
<th>Color</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Trust_L3_Zone</code></td>
<td>Green</td>
</tr>
<tr>
<td><code>Untrust_L3_Zone</code></td>
<td>Red</td>
</tr>
<tr>
<td><code>Cloudflare_L3_Zone</code></td>
<td>Orange</td>
</tr>
</tbody>
</table>
<p>Use the Palo Alto Networks Next-Generation Firewall command-Line to set the tags:</p>
<div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="set&#43;tag&#43;Trust_L3_Zone&#43;color&#43;color2%0Aset&#43;tag&#43;Untrust_L3_Zone&#43;color&#43;color1%0Aset&#43;tag&#43;Cloudflare_L3_Zone&#43;color&#43;color6"></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h3 id="objects">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#objects">&#8203;​</a>
    </span>
    <span>Objects</span>
  </h3><p>The use of <strong>Address</strong> and <strong>Address Group</strong> objects wherever possible is strongly encouraged. These objects ensure that configuration elements that reference them are defined accurately and consistently.</p>
<p>Any configuration changes should be applied to the objects and will automatically be applied throughout the remainder of the configuration.</p>
<h4 id="address-objects">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#address-objects">&#8203;​</a>
    </span>
    <span>Address Objects</span>
  </h4><aside class="DocsMarkdown--aside" role="note" data-type="note"><p>Any objects without a netmask specified are <code>/32</code>.</p>
</aside>

<div class="DocsMarkdown--table-wrap"><div class="DocsMarkdown--table-wrap-inner">
    <table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Address</th>
<th>Tags</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CF_Health_Check_Anycast_01</code></td>
<td>IP Netmask</td>
<td><code>172.64.240.253</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>CF_Health_Check_Anycast_02</code></td>
<td>IP Netmask</td>
<td><code>172.64.240.254</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>CF_Magic_WAN_Anycast_01</code></td>
<td>IP Netmask</td>
<td><code>162.159.66.164</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>CF_Magic_WAN_Anycast_02</code></td>
<td>IP Netmask</td>
<td><code>172.64.242.164</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>CF_MWAN_IPsec_VTI_01_Local</code></td>
<td>IP Netmask</td>
<td><code>10.252.2.27/31</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>CF_MWAN_IPsec_VTI_01_Remote</code></td>
<td>IP Netmask</td>
<td><code>10.252.2.26</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>CF_MWAN_IPsec_VTI_02_Local</code></td>
<td>IP Netmask</td>
<td><code>10.252.2.29/31</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>CF_MWAN_IPsec_VTI_02_Remote</code></td>
<td>IP Netmask</td>
<td><code>10.252.2.28</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>CF_WARP_Client_Prefix</code></td>
<td>IP Netmask</td>
<td><code>100.96.0.0/12</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>Cloudflare_IPv4_01</code></td>
<td>IP Netmask</td>
<td><code>173.245.48.0/20</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>Cloudflare_IPv4_02</code></td>
<td>IP Netmask</td>
<td><code>103.21.244.0/22</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>Cloudflare_IPv4_03</code></td>
<td>IP Netmask</td>
<td><code>103.22.200.0/22</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>Cloudflare_IPv4_04</code></td>
<td>IP Netmask</td>
<td><code>103.31.4.0/22</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>Cloudflare_IPv4_05</code></td>
<td>IP Netmask</td>
<td><code>141.101.64.0/18</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>Cloudflare_IPv4_06</code></td>
<td>IP Netmask</td>
<td><code>108.162.192.0/18</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>Cloudflare_IPv4_07</code></td>
<td>IP Netmask</td>
<td><code>190.93.240.0/20</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>Cloudflare_IPv4_08</code></td>
<td>IP Netmask</td>
<td><code>188.114.96.0/20</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>Cloudflare_IPv4_09</code></td>
<td>IP Netmask</td>
<td><code>197.234.240.0/22</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>Cloudflare_IPv4_10</code></td>
<td>IP Netmask</td>
<td><code>198.41.128.0/17</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>Cloudflare_IPv4_11</code></td>
<td>IP Netmask</td>
<td><code>162.158.0.0/15</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>Cloudflare_IPv4_12</code></td>
<td>IP Netmask</td>
<td><code>104.16.0.0/13</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>Cloudflare_IPv4_13</code></td>
<td>IP Netmask</td>
<td><code>104.24.0.0/14</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>Cloudflare_IPv4_14</code></td>
<td>IP Netmask</td>
<td><code>172.64.0.0/13</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>Cloudflare_IPv4_15</code></td>
<td>IP Netmask</td>
<td><code>131.0.72.0/22</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>Internet_L3_203-0-113-254--24</code></td>
<td>IP Netmask</td>
<td><code>203.0.113.254/24</code></td>
<td><code>Untrust_L3_Zone</code></td>
</tr>
<tr>
<td><code>VLAN0010_10-1-10-0--24</code></td>
<td>IP Netmask</td>
<td><code>10.1.10.0/24</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>VLAN0020_10-1-20-0--24</code></td>
<td>IP Netmask</td>
<td><code>10.1.20.0/24</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>VLAN0100_10-1-100-0--24</code></td>
<td>IP Netmask</td>
<td><code>10.1.100.0/24</code></td>
<td><code>Trust_L3_Zone</code></td>
</tr>
<tr>
<td><code>VLAN0100_L3_10-1-100-254--24</code></td>
<td>IP Netmask</td>
<td><code>10.1.10.254/24</code></td>
<td><code>Trust_L3_Zone</code></td>
</tr>
</tbody>
</table>

  </div>
</div>
<p>Use the Palo Alto Networks Next-Generation Firewall command-Line to set the objects:</p>
<div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="set&#43;address&#43;CF_Health_Check_Anycast_01&#43;ip-netmask&#43;172.64.240.253%0Aset&#43;address&#43;CF_Health_Check_Anycast_01&#43;tag&#43;Cloudflare_L3_Zone%0Aset&#43;address&#43;CF_Health_Check_Anycast_02&#43;ip-netmask&#43;172.64.240.254%0Aset&#43;address&#43;CF_Health_Check_Anycast_02&#43;tag&#43;Cloudflare_L3_Zone%0Aset&#43;address&#43;CF_Magic_WAN_Anycast_01&#43;ip-netmask&#43;162.159.66.164%0Aset&#43;address&#43;CF_Magic_WAN_Anycast_01&#43;tag&#43;Cloudflare_L3_Zone%0Aset&#43;address&#43;CF_Magic_WAN_Anycast_02&#43;ip-netmask&#43;172.64.242.164%0Aset&#43;address&#43;CF_Magic_WAN_Anycast_02&#43;tag&#43;Cloudflare_L3_Zone%0Aset&#43;address&#43;CF_MWAN_IPsec_VTI_01_Local&#43;ip-netmask&#43;10.252.2.27%2F31%0Aset&#43;address&#43;CF_MWAN_IPsec_VTI_01_Local&#43;tag&#43;Cloudflare_L3_Zone%0Aset&#43;address&#43;CF_MWAN_IPsec_VTI_02_Local&#43;ip-netmask&#43;10.252.2.29%2F31%0Aset&#43;address&#43;CF_MWAN_IPsec_VTI_02_Local&#43;tag&#43;Cloudflare_L3_Zone%0Aset&#43;address&#43;CF_MWAN_IPsec_VTI_01_Remote&#43;ip-netmask&#43;10.252.2.26%0Aset&#43;address&#43;CF_MWAN_IPsec_VTI_01_Remote&#43;tag&#43;Cloudflare_L3_Zone%0Aset&#43;address&#43;CF_MWAN_IPsec_VTI_02_Remote&#43;ip-netmask&#43;10.252.2.28%0Aset&#43;address&#43;CF_MWAN_IPsec_VTI_02_Remote&#43;tag&#43;Cloudflare_L3_Zone%0Aset&#43;address&#43;CF_WARP_Client_Prefix&#43;ip-netmask&#43;100.96.0.0%2F12%0Aset&#43;address&#43;CF_WARP_Client_Prefix&#43;tag&#43;Cloudflare_L3_Zone%0Aset&#43;address&#43;Cloudflare_IPv4_01&#43;ip-netmask&#43;173.245.48.0%2F20%0Aset&#43;address&#43;Cloudflare_IPv4_01&#43;tag&#43;Cloudflare_L3_Zone%0Aset&#43;address&#43;Cloudflare_IPv4_02&#43;ip-netmask&#43;103.21.244.0%2F22%0Aset&#43;address&#43;Cloudflare_IPv4_02&#43;tag&#43;Cloudflare_L3_Zone%0Aset&#43;address&#43;Cloudflare_IPv4_03&#43;ip-netmask&#43;103.22.200.0%2F22%0Aset&#43;address&#43;Cloudflare_IPv4_03&#43;tag&#43;Cloudflare_L3_Zone%0Aset&#43;address&#43;Cloudflare_IPv4_04&#43;ip-netmask&#43;103.31.4.0%2F22%0Aset&#43;address&#43;Cloudflare_IPv4_04&#43;tag&#43;Cloudflare_L3_Zone%0Aset&#43;address&#43;Cloudflare_IPv4_05&#43;ip-netmask&#43;141.101.64.0%2F18%0Aset&#43;address&#43;Cloudflare_IPv4_05&#43;tag&#43;Cloudflare_L3_Zone%0Aset&#43;address&#43;Cloudflare_IPv4_06&#43;ip-netmask&#43;108.162.192.0%2F18%0Aset&#43;address&#43;Cloudflare_IPv4_06&#43;tag&#43;Cloudflare_L3_Zone%0Aset&#43;address&#43;Cloudflare_IPv4_07&#43;ip-netmask&#43;190.93.240.0%2F20%0Aset&#43;address&#43;Cloudflare_IPv4_07&#43;tag&#43;Cloudflare_L3_Zone%0Aset&#43;address&#43;Cloudflare_IPv4_08&#43;ip-netmask&#43;188.114.96.0%2F20%0Aset&#43;address&#43;Cloudflare_IPv4_08&#43;tag&#43;Cloudflare_L3_Zone%0Aset&#43;address&#43;Cloudflare_IPv4_09&#43;ip-netmask&#43;197.234.240.0%2F22%0Aset&#43;address&#43;Cloudflare_IPv4_09&#43;tag&#43;Cloudflare_L3_Zone%0Aset&#43;address&#43;Cloudflare_IPv4_10&#43;ip-netmask&#43;198.41.128.0%2F17%0Aset&#43;address&#43;Cloudflare_IPv4_10&#43;tag&#43;Cloudflare_L3_Zone%0Aset&#43;address&#43;Cloudflare_IPv4_11&#43;ip-netmask&#43;162.158.0.0%2F15%0Aset&#43;address&#43;Cloudflare_IPv4_11&#43;tag&#43;Cloudflare_L3_Zone%0Aset&#43;address&#43;Cloudflare_IPv4_12&#43;ip-netmask&#43;104.16.0.0%2F13%0Aset&#43;address&#43;Cloudflare_IPv4_12&#43;tag&#43;Cloudflare_L3_Zone%0Aset&#43;address&#43;Cloudflare_IPv4_13&#43;ip-netmask&#43;104.24.0.0%2F14%0Aset&#43;address&#43;Cloudflare_IPv4_13&#43;tag&#43;Cloudflare_L3_Zone%0Aset&#43;address&#43;Cloudflare_IPv4_14&#43;ip-netmask&#43;172.64.0.0%2F13%0Aset&#43;address&#43;Cloudflare_IPv4_14&#43;tag&#43;Cloudflare_L3_Zone%0Aset&#43;address&#43;Cloudflare_IPv4_15&#43;ip-netmask&#43;131.0.72.0%2F22%0Aset&#43;address&#43;Cloudflare_IPv4_15&#43;tag&#43;Cloudflare_L3_Zone%0Aset&#43;address&#43;Internet_L3_203-0-113-254--24&#43;ip-netmask&#43;203.0.113.254%2F24%0Aset&#43;address&#43;Internet_L3_203-0-113-254--24&#43;tag&#43;Untrust_L3_Zone%0Aset&#43;address&#43;VLAN0010_10-1-10-0--24&#43;ip-netmask&#43;10.1.10.0%2F24%0Aset&#43;address&#43;VLAN0010_10-1-10-0--24&#43;tag&#43;Trust_L3_Zone%0Aset&#43;address&#43;VLAN0020_10-1-20-0--24&#43;ip-netmask&#43;10.1.20.0%2F24%0Aset&#43;address&#43;VLAN0020_10-1-20-0--24&#43;tag&#43;Trust_L3_Zone%0Aset&#43;address&#43;VLAN0100_10-1-100-0--24&#43;ip-netmask&#43;10.1.100.0%2F24%0Aset&#43;address&#43;VLAN0100_10-1-100-0--24&#43;tag&#43;Trust_L3_Zone%0Aset&#43;address&#43;VLAN0100_L3_10-1-100-254--24&#43;ip-netmask&#43;10.1.100.254%2F24%0Aset&#43;address&#43;VLAN0100_L3_10-1-100-254--24&#43;tag&#43;Trust_L3_Zone"></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h4 id="address-group-object">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#address-group-object">&#8203;​</a>
    </span>
    <span>Address Group object</span>
  </h4><p>The <strong>Address Group</strong> object used in this configuration provides a single object representation of the entire Cloudflare IPv4 public address space.</p>
<div class="DocsMarkdown--table-wrap"><div class="DocsMarkdown--table-wrap-inner">
    <table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Addresses</th>
<th>Tags</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Cloudflare_IPv4_Static_Grp</code></td>
<td>Static</td>
<td><code>Cloudflare_IPv4_01</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>Cloudflare_IPv4_Static_Grp</code></td>
<td>Static</td>
<td><code>Cloudflare_IPv4_02</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>Cloudflare_IPv4_Static_Grp</code></td>
<td>Static</td>
<td><code>Cloudflare_IPv4_03</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>Cloudflare_IPv4_Static_Grp</code></td>
<td>Static</td>
<td><code>Cloudflare_IPv4_04</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>Cloudflare_IPv4_Static_Grp</code></td>
<td>Static</td>
<td><code>Cloudflare_IPv4_05</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>Cloudflare_IPv4_Static_Grp</code></td>
<td>Static</td>
<td><code>Cloudflare_IPv4_06</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>Cloudflare_IPv4_Static_Grp</code></td>
<td>Static</td>
<td><code>Cloudflare_IPv4_07</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>Cloudflare_IPv4_Static_Grp</code></td>
<td>Static</td>
<td><code>Cloudflare_IPv4_08</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>Cloudflare_IPv4_Static_Grp</code></td>
<td>Static</td>
<td><code>Cloudflare_IPv4_09</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>Cloudflare_IPv4_Static_Grp</code></td>
<td>Static</td>
<td><code>Cloudflare_IPv4_10</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>Cloudflare_IPv4_Static_Grp</code></td>
<td>Static</td>
<td><code>Cloudflare_IPv4_11</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>Cloudflare_IPv4_Static_Grp</code></td>
<td>Static</td>
<td><code>Cloudflare_IPv4_12</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>Cloudflare_IPv4_Static_Grp</code></td>
<td>Static</td>
<td><code>Cloudflare_IPv4_13</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>Cloudflare_IPv4_Static_Grp</code></td>
<td>Static</td>
<td><code>Cloudflare_IPv4_14</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
<tr>
<td><code>Cloudflare_IPv4_Static_Grp</code></td>
<td>Static</td>
<td><code>Cloudflare_IPv4_15</code></td>
<td><code>Cloudflare_L3_Zone</code></td>
</tr>
</tbody>
</table>

  </div>
</div>
<p>Use the Palo Alto Networks Next-Generation Firewall command-Line to set the address group object:</p>
<div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="set&#43;address-group&#43;Cloudflare_IPv4_Static_Grp&#43;static&#43;%5B&#43;Cloudflare_IPv4_01&#43;Cloudflare_IPv4_02&#43;Cloudflare_IPv4_03&#43;Cloudflare_IPv4_04&#43;Cloudflare_IPv4_05&#43;Cloudflare_IPv4_06&#43;Cloudflare_IPv4_07&#43;Cloudflare_IPv4_08&#43;Cloudflare_IPv4_09&#43;Cloudflare_IPv4_10&#43;Cloudflare_IPv4_11&#43;Cloudflare_IPv4_12&#43;Cloudflare_IPv4_13&#43;Cloudflare_IPv4_14&#43;Cloudflare_IPv4_15&#43;%5D%0Aset&#43;address-group&#43;Cloudflare_IPv4_Static_Grp&#43;tag&#43;Cloudflare_L3_Zone"></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><aside class="DocsMarkdown--aside" role="note" data-type="note"><p>While not covered by this tutorial, it is also possible to use External Dynamic Lists to automatically obtain the most current list of Cloudflare IPv4 addresses by periodically polling <a href="https://www.cloudflare.com/ips-v4" class="DocsMarkdown--link" target="_blank" rel="noopener">
  <span class="DocsMarkdown--link-content">https://www.cloudflare.com/ips-v4</span><span class="DocsMarkdown--link-external-icon" aria-hidden="true">
  <svg fill="none" stroke="currentColor" stroke-width="1.5" width="23px" height="12px" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg">
    <title id="title-4744738674102027">External link icon</title>
    <path d="M6.75,1.75h-5v12.5h12.5v-5m0,-4v-3.5h-3.5M8,8l5.5-5.5"></path>
  </svg>
  <span is-visually-hidden>Open external link</span>
</span></a>.</p>
</aside>

<h3 id="interface-mgmt---network-profiles">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#interface-mgmt---network-profiles">&#8203;​</a>
    </span>
    <span>Interface Mgmt - Network Profiles</span>
  </h3><p><strong>Interface Mgmt</strong> profiles control what traffic is allowed <em>to</em> the firewall, as opposed to <em>through</em> the firewall.</p>
<p>Adding an Interface Mgmt profile to the tunnel interfaces will provide the ability to ping the Virtual Tunnel Interface on your firewall(s).</p>
<h4 id="set-up-via-dashboard">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#set-up-via-dashboard">&#8203;​</a>
    </span>
    <span>Set up via dashboard</span>
  </h4><p>You can define an Interface Management Profile to allow ping from the dashboard:</p>
<ol>
<li>Go to <strong>Network Profiles</strong> &gt; <strong>Interface Mgmt</strong>.</li>
<li>In the <strong>Network</strong> tab select <strong>Add</strong>.</li>
<li>Create profiles to allow Ping, and in the <strong>Network Services</strong> group select <strong>Ping</strong>.</li>
</ol>
<p><figure class="image-caption">
    <img alt="Interface Mgmt Profile" src="/images/magic-wan/third-party/palo-alto/panw_interfaces/01_int_mgmt_prof_hu79097ade3b78c5d584b0748fa52efbd3_252258_1908x1246_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="1246" width="1908"
    style="aspect-ratio:1.5313081861958266;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<p><figure class="image-caption">
    <img alt="Interface Mgmt Profile" src="/images/magic-wan/third-party/palo-alto/panw_interfaces/02_int_mgmt_prof_hu79578c6db479ac46baabd7556bc8a87d_64420_1092x893_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="893" width="1092"
    style="aspect-ratio:1.2228555431131019;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<h4 id="set-up-via-command-line">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#set-up-via-command-line">&#8203;​</a>
    </span>
    <span>Set up via command line</span>
  </h4><p>You can also use the command line to allow ping:</p>
<div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="set&#43;network&#43;profiles&#43;interface-management-profile&#43;Allow_Ping&#43;userid-service&#43;no%0Aset&#43;network&#43;profiles&#43;interface-management-profile&#43;Allow_Ping&#43;ping&#43;yes"></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h3 id="network-interfaces">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#network-interfaces">&#8203;​</a>
    </span>
    <span>Network Interfaces</span>
  </h3><p>Palo Alto Networks Next-Generation Firewall (NGFW) is configured with two Ethernet interfaces:</p>
<table>
<thead>
<tr>
<th>Interface</th>
<th>Interface Type</th>
<th>IP Address</th>
<th>Virtual Router</th>
</tr>
</thead>
<tbody>
<tr>
<td>ethernet1/1</td>
<td>Layer3</td>
<td><code>10.1.100.254/24</code></td>
<td>default</td>
</tr>
<tr>
<td>ethernet1/2</td>
<td>Layer3</td>
<td><code>203.0.113.254/24</code></td>
<td>default</td>
</tr>
</tbody>
</table>
<h4 id="set-up-via-dashboard-1">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#set-up-via-dashboard-1">&#8203;​</a>
    </span>
    <span>Set up via dashboard</span>
  </h4><p>Follow the guidance on the images below to set up the Ethernet interfaces through the dashboard.</p>
<h5 id="ethernet11-trust_l3_zone">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#ethernet11-trust_l3_zone">&#8203;​</a>
    </span>
    <span>ethernet1/1: <code>Trust_L3_Zone</code></span>
  </h5><table>
<thead>
<tr>
<th>Name</th>
<th>Option</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ethernet1/1</strong></td>
<td>Interface Type</td>
<td><em>Layer3</em></td>
</tr>
<tr>
<td></td>
<td>Netflow Profile</td>
<td><em>None</em></td>
</tr>
<tr>
<td><strong>Config tab</strong></td>
<td>Virtual Router</td>
<td><em>default</em></td>
</tr>
<tr>
<td></td>
<td>Security Zone</td>
<td><em>Trust_L3_Zone</em></td>
</tr>
<tr>
<td><strong>IPv4 tab</strong></td>
<td>Type</td>
<td><strong>Static</strong></td>
</tr>
<tr>
<td></td>
<td>IP</td>
<td><code>VLAN0100_L3_10-1-100-254--24</code> <br> address object</td>
</tr>
<tr>
<td><strong>Advanced tab</strong></td>
<td>Management Profile</td>
<td><em>Mgmt_Services</em></td>
</tr>
</tbody>
</table>
<p><figure class="image-caption">
    <img alt="Set up ethernet1/1 on the dashboard" src="/images/magic-wan/third-party/palo-alto/panw_interfaces/Ethernet_Interfaces/01_ethernet-1-1_page1_hudf9c9c6015453ad37a1215f6b0d94f45_49546_1345x577_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="577" width="1345"
    style="aspect-ratio:2.3310398613518197;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="Set up ethernet1/1 on the dashboard" src="/images/magic-wan/third-party/palo-alto/panw_interfaces/Ethernet_Interfaces/02_ethernet-1-1_page2_hue73fb70ef3d3842c21ecfa306a9c9741_66538_1337x838_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="838" width="1337"
    style="aspect-ratio:1.5954773269689737;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="Set up ethernet1/1 on the dashboard" src="/images/magic-wan/third-party/palo-alto/panw_interfaces/Ethernet_Interfaces/03_ethernet-1-1_page3_hu8a5d1556253ca6efecdafdf593f7aeaf_82628_1332x910_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="910" width="1332"
    style="aspect-ratio:1.4637472527472528;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<h5 id="ethernet12-untrust_l3_zone">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#ethernet12-untrust_l3_zone">&#8203;​</a>
    </span>
    <span>ethernet1/2: <code>Untrust_L3_Zone</code></span>
  </h5><table>
<thead>
<tr>
<th>Name</th>
<th>Option</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ethernet1/2</strong></td>
<td>Interface Type</td>
<td><em>Layer3</em></td>
</tr>
<tr>
<td></td>
<td>Netflow Profile</td>
<td><em>None</em></td>
</tr>
<tr>
<td><strong>Config tab</strong></td>
<td>Virtual Router</td>
<td><em>default</em></td>
</tr>
<tr>
<td></td>
<td>Security Zone</td>
<td><em>Untrust_L3_Zone</em></td>
</tr>
<tr>
<td><strong>IPv4 tab</strong></td>
<td>Type</td>
<td><strong>Static</strong></td>
</tr>
<tr>
<td></td>
<td>IP</td>
<td><code>Internet_L3_203-0-113-254--24</code> <br> address object</td>
</tr>
<tr>
<td><strong>Advanced tab</strong></td>
<td>Management Profile</td>
<td><em>Allow_Ping</em></td>
</tr>
<tr>
<td></td>
<td>MTU</td>
<td><code>576 - 1500</code></td>
</tr>
<tr>
<td></td>
<td>Adjust TCP MSS</td>
<td><strong>Enable</strong></td>
</tr>
<tr>
<td></td>
<td>IPv4 MSS Adjustment</td>
<td><code>64</code></td>
</tr>
</tbody>
</table>
<p><figure class="image-caption">
    <img alt="Set up ethernet1/2 on the dashboard" src="/images/magic-wan/third-party/palo-alto/panw_interfaces/Ethernet_Interfaces/04_ethernet-1-2_page1_hu4786b5e96b7839c85affcfc44bfcfa89_49688_1337x576_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="576" width="1337"
    style="aspect-ratio:2.3211979166666667;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="Set up ethernet1/2 on the dashboard" src="/images/magic-wan/third-party/palo-alto/panw_interfaces/Ethernet_Interfaces/05_ethernet-1-2_page2_hu753832b4187a008faf74a8cd2d1d1239_66661_1340x833_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="833" width="1340"
    style="aspect-ratio:1.6086554621848739;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="Set up ethernet1/2 on the dashboard" src="/images/magic-wan/third-party/palo-alto/panw_interfaces/Ethernet_Interfaces/06_ethernet-1-2_page3_hu896e8fc873144cd2cad6c706485bcd0b_87621_1334x913_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="913" width="1334"
    style="aspect-ratio:1.4611281489594743;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<p>After setting up your Ethernet interfaces, they should show up on the overview page:</p>
<p><figure class="image-caption">
    <img alt="Ethernet Interfaces - Overview" src="/images/magic-wan/third-party/palo-alto/panw_interfaces/Ethernet_Interfaces/07_ethernet_interfaces_overview_hufabca7e2337d77d5319dcbc358bf7226_186527_1923x590_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="590" width="1923"
    style="aspect-ratio:3.2593389830508475;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<h4 id="set-up-via-command-line-1">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#set-up-via-command-line-1">&#8203;​</a>
    </span>
    <span>Set up via command line</span>
  </h4><p>You can also use the command line to set up the Ethernet interfaces.</p>
<div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="set&#43;network&#43;interface&#43;ethernet&#43;ethernet1%2F1&#43;layer3&#43;ndp-proxy&#43;enabled&#43;no%0Aset&#43;network&#43;interface&#43;ethernet&#43;ethernet1%2F1&#43;layer3&#43;lldp&#43;enable&#43;no%0Aset&#43;network&#43;interface&#43;ethernet&#43;ethernet1%2F1&#43;layer3&#43;ip&#43;VLAN0100_L3_10-1-100-254--24%0Aset&#43;network&#43;interface&#43;ethernet&#43;ethernet1%2F1&#43;layer3&#43;interface-management-profile&#43;Mgmt_Services%0Aset&#43;network&#43;interface&#43;ethernet&#43;ethernet1%2F2&#43;layer3&#43;ndp-proxy&#43;enabled&#43;no%0Aset&#43;network&#43;interface&#43;ethernet&#43;ethernet1%2F2&#43;layer3&#43;lldp&#43;enable&#43;no%0Aset&#43;network&#43;interface&#43;ethernet&#43;ethernet1%2F2&#43;layer3&#43;ip&#43;Internet_L3_203-0-113-254--24%0Aset&#43;network&#43;interface&#43;ethernet&#43;ethernet1%2F2&#43;layer3&#43;interface-management-profile&#43;Allow_Ping%0Aset&#43;network&#43;interface&#43;ethernet&#43;ethernet1%2F2&#43;layer3&#43;adjust-tcp-mss&#43;enable&#43;yes%0Aset&#43;network&#43;interface&#43;ethernet&#43;ethernet1%2F2&#43;layer3&#43;adjust-tcp-mss&#43;ipv4-mss-adjustment&#43;64"></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h3 id="tunnel-interfaces">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#tunnel-interfaces">&#8203;​</a>
    </span>
    <span>Tunnel interfaces</span>
  </h3><p>Establishing IPsec Tunnels to Cloudflare Magic WAN requires two tunnel interfaces - one to each of the two Cloudflare anycast IP addresses. You also have to ensure that <code>Allow_Ping</code> is bound to both tunnel adapters in <strong>Advanced</strong> &gt; <strong>Managementt Profile</strong>.</p>
<p>Review the images below for more information.</p>
<aside class="DocsMarkdown--aside" role="note" data-type="note"><p>MTU is set to <code>1450</code>. This value may need to be adjusted for optimal performance on your network.</p>
</aside>

<h4 id="set-up-via-dashboard-2">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#set-up-via-dashboard-2">&#8203;​</a>
    </span>
    <span>Set up via dashboard</span>
  </h4><h5 id="tunnel1---cloudflare_l3_zone">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#tunnel1---cloudflare_l3_zone">&#8203;​</a>
    </span>
    <span>tunnel.1 - <code>Cloudflare_L3_Zone</code></span>
  </h5><table>
<thead>
<tr>
<th>Name</th>
<th>Option</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>tunnel.1</strong></td>
<td>Netflow Profile</td>
<td><em>None</em></td>
</tr>
<tr>
<td><strong>Config tab</strong></td>
<td>Virtual Router</td>
<td><em>default</em></td>
</tr>
<tr>
<td></td>
<td>Security Zone</td>
<td><em>Cloudflare_L3_Zone</em></td>
</tr>
<tr>
<td><strong>IPv4 tab</strong></td>
<td>IP</td>
<td><code>CF_MWAN_IPsec_VTI_01_Local</code> <br> address object</td>
</tr>
<tr>
<td><strong>Advanced tab</strong></td>
<td>Management Profile</td>
<td><em>Allow_Ping</em></td>
</tr>
<tr>
<td></td>
<td>MTU</td>
<td><code>1450</code></td>
</tr>
</tbody>
</table>
<p><figure class="image-caption">
    <img alt="Set up tunnel 1" src="/images/magic-wan/third-party/palo-alto/panw_interfaces/Tunnel_Interfaces/01_tunnel_1_page1_hufd45b855f88525fcbcd8112d1dbef14e_42959_1270x531_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="531" width="1270"
    style="aspect-ratio:2.3917325800376648;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="Set up tunnel 1" src="/images/magic-wan/third-party/palo-alto/panw_interfaces/Tunnel_Interfaces/02_tunnel_1_page2_hu8e3452e565887101f8ee36307f8bd872_45098_1274x672_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="672" width="1274"
    style="aspect-ratio:1.8958482142857143;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="Set up tunnel 1" src="/images/magic-wan/third-party/palo-alto/panw_interfaces/Tunnel_Interfaces/03_tunnel_1_page3_hu3df3eaf1862fb148dd2430345a7fbe64_39527_1269x538_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="538" width="1269"
    style="aspect-ratio:2.358754646840149;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<h5 id="tunnel2---cloudflare_l3_zone">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#tunnel2---cloudflare_l3_zone">&#8203;​</a>
    </span>
    <span>tunnel.2 - <code>Cloudflare_L3_Zone</code></span>
  </h5><table>
<thead>
<tr>
<th>Name</th>
<th>Option</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>tunnel.2</strong></td>
<td>Netflow Profile</td>
<td><em>None</em></td>
</tr>
<tr>
<td><strong>Config tab</strong></td>
<td>Virtual Router</td>
<td><em>default</em></td>
</tr>
<tr>
<td></td>
<td>Security Zone</td>
<td><em>Cloudflare_L3_Zone</em></td>
</tr>
<tr>
<td><strong>IPv4 tab</strong></td>
<td>IP</td>
<td><code>CF_MWAN_IPsec_VTI_02_Local</code> <br> address object</td>
</tr>
<tr>
<td><strong>Advanced tab</strong></td>
<td>Management Profile</td>
<td><em>Allow_Ping</em></td>
</tr>
<tr>
<td></td>
<td>MTU</td>
<td><code>1450</code></td>
</tr>
</tbody>
</table>
<p><figure class="image-caption">
    <img alt="Set up tunnel 2" src="/images/magic-wan/third-party/palo-alto/panw_interfaces/Tunnel_Interfaces/04_tunnel_2_page1_huade43e046a6707b9c04b99ad50bae1f0_43142_1267x534_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="534" width="1267"
    style="aspect-ratio:2.3726779026217226;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="Set up tunnel 2" src="/images/magic-wan/third-party/palo-alto/panw_interfaces/Tunnel_Interfaces/05_tunnel_2_page2_hu68690459bffe9677f43c37bb6a11943c_45422_1269x667_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="667" width="1269"
    style="aspect-ratio:1.9025637181409296;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="Set up tunnel 2" src="/images/magic-wan/third-party/palo-alto/panw_interfaces/Tunnel_Interfaces/06_tunnel_2_page3_huac5f93fa2cf55a188ea6fd81552a23d7_38733_1270x533_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="533" width="1270"
    style="aspect-ratio:2.3827579737335833;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<p>After setting up your Tunnel interfaces, they should show up on the overview page:</p>
<p><figure class="image-caption">
    <img alt="Tunnel Interfaces - Overview" src="/images/magic-wan/third-party/palo-alto/panw_interfaces/Tunnel_Interfaces/07_tunnel_interfaces_overview_hu0079874823dd2a028bff2e69d9c1fb31_160183_1911x614_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="614" width="1911"
    style="aspect-ratio:3.1123941368078176;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<h4 id="set-up-via-command-line-2">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#set-up-via-command-line-2">&#8203;​</a>
    </span>
    <span>Set up via command line</span>
  </h4><p>You can also set up your tunnels in the command line:</p>
<div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="set&#43;network&#43;interface&#43;tunnel&#43;units&#43;tunnel.1&#43;ip&#43;CF_MWAN_IPsec_VTI_01_Local%0Aset&#43;network&#43;interface&#43;tunnel&#43;units&#43;tunnel.1&#43;mtu&#43;1450%0Aset&#43;network&#43;interface&#43;tunnel&#43;units&#43;tunnel.1&#43;interface-management-profile&#43;Allow_Ping%0Aset&#43;network&#43;interface&#43;tunnel&#43;units&#43;tunnel.2&#43;ip&#43;CF_MWAN_IPsec_VTI_02_Local%0Aset&#43;network&#43;interface&#43;tunnel&#43;units&#43;tunnel.2&#43;mtu&#43;1450%0Aset&#43;network&#43;interface&#43;tunnel&#43;units&#43;tunnel.2&#43;interface-management-profile&#43;Allow_Ping"></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h3 id="zones">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#zones">&#8203;​</a>
    </span>
    <span>Zones</span>
  </h3><p>The Palo Alto Networks Next-Generation Firewall (NGFW) used to create this tutorial includes the following zones and corresponding network interfaces:</p>
<table>
<thead>
<tr>
<th>Zone</th>
<th>Interface</th>
<th>Interface</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Trust_L3_Zone</code></td>
<td>ethernet1/1</td>
<td></td>
</tr>
<tr>
<td><code>Untrust_L3_Zone</code></td>
<td>ethernet1/2</td>
<td></td>
</tr>
<tr>
<td><code>Cloudflare_L3_Zone</code></td>
<td>tunnel.1</td>
<td>tunnel.2</td>
</tr>
</tbody>
</table>
<p>The tunnel interfaces are placed in a separate zone to facilitate the configuration of more granular security policies. The use of any other zone for the tunnel interfaces will require adapting the configuration accordingly.</p>
<aside class="DocsMarkdown--aside" role="note" data-type="note"><p>Any Magic WAN protected networks that are not local should be considered part of the <code>Cloudflare_L3_Zone</code>.</p>
</aside>

<h4 id="set-up-via-dashboard-3">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#set-up-via-dashboard-3">&#8203;​</a>
    </span>
    <span>Set up via dashboard</span>
  </h4><h5 id="trust_l3_zone">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#trust_l3_zone">&#8203;​</a>
    </span>
    <span><code>Trust_L3_zone</code></span>
  </h5><table>
<thead>
<tr>
<th>Name</th>
<th>Option</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Trust_L3_zone</code></td>
<td>Log setting</td>
<td><em>None</em></td>
</tr>
<tr>
<td></td>
<td>Type</td>
<td><em>Layer3</em></td>
</tr>
<tr>
<td></td>
<td>Interfaces</td>
<td><strong>ethernet1/1</strong></td>
</tr>
<tr>
<td></td>
<td>Zone Protection Profile</td>
<td><em>None</em></td>
</tr>
</tbody>
</table>
<p><figure class="image-caption">
    <img alt="The Palo Alto interface showing the Trust_L3_Zone" src="/images/magic-wan/third-party/palo-alto/panw_zones/01_trust_zone_hu2eb0efea3cc598570f98c5249965fbf2_97573_1261x929_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="929" width="1261"
    style="aspect-ratio:1.357384284176534;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<h5 id="untrust_l3_zone">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#untrust_l3_zone">&#8203;​</a>
    </span>
    <span><code>Untrust_L3_zone</code></span>
  </h5><table>
<thead>
<tr>
<th>Name</th>
<th>Option</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Untrust_L3_zone</code></td>
<td>Log setting</td>
<td><em>None</em></td>
</tr>
<tr>
<td></td>
<td>Type</td>
<td><em>Layer3</em></td>
</tr>
<tr>
<td></td>
<td>Interfaces</td>
<td><strong>ethernet1/2</strong></td>
</tr>
<tr>
<td></td>
<td>Zone Protection Profile</td>
<td><em>Untrust_Zone_Prof</em></td>
</tr>
</tbody>
</table>
<p><figure class="image-caption">
    <img alt="The Palo Alto interface showing the Untrust_L3_Zone" src="/images/magic-wan/third-party/palo-alto/panw_zones/02_untrust_zone_hu6dcbdb3492ff958587fb64843a882e32_99441_1265x935_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="935" width="1265"
    style="aspect-ratio:1.352951871657754;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<h5 id="cloudflare_l3_zone">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#cloudflare_l3_zone">&#8203;​</a>
    </span>
    <span><code>Cloudflare_L3_zone</code></span>
  </h5><table>
<thead>
<tr>
<th>Name</th>
<th>Option</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Cloudflare_L3_zone</code></td>
<td>Log setting</td>
<td><em>None</em></td>
</tr>
<tr>
<td></td>
<td>Type</td>
<td><em>Layer3</em></td>
</tr>
<tr>
<td></td>
<td>Interfaces</td>
<td><strong>tunnel.1</strong> <br> <strong>tunnel.2</strong></td>
</tr>
<tr>
<td></td>
<td>Zone Protection Profile</td>
<td><em>None</em></td>
</tr>
</tbody>
</table>
<p><figure class="image-caption">
    <img alt="The Palo Alto interface showing the Cloudflare_L3_Zone" src="/images/magic-wan/third-party/palo-alto/panw_zones/03_cloudflare_zone_hu2194bf89ca58fbe6bbc8abc1c10acac7_99947_1261x929_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="929" width="1261"
    style="aspect-ratio:1.357384284176534;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="The Palo Alto interface showing the Tunnel Interfaces overview section" src="/images/magic-wan/third-party/palo-alto/panw_zones/04_zones_overview_hu755e71430d7cf8257b958664b01b8fd7_157484_1922x594_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="594" width="1922"
    style="aspect-ratio:3.2357070707070705;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<h4 id="set-up-via-command-line-3">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#set-up-via-command-line-3">&#8203;​</a>
    </span>
    <span>Set up via command line</span>
  </h4><p>You can also use the command line to associate zones and interfaces:</p>
<div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="set&#43;zone&#43;Trust_L3_Zone&#43;network&#43;layer3&#43;ethernet1%2F1%0Aset&#43;zone&#43;Untrust_L3_Zone&#43;network&#43;layer3&#43;ethernet1%2F2%0Aset&#43;zone&#43;Cloudflare_L3_Zone&#43;network&#43;layer3&#43;%5B&#43;tunnel.1&#43;tunnel.2&#43;%5D"></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h3 id="apply-changes">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#apply-changes">&#8203;​</a>
    </span>
    <span>Apply Changes</span>
  </h3><p>This would be a good time to save and commit the configuration changes made so far. Once complete, make sure you test basic connectivity to and from the firewall.</p>
<h3 id="ike-crypto-profile-phase-1">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#ike-crypto-profile-phase-1">&#8203;​</a>
    </span>
    <span>IKE crypto profile Phase 1</span>
  </h3><p>Add a new IKE crypto profile to support the required parameters for Phase 1.</p>
<p>Multiple DH groups and authentication settings are defined in the desired order. Palo Alto Networks Next-Generation Firewall (NGFW) will automatically negotiate the optimal settings based on specified values.</p>
<h4 id="set-up-via-dashboard-4">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#set-up-via-dashboard-4">&#8203;​</a>
    </span>
    <span>Set up via dashboard</span>
  </h4><table>
<thead>
<tr>
<th>Name</th>
<th>Option</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CF_IKE_Crypto_CBC</code></td>
<td>DH Group</td>
<td><strong>group14</strong></td>
</tr>
<tr>
<td></td>
<td>Authentication</td>
<td><strong>sha512</strong> <br> <strong>sha384</strong> <br> <strong>sha256</strong></td>
</tr>
<tr>
<td></td>
<td>Encryption</td>
<td><strong>aes-256-cbc</strong></td>
</tr>
<tr>
<td></td>
<td>Key Lifetime</td>
<td>8 hours</td>
</tr>
<tr>
<td></td>
<td>IKEv2 Authentication Multiple</td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
<p><figure class="image-caption">
    <img alt="IKE crypto profile you need to set up on your device for Phase 1" src="/images/magic-wan/third-party/palo-alto/panw_ipsec_tunnels/01_ike_crypto_profile_hue3814c3fe404a28543bc5f0a0d551a1e_71352_1451x715_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="715" width="1451"
    style="aspect-ratio:2.0293846153846156;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<h4 id="set-up-via-command-line-4">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#set-up-via-command-line-4">&#8203;​</a>
    </span>
    <span>Set up via command line</span>
  </h4><p>You can also set up the crypto profile for Phase 1 via the command line:</p>
<div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="set&#43;network&#43;ike&#43;crypto-profiles&#43;ike-crypto-profiles&#43;CF_IKE_Crypto_CBC&#43;hash&#43;%5B&#43;sha512&#43;sha384&#43;sha256&#43;%5D%0Aset&#43;network&#43;ike&#43;crypto-profiles&#43;ike-crypto-profiles&#43;CF_IKE_Crypto_CBC&#43;dh-group&#43;%5B&#43;group14&#43;%5D%0Aset&#43;network&#43;ike&#43;crypto-profiles&#43;ike-crypto-profiles&#43;CF_IKE_Crypto_CBC&#43;encryption&#43;aes-256-cbc%0Aset&#43;network&#43;ike&#43;crypto-profiles&#43;ike-crypto-profiles&#43;CF_IKE_Crypto_CBC&#43;lifetime&#43;hours&#43;8%0Aset&#43;network&#43;ike&#43;crypto-profiles&#43;ike-crypto-profiles&#43;CF_IKE_Crypto_CBC&#43;authentication-multiple&#43;0"></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h3 id="ipsec-crypto-profile-phase-2">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#ipsec-crypto-profile-phase-2">&#8203;​</a>
    </span>
    <span>IPsec crypto profile Phase 2</span>
  </h3><p>Add a new IPsec crypto profile to support the required parameters for Phase 2.</p>
<p>Multiple Authentication settings are defined in the desired order. Palo Alto Networks Next-Generation Firewall (NGFW) will automatically negotiate the optimal settings based on specified values.</p>
<h4 id="set-up-via-dashboard-5">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#set-up-via-dashboard-5">&#8203;​</a>
    </span>
    <span>Set up via dashboard</span>
  </h4><table>
<thead>
<tr>
<th>Name</th>
<th>Option</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CF_IPsec_Crypto_CBC</code></td>
<td>Encryption</td>
<td><strong>aes-256-cbc</strong></td>
</tr>
<tr>
<td></td>
<td>Authentication</td>
<td><strong>sha256</strong> <br> <strong>sha1</strong></td>
</tr>
<tr>
<td></td>
<td>DH Group</td>
<td><strong>group14</strong></td>
</tr>
<tr>
<td></td>
<td>Lifetime</td>
<td>1 hour</td>
</tr>
</tbody>
</table>
<p><figure class="image-caption">
    <img alt="IPsec crypto profile you need to set up on your device" src="/images/magic-wan/third-party/palo-alto/panw_ipsec_tunnels/02_ipsec_crypto_profile_hu908da8d018e188f74661086f116edd7b_67841_1464x772_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="772" width="1464"
    style="aspect-ratio:1.8963860103626944;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<h4 id="set-up-via-command-line-5">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#set-up-via-command-line-5">&#8203;​</a>
    </span>
    <span>Set up via command line</span>
  </h4><p>You can also set up the IPsec crypto profile for Phase 2 via the command line:</p>
<div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="set&#43;network&#43;ike&#43;crypto-profiles&#43;ipsec-crypto-profiles&#43;CF_IPsec_Crypto_CBC&#43;esp&#43;authentication&#43;%5B&#43;sha256&#43;sha1&#43;%5D%0Aset&#43;network&#43;ike&#43;crypto-profiles&#43;ipsec-crypto-profiles&#43;CF_IPsec_Crypto_CBC&#43;esp&#43;encryption&#43;aes-256-cbc%0Aset&#43;network&#43;ike&#43;crypto-profiles&#43;ipsec-crypto-profiles&#43;CF_IPsec_Crypto_CBC&#43;lifetime&#43;hours&#43;1%0Aset&#43;network&#43;ike&#43;crypto-profiles&#43;ipsec-crypto-profiles&#43;CF_IPsec_Crypto_CBC&#43;dh-group&#43;group14"></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h3 id="ike-gateways">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#ike-gateways">&#8203;​</a>
    </span>
    <span>IKE Gateways</span>
  </h3><aside class="DocsMarkdown--aside" role="note" data-type="note"><p>Any other settings not specified should be left at their default values. Any deviation may lead to undesirable behavior and are not supported.</p>
</aside>

<p>Define two IKE Gateways to establish the two IPsec tunnels to Cloudflare. Make sure to define the following values:</p>
<h4 id="set-up-via-dashboard-6">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#set-up-via-dashboard-6">&#8203;​</a>
    </span>
    <span>Set up via dashboard</span>
  </h4><h5 id="tunnel-1-settings-cf_magic_wan_ike_01">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#tunnel-1-settings-cf_magic_wan_ike_01">&#8203;​</a>
    </span>
    <span>Tunnel 1 settings: <code>CF_Magic_WAN_IKE_01</code></span>
  </h5><aside class="DocsMarkdown--aside" role="note" data-type="note"><p>Make sure you select <code>CF_IKE_Crypto_CBC</code> as the IKE Crypto profile.</p>
</aside>

<div class="DocsMarkdown--table-wrap"><div class="DocsMarkdown--table-wrap-inner">
    <table>
<thead>
<tr>
<th>Tab</th>
<th>Option</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>General tab</strong></td>
<td>Name</td>
<td><code>CF_Magic_WAN_IKE_01</code></td>
</tr>
<tr>
<td></td>
<td>Version</td>
<td><em>IKEv2 only mode</em>. <br> Make sure both IKE Gateways are based only on this setting.</td>
</tr>
<tr>
<td></td>
<td>Local IP Address</td>
<td><code>Internet_L3_203-0-113-254--24</code></td>
</tr>
<tr>
<td></td>
<td>Peer address</td>
<td><code>CF_Magic_WAN_Anycast_01</code></td>
</tr>
<tr>
<td></td>
<td>Pre-Shared Key</td>
<td>This value can be obtained from the Cloudflare dashboard - value is unique per tunnel.</td>
</tr>
<tr>
<td></td>
<td>Local Identification</td>
<td><em>FQDN (hostname)</em>. <br> You can obtain this value from the Cloudflare Dashboard - value is unique per tunnel.</td>
</tr>
<tr>
<td></td>
<td>Peer Identification</td>
<td><em>None</em></td>
</tr>
<tr>
<td><strong>Advanced tab</strong></td>
<td>IKE Crypto Profile</td>
<td><em>CF_IKE_Crypto_CBC</em></td>
</tr>
<tr>
<td></td>
<td>Liveness Check</td>
<td>The default value (five seconds) is sufficient. This setting is used to periodically determine if there are any underlying connectivity issues that may adversely affect the creation of Phase 1 Security Associations.</td>
</tr>
</tbody>
</table>

  </div>
</div>
<p><figure class="image-caption">
    <img alt="IKE gateway settings for tunnel 1" src="/images/magic-wan/third-party/palo-alto/panw_ipsec_tunnels/03_ike_gw01_page1_hue4ca3dc064e8f142ec8dc990031c6bd6_101438_1090x869_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="869" width="1090"
    style="aspect-ratio:1.2543268124280782;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="IKE gateway settings for tunnel 1" src="/images/magic-wan/third-party/palo-alto/panw_ipsec_tunnels/04_ike_gw01_page2_hu214ae3e1acc66838f10ae9c7d009aa0c_51299_1089x668_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="668" width="1089"
    style="aspect-ratio:1.6302544910179642;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<h5 id="tunnel-2-settings-cf_magic_wan_ike_02">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#tunnel-2-settings-cf_magic_wan_ike_02">&#8203;​</a>
    </span>
    <span>Tunnel 2 settings: <code>CF_Magic_WAN_IKE_02</code></span>
  </h5><aside class="DocsMarkdown--aside" role="note" data-type="note"><p>Make sure you select <code>CF_IKE_Crypto_CBC</code> as the IKE Crypto profile.</p>
</aside>

<div class="DocsMarkdown--table-wrap"><div class="DocsMarkdown--table-wrap-inner">
    <table>
<thead>
<tr>
<th>Tab</th>
<th>Option</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>General tab</strong></td>
<td>Name</td>
<td><code>CF_Magic_WAN_IKE_02</code></td>
</tr>
<tr>
<td></td>
<td>Version</td>
<td><em>IKEv2 only mode</em>. <br> Make sure both IKE Gateways are based only on this setting.</td>
</tr>
<tr>
<td></td>
<td>Local IP Address</td>
<td><code>Internet_L3_203-0-113-254--24</code></td>
</tr>
<tr>
<td></td>
<td>Peer address</td>
<td><code>CF_Magic_WAN_Anycast_02</code></td>
</tr>
<tr>
<td></td>
<td>Pre-Shared Key</td>
<td>This value can be obtained from the Cloudflare dashboard - value is unique per tunnel.</td>
</tr>
<tr>
<td></td>
<td>Local Identification</td>
<td><em>FQDN (hostname)</em>. <br> You can obtain this value from the Cloudflare Dashboard - value is unique per tunnel.</td>
</tr>
<tr>
<td></td>
<td>Peer Identification</td>
<td><em>None</em></td>
</tr>
<tr>
<td><strong>Advanced tab</strong></td>
<td>IKE crypto profile</td>
<td><em>CF_IKE_Crypto_CBC</em></td>
</tr>
<tr>
<td></td>
<td>Liveness Check</td>
<td>The default value (five seconds) is sufficient. This setting is used to periodically determine if there are any underlying connectivity issues that may adversely affect the creation of Phase 1 Security Associations.</td>
</tr>
</tbody>
</table>

  </div>
</div>
<p><figure class="image-caption">
    <img alt="IKE gateway settings for tunnel 2" src="/images/magic-wan/third-party/palo-alto/panw_ipsec_tunnels/05_ike_gw02_page1_hu33a618733b0a68ead4318922e59a2027_101538_1093x870_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="870" width="1093"
    style="aspect-ratio:1.2563333333333333;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="IKE gateway settings for tunnel 2" src="/images/magic-wan/third-party/palo-alto/panw_ipsec_tunnels/06_ike_gw02_page2_hub94a6fba5cb8806f54981e5b343f90df_51244_1088x667_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="667" width="1088"
    style="aspect-ratio:1.63119940029985;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<h4 id="set-up-via-command-line-6">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#set-up-via-command-line-6">&#8203;​</a>
    </span>
    <span>Set up via command line</span>
  </h4><h5 id="tunnel-1-settings-cf_magic_wan_ike_01-1">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#tunnel-1-settings-cf_magic_wan_ike_01-1">&#8203;​</a>
    </span>
    <span>Tunnel 1 settings: <code>CF_Magic_WAN_IKE_01</code></span>
  </h5><div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="set&#43;network&#43;ike&#43;gateway&#43;CF_Magic_WAN_IKE_01&#43;protocol&#43;ikev1&#43;dpd&#43;enable&#43;yes%0Aset&#43;network&#43;ike&#43;gateway&#43;CF_Magic_WAN_IKE_01&#43;protocol&#43;ikev2&#43;dpd&#43;enable&#43;yes%0Aset&#43;network&#43;ike&#43;gateway&#43;CF_Magic_WAN_IKE_01&#43;protocol&#43;ikev2&#43;ike-crypto-profile&#43;CF_IKE_Crypto_CBC%0Aset&#43;network&#43;ike&#43;gateway&#43;CF_Magic_WAN_IKE_01&#43;protocol&#43;version&#43;ikev2%0Aset&#43;network&#43;ike&#43;gateway&#43;CF_Magic_WAN_IKE_01&#43;local-address&#43;ip&#43;Internet_L3_203-0-113-254--24%0Aset&#43;network&#43;ike&#43;gateway&#43;CF_Magic_WAN_IKE_01&#43;local-address&#43;interface&#43;ethernet1%2F2%0Aset&#43;network&#43;ike&#43;gateway&#43;CF_Magic_WAN_IKE_01&#43;protocol-common&#43;nat-traversal&#43;enable&#43;no%0Aset&#43;network&#43;ike&#43;gateway&#43;CF_Magic_WAN_IKE_01&#43;protocol-common&#43;fragmentation&#43;enable&#43;no%0Aset&#43;network&#43;ike&#43;gateway&#43;CF_Magic_WAN_IKE_01&#43;peer-address&#43;ip&#43;CF_Magic_WAN_Anycast_01%0Aset&#43;network&#43;ike&#43;gateway&#43;CF_Magic_WAN_IKE_01&#43;authentication&#43;pre-shared-key&#43;key&#43;-AQ%3D%3DXdcd9ir5o5xhjuIH---------------------HsRoVf%2BM0TTG4ja3EzulN37zMOwGs%0Aset&#43;network&#43;ike&#43;gateway&#43;CF_Magic_WAN_IKE_01&#43;local-id&#43;id&#43;28de99ee57424ee0a1591384193982fa.33145236.ipsec.cloudflare.com%0Aset&#43;network&#43;ike&#43;gateway&#43;CF_Magic_WAN_IKE_01&#43;local-id&#43;type&#43;fqdn%0Aset&#43;network&#43;ike&#43;gateway&#43;CF_Magic_WAN_IKE_01&#43;disabled&#43;no"></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h5 id="tunnel-2-settings-cf_magic_wan_ike_02-1">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#tunnel-2-settings-cf_magic_wan_ike_02-1">&#8203;​</a>
    </span>
    <span>Tunnel 2 settings: <code>CF_Magic_WAN_IKE_02</code></span>
  </h5><div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="set&#43;network&#43;ike&#43;gateway&#43;CF_Magic_WAN_IKE_02&#43;protocol&#43;ikev1&#43;dpd&#43;enable&#43;yes%0Aset&#43;network&#43;ike&#43;gateway&#43;CF_Magic_WAN_IKE_02&#43;protocol&#43;ikev2&#43;dpd&#43;enable&#43;yes%0Aset&#43;network&#43;ike&#43;gateway&#43;CF_Magic_WAN_IKE_02&#43;protocol&#43;ikev2&#43;ike-crypto-profile&#43;CF_IKE_Crypto_CBC%0Aset&#43;network&#43;ike&#43;gateway&#43;CF_Magic_WAN_IKE_02&#43;protocol&#43;version&#43;ikev2%0Aset&#43;network&#43;ike&#43;gateway&#43;CF_Magic_WAN_IKE_02&#43;local-address&#43;ip&#43;Internet_L3_203-0-113-254--24%0Aset&#43;network&#43;ike&#43;gateway&#43;CF_Magic_WAN_IKE_02&#43;local-address&#43;interface&#43;ethernet1%2F2%0Aset&#43;network&#43;ike&#43;gateway&#43;CF_Magic_WAN_IKE_02&#43;protocol-common&#43;nat-traversal&#43;enable&#43;no%0Aset&#43;network&#43;ike&#43;gateway&#43;CF_Magic_WAN_IKE_02&#43;protocol-common&#43;fragmentation&#43;enable&#43;no%0Aset&#43;network&#43;ike&#43;gateway&#43;CF_Magic_WAN_IKE_02&#43;peer-address&#43;ip&#43;CF_Magic_WAN_Anycast_02%0Aset&#43;network&#43;ike&#43;gateway&#43;CF_Magic_WAN_IKE_02&#43;authentication&#43;pre-shared-key&#43;key&#43;-AQ%3D%3DrvwEulxx7wLBl---------------------swSeJPXxxM2cfPbt7q4HZZGZZ8%0Aset&#43;network&#43;ike&#43;gateway&#43;CF_Magic_WAN_IKE_02&#43;local-id&#43;id&#43;b87322b0915b47158667bf1653990e66.33145236.ipsec.cloudflare.com%0Aset&#43;network&#43;ike&#43;gateway&#43;CF_Magic_WAN_IKE_02&#43;local-id&#43;type&#43;fqdn%0Aset&#43;network&#43;ike&#43;gateway&#43;CF_Magic_WAN_IKE_02&#43;disabled&#43;no"></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h3 id="ipsec-tunnels">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#ipsec-tunnels">&#8203;​</a>
    </span>
    <span>IPsec Tunnels</span>
  </h3><p>With the IKE Gateways defined, the next step is to configure two IPsec Tunnels - one corresponding to each of the two IKE Gateways configured in the previous section.</p>
<h4 id="prerequisites-1">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#prerequisites-1">&#8203;​</a>
    </span>
    <span>Prerequisites</span>
  </h4><p>There are a few prerequisites you should be aware of before continuing:</p>
<ul>
<li>Do not configure Proxy IDs. Magic WAN IPsec tunnels are based on the route-based VPN model. Proxy IDs are used with policy-based VPNs.</li>
<li>Disable Replay Protection, under the Advanced Options.</li>
<li>Disable Tunnel Monitor. It can cause undesirable results. Tunnel Monitor is a Palo Alto Networks proprietary feature that assumes there are Palo Alto Networks Next-Generation Firewall devices on both sides of the IPsec tunnel. Also, Tunnel Monitor is intended for use with IPsec tunnels based on IKEv1 (Magic WAN IPsec tunnels are based on IKEv2).</li>
</ul>
<h4 id="set-up-via-dashboard-7">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#set-up-via-dashboard-7">&#8203;​</a>
    </span>
    <span>Set up via dashboard</span>
  </h4><h5 id="tunnel-1-settings-cf_magic_wan_ipsec_01">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#tunnel-1-settings-cf_magic_wan_ipsec_01">&#8203;​</a>
    </span>
    <span>Tunnel 1 settings: <code>CF_Magic_WAN_IPsec_01</code></span>
  </h5><table>
<thead>
<tr>
<th>Name</th>
<th>Option</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CF_Magic_WAN_IPsec_01</code></td>
<td>Tunnel interface</td>
<td>tunnel.1</td>
</tr>
<tr>
<td></td>
<td>IKE Gateway</td>
<td><em>CF_Magic_WAN_IKE_01</em></td>
</tr>
<tr>
<td></td>
<td>IPsec crypto profile</td>
<td><em>CF_IKE_Crypto_CBC</em></td>
</tr>
<tr>
<td></td>
<td>Enable Replay Protection</td>
<td><strong>Disable</strong></td>
</tr>
</tbody>
</table>
<p><figure class="image-caption">
    <img alt="Set up the IPsec tunnel" src="/images/magic-wan/third-party/palo-alto/panw_ipsec_tunnels/07_ipsec_tun01_page1_huede85f533e8a6229bd01ce5363ae30e3_93534_1449x905_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="905" width="1449"
    style="aspect-ratio:1.6011160220994476;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="Set up the IPsec tunnel" src="/images/magic-wan/third-party/palo-alto/panw_ipsec_tunnels/08_ipsec_tun01_page2_hu007544271020aa3e08119ec848356d63_32295_1449x833_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="833" width="1449"
    style="aspect-ratio:1.7395078031212485;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<h5 id="tunnel-2-settings-cf_magic_wan_ipsec_02">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#tunnel-2-settings-cf_magic_wan_ipsec_02">&#8203;​</a>
    </span>
    <span>Tunnel 2 settings: <code>CF_Magic_WAN_IPsec_02</code></span>
  </h5><table>
<thead>
<tr>
<th>Name</th>
<th>Option</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CF_Magic_WAN_IPsec_02</code></td>
<td>Tunnel interface</td>
<td>tunnel.2</td>
</tr>
<tr>
<td></td>
<td>IKE Gateway</td>
<td><em>CF_Magic_WAN_IKE_02</em></td>
</tr>
<tr>
<td></td>
<td>IPsec crypto profile</td>
<td><em>CF_IKE_Crypto_CBC</em></td>
</tr>
<tr>
<td></td>
<td>Enable Replay Protection</td>
<td><strong>Disable</strong></td>
</tr>
</tbody>
</table>
<p><figure class="image-caption">
    <img alt="Set up the IPsec tunnel" src="/images/magic-wan/third-party/palo-alto/panw_ipsec_tunnels/09_ipsec_tun02_page1_hu0ed7528c714828ede50e1e8bca7e1e5b_94235_1450x902_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="902" width="1450"
    style="aspect-ratio:1.6075498891352549;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="Set up the IPsec tunnel" src="/images/magic-wan/third-party/palo-alto/panw_ipsec_tunnels/10_ipsec_tun02_page2_hu69bf1ca1dcf77e62f380ed96cb38c6a0_32246_1447x829_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="829" width="1447"
    style="aspect-ratio:1.7454885404101326;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<h4 id="set-up-via-command-line-7">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#set-up-via-command-line-7">&#8203;​</a>
    </span>
    <span>Set up via command line</span>
  </h4><h5 id="tunnel-1-settings-cf_magic_wan_ipsec_01-1">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#tunnel-1-settings-cf_magic_wan_ipsec_01-1">&#8203;​</a>
    </span>
    <span>Tunnel 1 settings: <code>CF_Magic_WAN_IPsec_01</code></span>
  </h5><div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="set&#43;network&#43;tunnel&#43;ipsec&#43;CF_Magic_WAN_IPsec_01&#43;auto-key&#43;ike-gateway&#43;CF_Magic_WAN_IKE_01%0Aset&#43;network&#43;tunnel&#43;ipsec&#43;CF_Magic_WAN_IPsec_01&#43;auto-key&#43;ipsec-crypto-profile&#43;CF_IPsec_Crypto_CBC%0Aset&#43;network&#43;tunnel&#43;ipsec&#43;CF_Magic_WAN_IPsec_01&#43;tunnel-monitor&#43;destination-ip&#43;10.252.2.26%0Aset&#43;network&#43;tunnel&#43;ipsec&#43;CF_Magic_WAN_IPsec_01&#43;tunnel-monitor&#43;tunnel-monitor-profile&#43;default%0Aset&#43;network&#43;tunnel&#43;ipsec&#43;CF_Magic_WAN_IPsec_01&#43;tunnel-interface&#43;tunnel.1%0Aset&#43;network&#43;tunnel&#43;ipsec&#43;CF_Magic_WAN_IPsec_01&#43;anti-replay&#43;no%0Aset&#43;network&#43;tunnel&#43;ipsec&#43;CF_Magic_WAN_IPsec_01&#43;disabled&#43;no"></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h5 id="tunnel-2-settings-cf_magic_wan_ipsec_02-1">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#tunnel-2-settings-cf_magic_wan_ipsec_02-1">&#8203;​</a>
    </span>
    <span>Tunnel 2 settings: <code>CF_Magic_WAN_IPsec_02</code></span>
  </h5><div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="set&#43;network&#43;tunnel&#43;ipsec&#43;CF_Magic_WAN_IPsec_02&#43;auto-key&#43;ike-gateway&#43;CF_Magic_WAN_IKE_02%0Aset&#43;network&#43;tunnel&#43;ipsec&#43;CF_Magic_WAN_IPsec_02&#43;auto-key&#43;ipsec-crypto-profile&#43;CF_IPsec_Crypto_CBC%0Aset&#43;network&#43;tunnel&#43;ipsec&#43;CF_Magic_WAN_IPsec_02&#43;tunnel-monitor&#43;destination-ip&#43;10.252.2.28%0Aset&#43;network&#43;tunnel&#43;ipsec&#43;CF_Magic_WAN_IPsec_02&#43;tunnel-monitor&#43;tunnel-monitor-profile&#43;default%0Aset&#43;network&#43;tunnel&#43;ipsec&#43;CF_Magic_WAN_IPsec_02&#43;tunnel-interface&#43;tunnel.2%0Aset&#43;network&#43;tunnel&#43;ipsec&#43;CF_Magic_WAN_IPsec_02&#43;anti-replay&#43;no%0Aset&#43;network&#43;tunnel&#43;ipsec&#43;CF_Magic_WAN_IPsec_02&#43;disabled&#43;no"></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h3 id="apply-changes-1">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#apply-changes-1">&#8203;​</a>
    </span>
    <span>Apply Changes</span>
  </h3><p>This would be a good time to save and commit the configuration changes made thus far. Once complete, make sure you test basic connectivity across the IPsec tunnels.</p>
<h3 id="ipsec-tunnel-connectivity-tests">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#ipsec-tunnel-connectivity-tests">&#8203;​</a>
    </span>
    <span>IPsec tunnel connectivity tests</span>
  </h3><p>This is a good time to ensure the IPsec tunnels are established and to validate basic connectivity.</p>
<aside class="DocsMarkdown--aside" role="note" data-type="note"><p>Tunnel health checks will not function until security policies and policy-based forwarding are configured. This series of tests is focused on testing IPsec connectivity exclusively.</p>
</aside>

<h4 id="verify-ike-phase-1-communications">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#verify-ike-phase-1-communications">&#8203;​</a>
    </span>
    <span>Verify IKE Phase 1 Communications</span>
  </h4><p>The first step is to verify IKE Phase 1 completed successfully:</p>
<h5 id="syntax">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#syntax">&#8203;​</a>
    </span>
    <span>Syntax</span>
  </h5><div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="show&#43;vpn&#43;ike-sa&#43;gateway&#43;%5Bvalue%5D"></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h5 id="example-for-cf_magic_wan_ike_01">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#example-for-cf_magic_wan_ike_01">&#8203;​</a>
    </span>
    <span>Example for <code>CF_Magic_WAN_IKE_01</code></span>
  </h5><div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="admin%40panvm03%3E&#43;show&#43;vpn&#43;ike-sa&#43;gateway&#43;CF_Magic_WAN_IKE_01%0A%0AThere&#43;is&#43;no&#43;IKEv1&#43;phase-1&#43;SA&#43;found.%0A%0AThere&#43;is&#43;no&#43;IKEv1&#43;phase-2&#43;SA&#43;found.%0A%0AIKEv2&#43;SAs%0AGateway&#43;ID&#43;&#43;&#43;&#43;&#43;&#43;Peer-Address&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;Gateway&#43;Name&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;Role&#43;SN&#43;&#43;&#43;&#43;&#43;&#43;&#43;Algorithm&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;Established&#43;&#43;&#43;&#43;&#43;Expiration&#43;&#43;&#43;&#43;&#43;&#43;Xt&#43;Child&#43;&#43;ST%0A%0A----------&#43;&#43;&#43;&#43;&#43;&#43;------------&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;------------&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;----&#43;--&#43;&#43;&#43;&#43;&#43;&#43;&#43;---------&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;-----------&#43;&#43;&#43;&#43;&#43;----------&#43;&#43;&#43;&#43;&#43;&#43;--&#43;-----&#43;&#43;--%0A%0A2&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;162.159.66.164&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;CF_Magic_WAN_IKE_01&#43;&#43;&#43;&#43;Init&#43;67&#43;&#43;&#43;&#43;&#43;&#43;&#43;PSK%2FDH14%2FA256%2FSHA256&#43;&#43;Jun.04&#43;21%3A09%3A13&#43;Jun.05&#43;05%3A09%3A13&#43;0&#43;&#43;1&#43;&#43;&#43;&#43;&#43;&#43;Established%0A%0AIKEv2&#43;IPsec&#43;Child&#43;SAs%0AGateway&#43;Name&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;TnID&#43;&#43;&#43;&#43;&#43;Tunnel&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;ID&#43;&#43;&#43;&#43;&#43;&#43;&#43;Parent&#43;&#43;&#43;Role&#43;SPI%28in%29&#43;&#43;SPI%28out%29&#43;MsgID&#43;&#43;&#43;&#43;ST%0A%0A------------&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;----&#43;&#43;&#43;&#43;&#43;------&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;--&#43;&#43;&#43;&#43;&#43;&#43;&#43;------&#43;&#43;&#43;----&#43;-------&#43;&#43;--------&#43;-----&#43;&#43;&#43;&#43;--%0A%0ACF_Magic_WAN_IKE_01&#43;&#43;&#43;&#43;2&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;CF_Magic_WAN_IPsec_01&#43;&#43;&#43;&#43;&#43;322550&#43;&#43;&#43;67&#43;&#43;&#43;&#43;&#43;&#43;&#43;Init&#43;FCAEE176&#43;1EF41BA9&#43;000007B4&#43;Mature%0A%0AShow&#43;IKEv2&#43;SA%3A&#43;Total&#43;2&#43;gateways&#43;found.&#43;1&#43;ike&#43;sa&#43;found."></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h5 id="example-for-cf_magic_wan_ike_02">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#example-for-cf_magic_wan_ike_02">&#8203;​</a>
    </span>
    <span>Example for <code>CF_Magic_WAN_IKE_02</code></span>
  </h5><div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="admin%40panvm03%3E&#43;show&#43;vpn&#43;ike-sa&#43;gateway&#43;CF_Magic_WAN_IKE_02%0A%0AThere&#43;is&#43;no&#43;IKEv1&#43;phase-1&#43;SA&#43;found.%0A%0AThere&#43;is&#43;no&#43;IKEv1&#43;phase-2&#43;SA&#43;found.%0A%0A%0AIKEv2&#43;SAs%0AGateway&#43;ID&#43;&#43;&#43;&#43;&#43;&#43;Peer-Address&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;Gateway&#43;Name&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;Role&#43;SN&#43;&#43;&#43;&#43;&#43;&#43;&#43;Algorithm&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;Established&#43;&#43;&#43;&#43;&#43;Expiration&#43;&#43;&#43;&#43;&#43;&#43;Xt&#43;Child&#43;&#43;ST%0A%0A----------&#43;&#43;&#43;&#43;&#43;&#43;------------&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;------------&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;----&#43;--&#43;&#43;&#43;&#43;&#43;&#43;&#43;---------&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;-----------&#43;&#43;&#43;&#43;&#43;----------&#43;&#43;&#43;&#43;&#43;&#43;--&#43;-----&#43;&#43;--%0A%0A3&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;172.64.242.164&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;CF_Magic_WAN_IKE_02&#43;&#43;&#43;&#43;Init&#43;66&#43;&#43;&#43;&#43;&#43;&#43;&#43;PSK%2FDH14%2FA256%2FSHA256&#43;&#43;Jun.04&#43;20%3A37%3A42&#43;Jun.05&#43;04%3A37%3A42&#43;0&#43;&#43;2&#43;&#43;&#43;&#43;&#43;&#43;Established%0A%0AIKEv2&#43;IPsec&#43;Child&#43;SAs%0AGateway&#43;Name&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;TnID&#43;&#43;&#43;&#43;&#43;Tunnel&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;ID&#43;&#43;&#43;&#43;&#43;&#43;&#43;Parent&#43;&#43;&#43;Role&#43;SPI%28in%29&#43;&#43;SPI%28out%29&#43;MsgID&#43;&#43;&#43;&#43;ST%0A%0A------------&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;----&#43;&#43;&#43;&#43;&#43;------&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;--&#43;&#43;&#43;&#43;&#43;&#43;&#43;------&#43;&#43;&#43;----&#43;-------&#43;&#43;--------&#43;-----&#43;&#43;&#43;&#43;--%0A%0ACF_Magic_WAN_IKE_02&#43;&#43;&#43;&#43;3&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;CF_Magic_WAN_IPsec_02&#43;&#43;&#43;&#43;&#43;323145&#43;&#43;&#43;66&#43;&#43;&#43;&#43;&#43;&#43;&#43;Init&#43;B6EDA356&#43;43F71BC5&#43;00000A52&#43;Mature%0A%0AShow&#43;IKEv2&#43;SA%3A&#43;Total&#43;2&#43;gateways&#43;found.&#43;1&#43;ike&#43;sa&#43;found."></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h4 id="troubleshooting-ike-phase-1-communications">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#troubleshooting-ike-phase-1-communications">&#8203;​</a>
    </span>
    <span>Troubleshooting IKE Phase 1 Communications</span>
  </h4><p>Magic WAN IPsec tunnels expect the customer device will initiate the IPsec tunnels. The tunnels may not establish if there is no traffic that would traverse the tunnel under normal conditions. In this case, it may be necessary to force IKE Phase 1.</p>
<h5 id="syntax-1">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#syntax-1">&#8203;​</a>
    </span>
    <span>Syntax</span>
  </h5><div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="test&#43;vpn&#43;ike-sa&#43;gateway&#43;%5Bvalue%5D"></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h5 id="example-for-cf_magic_wan_ike_01-1">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#example-for-cf_magic_wan_ike_01-1">&#8203;​</a>
    </span>
    <span>Example for <code>CF_Magic_WAN_IKE_01</code></span>
  </h5><div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="admin%40panvm03%3E&#43;test&#43;vpn&#43;ike-sa&#43;gateway&#43;CF_Magic_WAN_IKE_01%0A%0AStart&#43;time%3A&#43;Jun.05&#43;00%3A30%3A29%0AInitiate&#43;1&#43;IKE&#43;SA."></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h5 id="example-for-cf_magic_wan_ike_02-1">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#example-for-cf_magic_wan_ike_02-1">&#8203;​</a>
    </span>
    <span>Example for <code>CF_Magic_WAN_IKE_02</code></span>
  </h5><div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="admin%40panvm03%3E&#43;test&#43;vpn&#43;ike-sa&#43;gateway&#43;CF_Magic_WAN_IKE_02%0A%0AStart&#43;time%3A&#43;Jun.05&#43;00%3A30%3A33%0AInitiate&#43;1&#43;IKE&#43;SA."></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><p>Repeat these commands for the respective tunnel to ensure the IKE SA(s) display as expected.</p>
<h4 id="verify-ipsec-phase-2-communications">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#verify-ipsec-phase-2-communications">&#8203;​</a>
    </span>
    <span>Verify IPsec Phase 2 Communications</span>
  </h4><p>To ensure the IPsec tunnels are established, ping the remote Virtual Tunnel Interface (Cloudflare side) from the​ command line on the Palo Alto Networks Next-Generation Firewall. Ensure you specify the source IP address of the ping from the local side of the Virtual Tunnel Interface:</p>
<h5 id="syntax-2">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#syntax-2">&#8203;​</a>
    </span>
    <span>Syntax</span>
  </h5><div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="show&#43;vpn&#43;ipsec-sa&#43;tunnel&#43;%5Bvalue%5D"></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h5 id="example-for-cf_magic_wan_ipsec_01">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#example-for-cf_magic_wan_ipsec_01">&#8203;​</a>
    </span>
    <span>Example for <code>CF_Magic_WAN_IPsec_01</code></span>
  </h5><div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="admin%40panvm03%3E&#43;show&#43;vpn&#43;ipsec-sa&#43;tunnel&#43;CF_Magic_WAN_IPsec_01%0A%0AGwID%2Fclient&#43;IP&#43;&#43;TnID&#43;&#43;&#43;Peer-Address&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;Tunnel%28Gateway%29&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;Algorithm&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;SPI%28in%29&#43;&#43;SPI%28out%29&#43;life%28Sec%2FKB%29&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;remain-time%28Sec%29%0A%0A--------------&#43;&#43;----&#43;&#43;&#43;------------&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;---------------&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;---------&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;-------&#43;&#43;--------&#43;------------&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;----------------%0A%0A2&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;2&#43;&#43;&#43;&#43;&#43;&#43;162.159.66.164&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;CF_Magic_WAN_IPsec_01%28CF_Magic_WAN_IKE_01%29&#43;&#43;&#43;&#43;&#43;ESP%2FA256%2FSHA256&#43;&#43;&#43;&#43;B5D09AB8&#43;9FA69407&#43;3600%2FUnlimited&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;3445%0A%0AShow&#43;IPsec&#43;SA%3A&#43;Total&#43;1&#43;tunnels&#43;found.&#43;1&#43;ipsec&#43;sa&#43;found."></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h5 id="example-for-cf_magic_wan_ipsec_02">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#example-for-cf_magic_wan_ipsec_02">&#8203;​</a>
    </span>
    <span>Example for <code>CF_Magic_WAN_IPsec_02</code></span>
  </h5><div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="admin%40panvm03%3E&#43;show&#43;vpn&#43;ipsec-sa&#43;tunnel&#43;CF_Magic_WAN_IPsec_02%0A%0AGwID%2Fclient&#43;IP&#43;&#43;TnID&#43;&#43;&#43;Peer-Address&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;Tunnel%28Gateway%29&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;Algorithm&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;SPI%28in%29&#43;&#43;SPI%28out%29&#43;life%28Sec%2FKB%29&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;remain-time%28Sec%29%0A%0A--------------&#43;&#43;----&#43;&#43;&#43;------------&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;---------------&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;---------&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;-------&#43;&#43;--------&#43;------------&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;----------------%0A%0A3&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;3&#43;&#43;&#43;&#43;&#43;&#43;172.64.242.164&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;CF_Magic_WAN_IPsec_02%28CF_Magic_WAN_IKE_02%29&#43;&#43;&#43;&#43;&#43;ESP%2FA256%2FSHA256&#43;&#43;&#43;&#43;CAEA6F09&#43;EC6ACC7A&#43;3600%2FUnlimited&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;&#43;3361%0A%0AShow&#43;IPsec&#43;SA%3A&#43;Total&#43;1&#43;tunnels&#43;found.&#43;1&#43;ipsec&#43;sa&#43;found."></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h4 id="troubleshooting-ipsec-phase-2-communications">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#troubleshooting-ipsec-phase-2-communications">&#8203;​</a>
    </span>
    <span>Troubleshooting IPsec Phase 2 Communications</span>
  </h4><p>Magic WAN IPsec tunnels expect the customer device will initiate the IPsec tunnels. The tunnels may not establish if there is no traffic that would traverse the tunnel under normal conditions. In this case, it may be necessary to force IPsec Phase 2. This is typically unnecessary as once IKE Phase 1 negotiates successfully, IPsec Phase 2 automatically establishes the tunnel. The test is still worth performing.</p>
<h5 id="syntax-3">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#syntax-3">&#8203;​</a>
    </span>
    <span>Syntax</span>
  </h5><div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="test&#43;vpn&#43;ipsec-sa&#43;tunnel&#43;%5Bvalue%5D"></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h5 id="example-for-cf_magic_wan_ipsec_01-1">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#example-for-cf_magic_wan_ipsec_01-1">&#8203;​</a>
    </span>
    <span>Example for <code>CF_Magic_WAN_IPsec_01</code></span>
  </h5><div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="admin%40panvm03%3E&#43;test&#43;vpn&#43;ipsec-sa&#43;tunnel&#43;CF_Magic_WAN_IPsec_01%0A%0AStart&#43;time%3A&#43;Jun.05&#43;00%3A37%3A50%0AInitiate&#43;1&#43;IPsec&#43;SA&#43;for&#43;tunnel&#43;CF_Magic_WAN_IPsec_01."></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h5 id="example-for-cf_magic_wan_ipsec_02-1">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#example-for-cf_magic_wan_ipsec_02-1">&#8203;​</a>
    </span>
    <span>Example for <code>CF_Magic_WAN_IPsec_02</code></span>
  </h5><div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="admin%40panvm03%3E&#43;test&#43;vpn&#43;ipsec-sa&#43;tunnel&#43;CF_Magic_WAN_IPsec_02%0A%0AStart&#43;time%3A&#43;Jun.05&#43;00%3A38%3A52%0AInitiate&#43;1&#43;IPsec&#43;SA&#43;for&#43;tunnel&#43;CF_Magic_WAN_IPsec_02."></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><p>Repeat these commands for the respective tunnel to ensure the IPsec SA(s) display as expected.</p>
<h4 id="ping-remote-virtual-tunnel-interfaces">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#ping-remote-virtual-tunnel-interfaces">&#8203;​</a>
    </span>
    <span>Ping Remote Virtual Tunnel interfaces</span>
  </h4><p>Use ping to source traffic from the IP address of the Virtual Tunnel interface on Palo Alto Networks Next-Generation Firewall (NGFW) to the IP address of the Virtual Tunnel Interface on the Cloudflare side of the IPsec tunnel.</p>
<aside class="DocsMarkdown--aside" role="note" data-type="note"><p>The interface address is defined with a <code>/31</code> netmask. There have been isolated cases where NGFW exhibited issues when using ping to verify connectivity between the local and remote Virtual Tunnel interfaces. This behavior can vary depending on the version of PAN-OS installed on the firewall. If you encounter this issue, either switch to a <code>/30</code> netmask, or contact Palo Alto Networks support for assistance.</p>
</aside>

<h5 id="syntax-4">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#syntax-4">&#8203;​</a>
    </span>
    <span>Syntax</span>
  </h5><div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="ping&#43;source&#43;%5Bvalue&#43;src&#43;IP%5D&#43;host&#43;%5Bvalue&#43;dst&#43;IP%5D"></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h5 id="example-for-tunnel-1">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#example-for-tunnel-1">&#8203;​</a>
    </span>
    <span>Example for Tunnel 1</span>
  </h5><div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="admin%40panvm03%3E&#43;ping&#43;source&#43;10.252.2.27&#43;host&#43;10.252.2.26%0APING&#43;10.252.2.26&#43;%2810.252.2.26%29&#43;from&#43;10.252.2.27&#43;%3A&#43;56%2884%29&#43;bytes&#43;of&#43;data.%0A64&#43;bytes&#43;from&#43;10.252.2.26%3A&#43;icmp_seq%3D1&#43;ttl%3D64&#43;time%3D2.71&#43;ms%0A64&#43;bytes&#43;from&#43;10.252.2.26%3A&#43;icmp_seq%3D2&#43;ttl%3D64&#43;time%3D2.03&#43;ms%0A64&#43;bytes&#43;from&#43;10.252.2.26%3A&#43;icmp_seq%3D3&#43;ttl%3D64&#43;time%3D1.98&#43;ms%0A64&#43;bytes&#43;from&#43;10.252.2.26%3A&#43;icmp_seq%3D4&#43;ttl%3D64&#43;time%3D1.98&#43;ms%0A%5EC%0A---&#43;10.252.2.26&#43;ping&#43;statistics&#43;---%0A4&#43;packets&#43;transmitted%2C&#43;4&#43;received%2C&#43;0%25&#43;packet&#43;loss%2C&#43;time&#43;3002ms%0Artt&#43;min%2Favg%2Fmax%2Fmdev&#43;%3D&#43;1.980%2F2.180%2F2.719%2F0.312&#43;ms"></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h5 id="example-for-tunnel-2">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#example-for-tunnel-2">&#8203;​</a>
    </span>
    <span>Example for Tunnel 2</span>
  </h5><div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="admin%40panvm03%3E&#43;ping&#43;source&#43;10.252.2.29&#43;host&#43;10.252.2.28%0APING&#43;10.252.2.28&#43;%2810.252.2.28%29&#43;from&#43;10.252.2.29&#43;%3A&#43;56%2884%29&#43;bytes&#43;of&#43;data.%0A64&#43;bytes&#43;from&#43;10.252.2.28%3A&#43;icmp_seq%3D1&#43;ttl%3D64&#43;time%3D2.90&#43;ms%0A64&#43;bytes&#43;from&#43;10.252.2.28%3A&#43;icmp_seq%3D2&#43;ttl%3D64&#43;time%3D1.92&#43;ms%0A64&#43;bytes&#43;from&#43;10.252.2.28%3A&#43;icmp_seq%3D3&#43;ttl%3D64&#43;time%3D1.76&#43;ms%0A64&#43;bytes&#43;from&#43;10.252.2.28%3A&#43;icmp_seq%3D4&#43;ttl%3D64&#43;time%3D1.97&#43;ms%0A%5EC%0A---&#43;10.252.2.28&#43;ping&#43;statistics&#43;---%0A4&#43;packets&#43;transmitted%2C&#43;4&#43;received%2C&#43;0%25&#43;packet&#43;loss%2C&#43;time&#43;3003ms%0Artt&#43;min%2Favg%2Fmax%2Fmdev&#43;%3D&#43;1.765%2F2.141%2F2.900%2F0.446&#43;ms"></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h3 id="virtual-router">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#virtual-router">&#8203;​</a>
    </span>
    <span>Virtual Router</span>
  </h3><p>While we will leverage policy-based forwarding to implement policy-based routing, it is still a good idea to configure routing on the Virtual Router.</p>
<p>Cloudflare Magic WAN implements <a href=/magic-wan/reference/traffic-steering/#equal-cost-multi-path-routing class="DocsMarkdown--link"><span class="DocsMarkdown--link-content">equal-cost multi-path (ECMP) routing</span></a> to steer traffic across IPsec tunnels. The default behavior is to load balance traffic equally across both tunnels.</p>
<aside class="DocsMarkdown--aside" role="note" data-type="note"><p>ECMP is disabled on the ​​Palo Alto Networks Next-Generation Firewall by default. Enabling ECMP will force the Virtual Router to restart. While a restart of the Virtual Router is much faster than restarting the entire firewall, it is still recommended that you make this change during a scheduled maintenance window.</p>
</aside>

<h4 id="enable-ecmp">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#enable-ecmp">&#8203;​</a>
    </span>
    <span>Enable ECMP</span>
  </h4><p>First, ensure the General tab displays both the Ethernet and tunnel interfaces. If any of the interfaces are not displayed, either use <strong>Add</strong> to specify the missing interface(s), or visit the Interfaces menu to ensure the relevant Virtual Router is selected.</p>
<p><figure class="image-caption">
    <img alt="Make sure the Ethernet and tunnel interfaces show up in Virtual Router" src="/images/magic-wan/third-party/palo-alto/panw_virtual_router/01_virtual_router_interfaces_hud688370405982a9c417ed71338a93f72_83757_1448x909_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="909" width="1448"
    style="aspect-ratio:1.592970297029703;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<ol>
<li>Open the <strong>Router settings</strong> for the default Virtual Router and select the <strong>ECMP</strong> tab.</li>
<li>Select the checkboxes next to <strong>Enable</strong>, <strong>Symmetric Return</strong>, and <strong>Strict Source Path</strong> (all three checkboxes should be selected).</li>
<li>Under <strong>Load Balance</strong>, change the <strong>Method</strong> from <em>IP Modulo</em> to <em>Weighted Round Robin</em> and add both tunnel interfaces. Ensure the weights match the weights defined in Magic WAN Static Routes (reference the Cloudflare Dashboard).</li>
</ol>
<p><figure class="image-caption">
    <img alt="Make sure all checkboxes are selected" src="/images/magic-wan/third-party/palo-alto/panw_virtual_router/02_virtual_router_ecmp_hua5b84dbbc1586f4a955416d19fceba8a_77572_1453x902_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="902" width="1453"
    style="aspect-ratio:1.6108758314855876;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<p>You can also use the command line to make these changes:</p>
<div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="set&#43;network&#43;virtual-router&#43;default&#43;ecmp&#43;algorithm&#43;weighted-round-robin&#43;interface&#43;tunnel.1&#43;weight&#43;100%0Aset&#43;network&#43;virtual-router&#43;default&#43;ecmp&#43;algorithm&#43;weighted-round-robin&#43;interface&#43;tunnel.2&#43;weight&#43;100%0Aset&#43;network&#43;virtual-router&#43;default&#43;ecmp&#43;enable&#43;yes%0Aset&#43;network&#43;virtual-router&#43;default&#43;ecmp&#43;symmetric-return&#43;yes%0Aset&#43;network&#43;virtual-router&#43;default&#43;ecmp&#43;strict-source-path&#43;yes"></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h4 id="add-static-routes">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#add-static-routes">&#8203;​</a>
    </span>
    <span>Add static routes</span>
  </h4><p>Add two static routes for each Magic WAN Protected Network - one for each of the two tunnel interfaces.</p>
<aside class="DocsMarkdown--aside" role="note" data-type="note"><p>Palo Alto Networks Next-Generation Firewall will not allow for configuring two routes to the same destination with equal metrics - even if they reference different interfaces and ECMP is enabled. The examples provided here use Metric 10 for the route via interface tunnel.1 and Metric 11 for the route via interface tunnel.2.</p>
</aside>

<p>The environment used for this tutorial assumes two Magic WAN Protected Networks:</p>
<ul>
<li><strong>VLAN0010</strong>: <code>10.1.10.0/24</code></li>
<li><strong>VLAN0020</strong>: <code>10.1.20.0/24</code></li>
</ul>
<h5 id="vlan0010-10110024-via-tunnel1">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#vlan0010-10110024-via-tunnel1">&#8203;​</a>
    </span>
    <span>VLAN0010 (<code>10.1.10.0/24</code>) via tunnel.1</span>
  </h5><table>
<thead>
<tr>
<th>Name</th>
<th>Option</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Magic_WAN_VLAN0010_Tun01</code></td>
<td>Destination</td>
<td><em>VLAN0010_10-1-10-0&ndash;24</em></td>
</tr>
<tr>
<td></td>
<td>Interface</td>
<td><em>tunnel.1</em></td>
</tr>
<tr>
<td></td>
<td>Next hop</td>
<td><em>IP Address</em></td>
</tr>
<tr>
<td></td>
<td></td>
<td><em>CF_MWAN_IPsec_VTI_01_Remote</em></td>
</tr>
<tr>
<td></td>
<td>Metric</td>
<td><code>10</code></td>
</tr>
<tr>
<td></td>
<td>Route Table</td>
<td><em>Unicast</em></td>
</tr>
<tr>
<td></td>
<td>BFD Profile</td>
<td><em>Disable BFD</em></td>
</tr>
</tbody>
</table>
<p><figure class="image-caption">
    <img alt="Static Route - VLAN0010 (10.1.10.0/24 via tunnel.1)" src="/images/magic-wan/third-party/palo-alto/panw_virtual_router/03_virtual_router_static_vlan0010_tun01_hu421b0166b865230fc4c9bac846a24505_79565_1094x955_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="955" width="1094"
    style="aspect-ratio:1.1455602094240838;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<h5 id="vlan0010-10110024-via-tunnel2">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#vlan0010-10110024-via-tunnel2">&#8203;​</a>
    </span>
    <span>VLAN0010 (<code>10.1.10.0/24</code>) via tunnel.2</span>
  </h5><table>
<thead>
<tr>
<th>Name</th>
<th>Option</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Magic_WAN_VLAN0010_Tun02</code></td>
<td>Destination</td>
<td><em>VLAN0010_10-1-10-0&ndash;24</em></td>
</tr>
<tr>
<td></td>
<td>Interface</td>
<td><em>tunnel.2</em></td>
</tr>
<tr>
<td></td>
<td>Next hop</td>
<td><em>IP Address</em></td>
</tr>
<tr>
<td></td>
<td></td>
<td><em>CF_MWAN_IPsec_VTI_02_Remote</em></td>
</tr>
<tr>
<td></td>
<td>Metric</td>
<td><code>11</code></td>
</tr>
<tr>
<td></td>
<td>Route Table</td>
<td><em>Unicast</em></td>
</tr>
<tr>
<td></td>
<td>BFD Profile</td>
<td><em>Disable BFD</em></td>
</tr>
</tbody>
</table>
<p><figure class="image-caption">
    <img alt="Static Route - VLAN0010 (10.1.10.0/24 via tunnel.2)" src="/images/magic-wan/third-party/palo-alto/panw_virtual_router/04_virtual_router_static_vlan0010_tun02_hu5de49c84230128564d7cbacd644f256e_79869_1090x955_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="955" width="1090"
    style="aspect-ratio:1.141371727748691;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<h5 id="vlan0020-10120024-via-tunnel1">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#vlan0020-10120024-via-tunnel1">&#8203;​</a>
    </span>
    <span>VLAN0020 (<code>10.1.20.0/24</code>) via tunnel.1</span>
  </h5><table>
<thead>
<tr>
<th>Name</th>
<th>Option</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Magic_WAN_VLAN0020_Tun01</code></td>
<td>Destination</td>
<td><em>VLAN0020_10-1-20-0&ndash;24</em></td>
</tr>
<tr>
<td></td>
<td>Interface</td>
<td><em>tunnel.1</em></td>
</tr>
<tr>
<td></td>
<td>Next hop</td>
<td><em>IP Address</em></td>
</tr>
<tr>
<td></td>
<td></td>
<td><em>CF_MWAN_IPsec_VTI_01_Remote</em></td>
</tr>
<tr>
<td></td>
<td>Metric</td>
<td><code>10</code></td>
</tr>
<tr>
<td></td>
<td>Route Table</td>
<td><em>Unicast</em></td>
</tr>
<tr>
<td></td>
<td>BFD Profile</td>
<td><em>Disable BFD</em></td>
</tr>
</tbody>
</table>
<p><figure class="image-caption">
    <img alt="Static Route - VLAN0020 (10.1.20.0/24 via tunnel.1)" src="/images/magic-wan/third-party/palo-alto/panw_virtual_router/05_virtual_router_static_vlan0020_tun01_hu45d18d52fd466afac8912066b0306343_81323_1090x955_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="955" width="1090"
    style="aspect-ratio:1.141371727748691;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<h5 id="vlan0020-10120024-via-tunnel2">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#vlan0020-10120024-via-tunnel2">&#8203;​</a>
    </span>
    <span>VLAN0020 (<code>10.1.20.0/24</code>) via tunnel.2</span>
  </h5><table>
<thead>
<tr>
<th>Name</th>
<th>Option</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Magic_WAN_VLAN0020_Tun02</code></td>
<td>Destination</td>
<td><em>VLAN0020_10-1-20-0&ndash;24</em></td>
</tr>
<tr>
<td></td>
<td>Interface</td>
<td><em>tunnel.2</em></td>
</tr>
<tr>
<td></td>
<td>Next hop</td>
<td><em>IP Address</em></td>
</tr>
<tr>
<td></td>
<td></td>
<td><em>CF_MWAN_IPsec_VTI_02_Remote</em></td>
</tr>
<tr>
<td></td>
<td>Metric</td>
<td><code>11</code></td>
</tr>
<tr>
<td></td>
<td>Route Table</td>
<td><em>Unicast</em></td>
</tr>
<tr>
<td></td>
<td>BFD Profile</td>
<td><em>Disable BFD</em></td>
</tr>
</tbody>
</table>
<p><figure class="image-caption">
    <img alt="Static Route - VLAN0020 (10.1.20.0/24 via tunnel.1)" src="/images/magic-wan/third-party/palo-alto/panw_virtual_router/06_virtual_router_static_vlan0020_tun02_hu9085a84ec3397c9f49e737cf5cb817fd_80262_1093x957_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="957" width="1093"
    style="aspect-ratio:1.142121212121212;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<p>You can also configure these settings via command line:</p>
<h5 id="vlan0010---10110024">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#vlan0010---10110024">&#8203;​</a>
    </span>
    <span>VLAN0010 - <code>10.1.10.0/24</code></span>
  </h5><div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="set&#43;network&#43;virtual-router&#43;default&#43;routing-table&#43;ip&#43;static-route&#43;Magic_WAN_VLAN0010_Tun01&#43;nexthop&#43;ip-address&#43;CF_MWAN_IPsec_VTI_01_Remote%0Aset&#43;network&#43;virtual-router&#43;default&#43;routing-table&#43;ip&#43;static-route&#43;Magic_WAN_VLAN0010_Tun01&#43;bfd&#43;profile&#43;None%0Aset&#43;network&#43;virtual-router&#43;default&#43;routing-table&#43;ip&#43;static-route&#43;Magic_WAN_VLAN0010_Tun01&#43;interface&#43;tunnel.1%0Aset&#43;network&#43;virtual-router&#43;default&#43;routing-table&#43;ip&#43;static-route&#43;Magic_WAN_VLAN0010_Tun01&#43;metric&#43;10%0Aset&#43;network&#43;virtual-router&#43;default&#43;routing-table&#43;ip&#43;static-route&#43;Magic_WAN_VLAN0010_Tun01&#43;destination&#43;VLAN0010_10-1-10-0--24%0Aset&#43;network&#43;virtual-router&#43;default&#43;routing-table&#43;ip&#43;static-route&#43;Magic_WAN_VLAN0010_Tun01&#43;route-table&#43;unicast%0Aset&#43;network&#43;virtual-router&#43;default&#43;routing-table&#43;ip&#43;static-route&#43;Magic_WAN_VLAN0010_Tun02&#43;nexthop&#43;ip-address&#43;CF_MWAN_IPsec_VTI_02_Remote%0Aset&#43;network&#43;virtual-router&#43;default&#43;routing-table&#43;ip&#43;static-route&#43;Magic_WAN_VLAN0010_Tun02&#43;bfd&#43;profile&#43;None%0Aset&#43;network&#43;virtual-router&#43;default&#43;routing-table&#43;ip&#43;static-route&#43;Magic_WAN_VLAN0010_Tun02&#43;interface&#43;tunnel.2%0Aset&#43;network&#43;virtual-router&#43;default&#43;routing-table&#43;ip&#43;static-route&#43;Magic_WAN_VLAN0010_Tun02&#43;metric&#43;11%0Aset&#43;network&#43;virtual-router&#43;default&#43;routing-table&#43;ip&#43;static-route&#43;Magic_WAN_VLAN0010_Tun02&#43;destination&#43;VLAN0010_10-1-10-0--24%0Aset&#43;network&#43;virtual-router&#43;default&#43;routing-table&#43;ip&#43;static-route&#43;Magic_WAN_VLAN0010_Tun02&#43;route-table&#43;unicast"></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h5 id="vlan0020---10120024">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#vlan0020---10120024">&#8203;​</a>
    </span>
    <span>VLAN0020 - <code>10.1.20.0/24</code></span>
  </h5><div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="set&#43;network&#43;virtual-router&#43;default&#43;routing-table&#43;ip&#43;static-route&#43;Magic_WAN_VLAN0020_Tun01&#43;nexthop&#43;ip-address&#43;CF_MWAN_IPsec_VTI_01_Remote%0Aset&#43;network&#43;virtual-router&#43;default&#43;routing-table&#43;ip&#43;static-route&#43;Magic_WAN_VLAN0020_Tun01&#43;bfd&#43;profile&#43;None%0Aset&#43;network&#43;virtual-router&#43;default&#43;routing-table&#43;ip&#43;static-route&#43;Magic_WAN_VLAN0020_Tun01&#43;interface&#43;tunnel.1%0Aset&#43;network&#43;virtual-router&#43;default&#43;routing-table&#43;ip&#43;static-route&#43;Magic_WAN_VLAN0020_Tun01&#43;metric&#43;10%0Aset&#43;network&#43;virtual-router&#43;default&#43;routing-table&#43;ip&#43;static-route&#43;Magic_WAN_VLAN0020_Tun01&#43;destination&#43;VLAN0020_10-1-20-0--24%0Aset&#43;network&#43;virtual-router&#43;default&#43;routing-table&#43;ip&#43;static-route&#43;Magic_WAN_VLAN0020_Tun01&#43;route-table&#43;unicast%0Aset&#43;network&#43;virtual-router&#43;default&#43;routing-table&#43;ip&#43;static-route&#43;Magic_WAN_VLAN0020_Tun02&#43;nexthop&#43;ip-address&#43;CF_MWAN_IPsec_VTI_02_Remote%0Aset&#43;network&#43;virtual-router&#43;default&#43;routing-table&#43;ip&#43;static-route&#43;Magic_WAN_VLAN0020_Tun02&#43;bfd&#43;profile&#43;None%0Aset&#43;network&#43;virtual-router&#43;default&#43;routing-table&#43;ip&#43;static-route&#43;Magic_WAN_VLAN0020_Tun02&#43;interface&#43;tunnel.2%0Aset&#43;network&#43;virtual-router&#43;default&#43;routing-table&#43;ip&#43;static-route&#43;Magic_WAN_VLAN0020_Tun02&#43;metric&#43;11%0Aset&#43;network&#43;virtual-router&#43;default&#43;routing-table&#43;ip&#43;static-route&#43;Magic_WAN_VLAN0020_Tun02&#43;destination&#43;VLAN0020_10-1-20-0--24%0Aset&#43;network&#43;virtual-router&#43;default&#43;routing-table&#43;ip&#43;static-route&#43;Magic_WAN_VLAN0020_Tun02&#43;route-table&#43;unicast"></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h3 id="magic-health-checks">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#magic-health-checks">&#8203;​</a>
    </span>
    <span>Magic health checks</span>
  </h3><p>Cloudflare crafts ICMP probes which are sent through the IPsec tunnels from random servers across Cloudflare&rsquo;s global anycast network. These ICMP probes are unique because an ICMP reply packet is sent (as opposed to an ICMP Request).</p>
<aside class="DocsMarkdown--aside" role="note" data-type="note"><p>The construct of the security policies may seem counter-intuitive - this is due to the use of ICMP reply probes. As long as you adhere to the recommended policies in this documentation, the bi-directional health checks will work as expected.</p>
</aside>

<p>Cloudflare Magic WAN customers must configure IPsec tunnels to use custom anycast IP addresses for the health check endpoints:</p>
<ul>
<li><strong>CF_Health_Check_Anycast_01</strong>: <code>172.64.240.253</code></li>
<li><strong>CF_Health_Check_Anycast_02</strong>: <code>172.64.240.254</code></li>
</ul>
<h4 id="security-policy---tunnel-health-checks">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#security-policy---tunnel-health-checks">&#8203;​</a>
    </span>
    <span>Security Policy - Tunnel health checks</span>
  </h4><p>You must define a rule to allow the ICMP reply probes as Palo Alto Networks Next-Generation Firewall&rsquo;s default behavior will drop the health checks.</p>
<aside class="DocsMarkdown--aside" role="note" data-type="note"><p>Cloudflare health checks are sent from random servers across Cloudflare&rsquo;s global network and can originate from any addresses within the Cloudflare IPv4 address space represented by the <code>Cloudflare_IPv4_Static_Grp</code>.</p>
</aside>

<h5 id="setup-via-dashboard">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#setup-via-dashboard">&#8203;​</a>
    </span>
    <span>Setup via dashboard</span>
  </h5><div class="DocsMarkdown--table-wrap"><div class="DocsMarkdown--table-wrap-inner">
    <table>
<thead>
<tr>
<th>Name</th>
<th>Option</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Cloudflare_Tunnel_Bidirect_HC</code></td>
<td>Rule Type</td>
<td><em>universal (default)</em></td>
</tr>
<tr>
<td></td>
<td>Description</td>
<td><code>Permit bidirectional HCs</code></td>
</tr>
<tr>
<td></td>
<td>Group Rules By Tag</td>
<td><em>None</em></td>
</tr>
<tr>
<td><strong>Source tab</strong></td>
<td>Source Zone</td>
<td><strong>Cloudflare_L3_Zone</strong></td>
</tr>
<tr>
<td></td>
<td>Source Address</td>
<td><strong>CF_Health_Check_Anycast_01</strong> <br> <strong>CF_Health_Check_Anycast_02</strong></td>
</tr>
<tr>
<td><strong>Destination tab</strong></td>
<td>Destination Zone</td>
<td><strong>Cloudflare_L3_Zone</strong></td>
</tr>
<tr>
<td></td>
<td>Destination Address</td>
<td><strong>Cloudflare_IPv4_Static_Grp</strong></td>
</tr>
<tr>
<td><strong>Application tab</strong></td>
<td>Applications</td>
<td><strong>icmp</strong> <br> <strong>ping</strong></td>
</tr>
<tr>
<td><strong>Actions tab</strong></td>
<td>Action</td>
<td><em>Allow</em></td>
</tr>
<tr>
<td></td>
<td>Log Setting</td>
<td><strong>Log at Session End</strong></td>
</tr>
<tr>
<td></td>
<td>Profile type</td>
<td><em>None</em></td>
</tr>
<tr>
<td></td>
<td>Schedule</td>
<td><em>None</em></td>
</tr>
<tr>
<td></td>
<td>QoS Marking</td>
<td><em>None</em></td>
</tr>
</tbody>
</table>

  </div>
</div>
<p><figure class="image-caption">
    <img alt="Bidirectioanl Health Check Rule - General" src="/images/magic-wan/third-party/palo-alto/panw_security_rules/01_bidirect_hc_general_hu92bb8055fa887afa09449621a08f62c4_56622_1273x687_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="687" width="1273"
    style="aspect-ratio:1.8529985443959243;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="Bidirectioanl Health Check Rule - Source" src="/images/magic-wan/third-party/palo-alto/panw_security_rules/02_bidirect_hc_source_hu77a73e8f3ad8570048e5adf2eda1955a_59878_1268x735_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="735" width="1268"
    style="aspect-ratio:1.7251836734693877;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="Bidirectioanl Health Check Rule - Destination" src="/images/magic-wan/third-party/palo-alto/panw_security_rules/03_bidirect_hc_dest_hu9e45a35bf6fc8d5554a940766232627b_57030_1272x734_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="734" width="1272"
    style="aspect-ratio:1.732983651226158;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="Bidirectioanl Health Check Rule - Apps" src="/images/magic-wan/third-party/palo-alto/panw_security_rules/04_bidirect_hc_apps_hu695949ce4d3f749af17f2d277837f892_54081_1265x689_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="689" width="1265"
    style="aspect-ratio:1.8360087082728591;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="Bidirectioanl Health Check Rule - Service/URL Category" src="/images/magic-wan/third-party/palo-alto/panw_security_rules/05_bidirect_hc_service-url_huf657a46450d66edb065c4d0154607705_46547_1271x695_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="695" width="1271"
    style="aspect-ratio:1.8287913669064748;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="Bidirectioanl Health Check Rule - Action" src="/images/magic-wan/third-party/palo-alto/panw_security_rules/06_bidirect_hc_action_huc2243dcabe5cad6ccd230d047fe6b8c7_73448_1268x640_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="640" width="1268"
    style="aspect-ratio:1.981265625;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<h5 id="setup-via-command-line">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#setup-via-command-line">&#8203;​</a>
    </span>
    <span>Setup via command line</span>
  </h5><div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="set&#43;rulebase&#43;security&#43;rules&#43;Cloudflare_Tunnel_Bidirect_HC&#43;to&#43;Cloudflare_L3_Zone%0Aset&#43;rulebase&#43;security&#43;rules&#43;Cloudflare_Tunnel_Bidirect_HC&#43;from&#43;Cloudflare_L3_Zone%0Aset&#43;rulebase&#43;security&#43;rules&#43;Cloudflare_Tunnel_Bidirect_HC&#43;source&#43;%5B&#43;CF_Health_Check_Anycast_01&#43;CF_Health_Check_Anycast_02&#43;%5D%0Aset&#43;rulebase&#43;security&#43;rules&#43;Cloudflare_Tunnel_Bidirect_HC&#43;destination&#43;Cloudflare_IPv4_Static_Grp%0Aset&#43;rulebase&#43;security&#43;rules&#43;Cloudflare_Tunnel_Bidirect_HC&#43;source-user&#43;any%0Aset&#43;rulebase&#43;security&#43;rules&#43;Cloudflare_Tunnel_Bidirect_HC&#43;category&#43;any%0Aset&#43;rulebase&#43;security&#43;rules&#43;Cloudflare_Tunnel_Bidirect_HC&#43;application&#43;%5B&#43;icmp&#43;ping&#43;%5D%0Aset&#43;rulebase&#43;security&#43;rules&#43;Cloudflare_Tunnel_Bidirect_HC&#43;service&#43;application-default%0Aset&#43;rulebase&#43;security&#43;rules&#43;Cloudflare_Tunnel_Bidirect_HC&#43;hip-profiles&#43;any%0Aset&#43;rulebase&#43;security&#43;rules&#43;Cloudflare_Tunnel_Bidirect_HC&#43;action&#43;allow%0Aset&#43;rulebase&#43;security&#43;rules&#43;Cloudflare_Tunnel_Bidirect_HC&#43;rule-type&#43;universal%0Aset&#43;rulebase&#43;security&#43;rules&#43;Cloudflare_Tunnel_Bidirect_HC&#43;description&#43;%22Permit&#43;bidirectional&#43;HCs%22%0Aset&#43;rulebase&#43;security&#43;rules&#43;Cloudflare_Tunnel_Bidirect_HC&#43;disabled&#43;no%0Aset&#43;rulebase&#43;security&#43;rules&#43;Cloudflare_Tunnel_Bidirect_HC&#43;log-end&#43;yes"></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><aside class="DocsMarkdown--aside" role="note" data-type="note"><p>Logging is enabled on the rule to permit heath checks. While the amount of bandwidth consumed by health checks is negligible, the flows generate a significant number of log entries. You may want to disable logging on this rule once in production, and only enable it if any troubleshooting becomes necessary.</p>
</aside>

<h4 id="policy-based-forwarding---tunnel-health-checks">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#policy-based-forwarding---tunnel-health-checks">&#8203;​</a>
    </span>
    <span>Policy-based forwarding - tunnel health checks</span>
  </h4><p>Traffic matching the Security Rule defined in the last step must be routed symmetrically across the tunnel the ingress traffic was received through. Two policy-based forwarding rules ensure the traffic is routed accordingly.</p>
<p>Ensure have the following:</p>
<ul>
<li><strong>Source Zone</strong>: <code>Cloudflare_L3_Zone</code></li>
<li><strong>Source Addresses</strong>: <code>CF_Health_Check_Anycast_01</code> and <code>CF_Health_Check_Anycast_02</code></li>
<li><strong>Destination Zone</strong>: <code>Cloudflare_L3_Zone</code></li>
<li><strong>Destination Addresses</strong>: <code>Cloudflare_IPv4_Static_Grp</code></li>
<li><strong>Application</strong>: <code>icmp</code> and <code>ping</code></li>
</ul>
<h5 id="set-up-via-dashboard-tunnel1">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#set-up-via-dashboard-tunnel1">&#8203;​</a>
    </span>
    <span>Set up via dashboard tunnel.1</span>
  </h5><div class="DocsMarkdown--table-wrap"><div class="DocsMarkdown--table-wrap-inner">
    <table>
<thead>
<tr>
<th>Name</th>
<th>Option</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>PBF_Cloudflare_Health_Check_01</code></td>
<td>Tags</td>
<td><em>Cloudflare_L3_Zone</em></td>
</tr>
<tr>
<td></td>
<td>Group Rules By Tag</td>
<td><em>None</em></td>
</tr>
<tr>
<td><strong>Source tab</strong></td>
<td>Type</td>
<td><em>Zone</em></td>
</tr>
<tr>
<td></td>
<td>Zone</td>
<td><strong>Cloudflare_L3_Zone</strong></td>
</tr>
<tr>
<td></td>
<td>Source Address</td>
<td><strong>CF_Health_Check_Anycast_01</strong></td>
</tr>
<tr>
<td><strong>Destination/Application/Service tab</strong></td>
<td>Destination Address</td>
<td><strong>Cloudflare_IPv4_Static_Grp</strong></td>
</tr>
<tr>
<td><strong>Forwarding tab</strong></td>
<td>Action</td>
<td><em>Forward</em></td>
</tr>
<tr>
<td></td>
<td>Egress interface</td>
<td><em>tunnel.1</em></td>
</tr>
<tr>
<td></td>
<td>Next Hop</td>
<td><em>IP Address</em></td>
</tr>
<tr>
<td></td>
<td></td>
<td><em>CF_MWAN_IPsec_VTI_01_Remote</em></td>
</tr>
</tbody>
</table>

  </div>
</div>
<p><figure class="image-caption">
    <img alt="Bidirectional Health Checks via tunnel.1 - General" src="/images/magic-wan/third-party/palo-alto/panw_pbf/01_pbf_hc_01_general_hue1b503a8a4fbe7c73079806cba9be90f_52452_1275x651_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="651" width="1275"
    style="aspect-ratio:1.9585407066052227;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="Bidirectional Health Checks via tunnel.1 - Source" src="/images/magic-wan/third-party/palo-alto/panw_pbf/02_pbf_hc_01_source_hue7780aaf6ab418d63c1c0b56226ca476_63977_1268x740_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="740" width="1268"
    style="aspect-ratio:1.713527027027027;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="Bidirectional Health Checks via tunnel.1 - Destination" src="/images/magic-wan/third-party/palo-alto/panw_pbf/03_pbf_hc_01_dest-app-service_hu330289d1838846efa012d071716f105e_55850_1274x746_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="746" width="1274"
    style="aspect-ratio:1.7077882037533512;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="Bidirectional Health Checks via tunnel.1 - Forwarding" src="/images/magic-wan/third-party/palo-alto/panw_pbf/04_pbf_hc_01_forwarding_hu765f73ef800f1b035fdbdbdab01fa4e7_74259_1271x986_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="986" width="1271"
    style="aspect-ratio:1.289056795131846;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<h5 id="set-up-via-dashboard-tunnel2">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#set-up-via-dashboard-tunnel2">&#8203;​</a>
    </span>
    <span>Set up via dashboard tunnel.2</span>
  </h5><div class="DocsMarkdown--table-wrap"><div class="DocsMarkdown--table-wrap-inner">
    <table>
<thead>
<tr>
<th>Name</th>
<th>Option</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>PBF_Cloudflare_Health_Check_02</code></td>
<td>Tags</td>
<td><em>Cloudflare_L3_Zone</em></td>
</tr>
<tr>
<td></td>
<td>Group Rules By Tag</td>
<td><em>None</em></td>
</tr>
<tr>
<td><strong>Source tab</strong></td>
<td>Type</td>
<td><em>Zone</em></td>
</tr>
<tr>
<td></td>
<td>Zone</td>
<td><strong>Cloudflare_L3_Zone</strong></td>
</tr>
<tr>
<td></td>
<td>Source Address</td>
<td><strong>CF_Health_Check_Anycast_02</strong></td>
</tr>
<tr>
<td><strong>Destination/Application/service tab</strong></td>
<td>Destination Address</td>
<td><strong>Cloudflare_IPv4_Static_Grp</strong></td>
</tr>
<tr>
<td><strong>Forwarding tab</strong></td>
<td>Action</td>
<td><em>Forward</em></td>
</tr>
<tr>
<td></td>
<td>Egress interface</td>
<td><em>tunnel.2</em></td>
</tr>
<tr>
<td></td>
<td>Next Hop</td>
<td><em>IP Address</em></td>
</tr>
<tr>
<td></td>
<td></td>
<td><em>CF_MWAN_IPsec_VTI_02_Remote</em></td>
</tr>
</tbody>
</table>

  </div>
</div>
<p><figure class="image-caption">
    <img alt="Bidirectional Health Checks via tunnel.2 - General" src="/images/magic-wan/third-party/palo-alto/panw_pbf/05_pbf_hc_02_general_hu9feba3c8b24c36bbcd0ea45f427a018c_52517_1272x647_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="647" width="1272"
    style="aspect-ratio:1.9660123647604328;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="Bidirectional Health Checks via tunnel.2 - Source" src="/images/magic-wan/third-party/palo-alto/panw_pbf/06_pbf_hc_02_source_hu4f4c753b05dcfda147a6bd11fdb010ef_63277_1272x741_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="741" width="1272"
    style="aspect-ratio:1.7166126855600539;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="Bidirectional Health Checks via tunnel.2 - Destination" src="/images/magic-wan/third-party/palo-alto/panw_pbf/07_pbf_hc_02_dest-app-service_hua5adc7424033884bc7e3ff73b869fd2f_55272_1270x740_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="740" width="1270"
    style="aspect-ratio:1.7162297297297298;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="Bidirectional Health Checks via tunnel.2 - Forwarding" src="/images/magic-wan/third-party/palo-alto/panw_pbf/08_pbf_hc_02_forwarding_hub072f409dd72f32e329d200bf1e2de51_74626_1269x984_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="984" width="1269"
    style="aspect-ratio:1.2896443089430893;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<h5 id="set-up-via-command-line-tunnel1">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#set-up-via-command-line-tunnel1">&#8203;​</a>
    </span>
    <span>Set up via command line tunnel.1</span>
  </h5><div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="set&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Cloudflare_Healthcheck_01&#43;action&#43;forward&#43;nexthop&#43;ip-address&#43;CF_MWAN_IPsec_VTI_01_Remote%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Cloudflare_Healthcheck_01&#43;action&#43;forward&#43;egress-interface&#43;tunnel.1%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Cloudflare_Healthcheck_01&#43;from&#43;zone&#43;Cloudflare_L3_Zone%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Cloudflare_Healthcheck_01&#43;enforce-symmetric-return&#43;enabled&#43;no%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Cloudflare_Healthcheck_01&#43;source&#43;CF_Health_Check_Anycast_01%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Cloudflare_Healthcheck_01&#43;destination&#43;Cloudflare_IPv4_Static_Grp%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Cloudflare_Healthcheck_01&#43;source-user&#43;any%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Cloudflare_Healthcheck_01&#43;application&#43;any%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Cloudflare_Healthcheck_01&#43;service&#43;any%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Cloudflare_Healthcheck_01&#43;tag&#43;Cloudflare_L3_Zone"></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h5 id="set-up-via-command-line-tunnel2">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#set-up-via-command-line-tunnel2">&#8203;​</a>
    </span>
    <span>Set up via command line tunnel.2</span>
  </h5><div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="set&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Cloudflare_Healthcheck_02&#43;action&#43;forward&#43;nexthop&#43;ip-address&#43;CF_MWAN_IPsec_VTI_02_Remote%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Cloudflare_Healthcheck_02&#43;action&#43;forward&#43;egress-interface&#43;tunnel.2%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Cloudflare_Healthcheck_02&#43;from&#43;zone&#43;Cloudflare_L3_Zone%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Cloudflare_Healthcheck_02&#43;enforce-symmetric-return&#43;enabled&#43;no%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Cloudflare_Healthcheck_02&#43;source&#43;CF_Health_Check_Anycast_02%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Cloudflare_Healthcheck_02&#43;destination&#43;Cloudflare_IPv4_Static_Grp%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Cloudflare_Healthcheck_02&#43;source-user&#43;any%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Cloudflare_Healthcheck_02&#43;application&#43;any%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Cloudflare_Healthcheck_02&#43;service&#43;any%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Cloudflare_Healthcheck_02&#43;tag&#43;Cloudflare_L3_Zone"></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h3 id="troubleshooting-tunnel-health-checks">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#troubleshooting-tunnel-health-checks">&#8203;​</a>
    </span>
    <span>Troubleshooting tunnel health checks</span>
  </h3><h4 id="security-policy">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#security-policy">&#8203;​</a>
    </span>
    <span>Security Policy</span>
  </h4><p>Use the Traffic log viewer to ensure that the health check traffic is allowed. Start by adding a rule to filter the logs based on the name of the Security Policy rule permitting the applicable traffic.</p>
<h5 id="filter-by-rule-name">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#filter-by-rule-name">&#8203;​</a>
    </span>
    <span>Filter by rule name</span>
  </h5><div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="rule&#43;eq&#43;Cloudflare_Tunnel_Bidirect_HC"></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><p><figure class="image-caption">
    <img alt="Bidirectional health check logging - Filter by rule name" src="/images/magic-wan/third-party/palo-alto/panw_logging/02_logging_tunnel_hc_filter_rulename_hu54892e76b40cf4976d276c236e21af52_486288_1904x1178_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="1178" width="1904"
    style="aspect-ratio:1.6163073005093378;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<p>If you do not see any traffic matching the filter, replace the filter with one that displays log entries based on the addresses associated with the <code>CF_Health_Check_Anycast_01</code> and <code>CF_Health_Check_Anycast_02</code> Address objects.</p>
<h5 id="filter-by-health-check-anycast-ips">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#filter-by-health-check-anycast-ips">&#8203;​</a>
    </span>
    <span>Filter by health check anycast IPs</span>
  </h5><div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="%28&#43;addr.src&#43;in&#43;172.64.240.253&#43;%29&#43;or&#43;%28&#43;addr.src&#43;in&#43;172.64.240.254&#43;%29"></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><p><figure class="image-caption">
    <img alt="Bidirectional health check logging - filter by health check anycast IPs" src="/images/magic-wan/third-party/palo-alto/panw_logging/01_logging_tunnel_hc_filter_ip_hu2cfccf4c58e1c49fde75886d0b879cba_500475_1905x1238_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="1238" width="1905"
    style="aspect-ratio:1.5387802907915993;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<h4 id="policy-based-forwarding">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#policy-based-forwarding">&#8203;​</a>
    </span>
    <span>Policy-based forwarding</span>
  </h4><p>Troubleshooting policy-based forwarding can be a bit challenging. The ideal way to determine if traffic is flowing through the intended path is to select the detailed view for a log entry.</p>
<ol>
<li>
<p>Select the magnifying glass next to one of the log entries with source IP address <code>172.64.240.253</code>.</p>
</li>
<li>
<p>Traffic originating from <code>CF_Health_Check_Anycast_01</code> (<code>172.64.240.253</code>) should ingress and egress interface tunnel.1.</p>
</li>
</ol>
<p><figure class="image-caption">
    <img alt="Bidirectional Health Check Logging - tunnel.1" src="/images/magic-wan/third-party/palo-alto/panw_logging/03_logging_tunnel_hc_tun01_hu3b48c3aa81536452909fcf89b436b1ca_138402_1446x900_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="900" width="1446"
    style="aspect-ratio:1.6066777777777779;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<ol start="3">
<li>
<p>Select the magnifying glass next to one of the log entries with source IP address <code>172.64.240.254</code>.</p>
</li>
<li>
<p>Traffic originating from <code>CF_Health_Check_Anycast_02</code> (<code>172.64.240.254</code>) should ingress and egress interface tunnel.2.</p>
</li>
</ol>
<p><figure class="image-caption">
    <img alt="Bidirectional Health Check Logging - tunnel.2" src="/images/magic-wan/third-party/palo-alto/panw_logging/04_logging_tunnel_hc_tun02_hu4baaf95a180e1b47175791616b09426a_136009_1444x899_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="899" width="1444"
    style="aspect-ratio:1.6062402669632925;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<p>If the traffic is not ingressing/egressing the same interface, you likely have an issue with the policy-based forwarding rule(s) not matching.</p>
<h3 id="security-policies---production-traffic">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#security-policies---production-traffic">&#8203;​</a>
    </span>
    <span>Security Policies - Production Traffic</span>
  </h3><p>As mentioned earlier, this tutorial includes examples for two different use-cases:</p>
<ul>
<li><strong>Magic WAN</strong>: permit traffic between two or more locations with <a href="https://datatracker.ietf.org/doc/html/rfc1918" class="DocsMarkdown--link" target="_blank" rel="noopener">
  <span class="DocsMarkdown--link-content">RFC-1918</span><span class="DocsMarkdown--link-external-icon" aria-hidden="true">
  <svg fill="none" stroke="currentColor" stroke-width="1.5" width="23px" height="12px" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg">
    <title id="title-4744738674102027">External link icon</title>
    <path d="M6.75,1.75h-5v12.5h12.5v-5m0,-4v-3.5h-3.5M8,8l5.5-5.5"></path>
  </svg>
  <span is-visually-hidden>Open external link</span>
</span></a> private non-routable address space.</li>
<li><strong>Magic WAN with Cloudflare Zero Trust (Gateway egress)</strong>: same as Magic WAN with the addition of outbound Internet access from Magic WAN protected sites egressing the Cloudflare edge network.</li>
</ul>
<h4 id="magic-wan-only">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#magic-wan-only">&#8203;​</a>
    </span>
    <span>Magic WAN only</span>
  </h4><p>Rules must be defined to facilitate traffic from the trust network to the Magic WAN protected sites. While it may be possible to define one rule for traffic in both directions, this example includes two rules:</p>
<ul>
<li>
<p>From Trust to Magic WAN protected sites.</p>
</li>
<li>
<p>From Magic WAN protected sites to Trust.</p>
</li>
</ul>
<h5 id="trust-to-magic-wan-dashboard">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#trust-to-magic-wan-dashboard">&#8203;​</a>
    </span>
    <span>Trust to Magic WAN dashboard</span>
  </h5><div class="DocsMarkdown--table-wrap"><div class="DocsMarkdown--table-wrap-inner">
    <table>
<thead>
<tr>
<th>Name</th>
<th>Option</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Trust_to_Cloudflare_Magic_WAN_Allow</code></td>
<td>Rule Type</td>
<td><em>universal (default)</em></td>
</tr>
<tr>
<td></td>
<td>Group Rules by Tag</td>
<td><em>None</em></td>
</tr>
<tr>
<td><strong>Source tab</strong></td>
<td>Source Zone</td>
<td><strong>Trust_L3_Zone</strong></td>
</tr>
<tr>
<td></td>
<td>Source Address</td>
<td><strong>VLAN0100_10-1-100-0&ndash;24</strong></td>
</tr>
<tr>
<td><strong>Destination tab</strong></td>
<td>Destination Zone</td>
<td><strong>Cloudflare_L3_Zone</strong></td>
</tr>
<tr>
<td></td>
<td>Destination Address</td>
<td><strong>VLAN0010_10-1-10-0&ndash;24</strong> <br> <strong>VLAN0020_10-1-20-0&ndash;24</strong></td>
</tr>
<tr>
<td><strong>Actions tab</strong></td>
<td>Action</td>
<td><em>Allow</em></td>
</tr>
<tr>
<td></td>
<td>Log Setting</td>
<td><strong>Log at Session End</strong></td>
</tr>
<tr>
<td></td>
<td>Profile type</td>
<td><em>None</em></td>
</tr>
<tr>
<td></td>
<td>Schedule</td>
<td><em>None</em></td>
</tr>
<tr>
<td></td>
<td>QoS Marking</td>
<td><em>None</em></td>
</tr>
</tbody>
</table>

  </div>
</div>
<p><figure class="image-caption">
    <img alt="Trust to Magic WAN - General" src="/images/magic-wan/third-party/palo-alto/panw_security_rules/07_trust_to_mwan_general_hu830d1f0a4dec2aff7564b3f457f67afd_55563_1269x693_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="693" width="1269"
    style="aspect-ratio:1.8311832611832612;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="Trust to Magic WAN - Source" src="/images/magic-wan/third-party/palo-alto/panw_security_rules/08_trust_to_mwan_source_hu8edef317473538451ac06dd7e5cad89b_51311_1269x736_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="736" width="1269"
    style="aspect-ratio:1.7241983695652174;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="Trust to Magic WAN - Destination" src="/images/magic-wan/third-party/palo-alto/panw_security_rules/09_trust_to_mwan_dest_hu71773096f03623cc46b845ad7b394f3d_62220_1271x739_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="739" width="1271"
    style="aspect-ratio:1.7199052774018944;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="Trust to Magic WAN - Applications" src="/images/magic-wan/third-party/palo-alto/panw_security_rules/10_trust_to_mwan_apps_hu6232f5adefc82d80ac5e46c7ed88d16b_50184_1267x689_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="689" width="1267"
    style="aspect-ratio:1.838911465892598;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="Trust to Magic WAN - Services/URL Categories" src="/images/magic-wan/third-party/palo-alto/panw_security_rules/11_trust_to_mwan_service-url_huff4571a159ab6559edbb8809aec771ac_46516_1267x695_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="695" width="1267"
    style="aspect-ratio:1.8230359712230215;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="Trust to Magic WAN - Action" src="/images/magic-wan/third-party/palo-alto/panw_security_rules/12_trust_to_mwan_action_huc2243dcabe5cad6ccd230d047fe6b8c7_73448_1268x640_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="640" width="1268"
    style="aspect-ratio:1.981265625;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<h5 id="trust-to-magic-wan-command-line">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#trust-to-magic-wan-command-line">&#8203;​</a>
    </span>
    <span>Trust to Magic WAN command line</span>
  </h5><div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="set&#43;rulebase&#43;security&#43;rules&#43;Trust_to_Cloudflare_Magic_WAN_Allow&#43;to&#43;Cloudflare_L3_Zone%0Aset&#43;rulebase&#43;security&#43;rules&#43;Trust_to_Cloudflare_Magic_WAN_Allow&#43;from&#43;Trust_L3_Zone%0Aset&#43;rulebase&#43;security&#43;rules&#43;Trust_to_Cloudflare_Magic_WAN_Allow&#43;source&#43;VLAN0100_10-1-100-0--24%0Aset&#43;rulebase&#43;security&#43;rules&#43;Trust_to_Cloudflare_Magic_WAN_Allow&#43;destination&#43;%5B&#43;VLAN0010_10-1-10-0--24&#43;VLAN0020_10-1-20-0--24&#43;%5D%0Aset&#43;rulebase&#43;security&#43;rules&#43;Trust_to_Cloudflare_Magic_WAN_Allow&#43;source-user&#43;any%0Aset&#43;rulebase&#43;security&#43;rules&#43;Trust_to_Cloudflare_Magic_WAN_Allow&#43;category&#43;any%0Aset&#43;rulebase&#43;security&#43;rules&#43;Trust_to_Cloudflare_Magic_WAN_Allow&#43;application&#43;any%0Aset&#43;rulebase&#43;security&#43;rules&#43;Trust_to_Cloudflare_Magic_WAN_Allow&#43;service&#43;application-default%0Aset&#43;rulebase&#43;security&#43;rules&#43;Trust_to_Cloudflare_Magic_WAN_Allow&#43;hip-profiles&#43;any%0Aset&#43;rulebase&#43;security&#43;rules&#43;Trust_to_Cloudflare_Magic_WAN_Allow&#43;action&#43;allow%0Aset&#43;rulebase&#43;security&#43;rules&#43;Trust_to_Cloudflare_Magic_WAN_Allow&#43;rule-type&#43;universal"></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h5 id="magic-wan-to-trust-dashboard">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#magic-wan-to-trust-dashboard">&#8203;​</a>
    </span>
    <span>Magic WAN to Trust dashboard</span>
  </h5><div class="DocsMarkdown--table-wrap"><div class="DocsMarkdown--table-wrap-inner">
    <table>
<thead>
<tr>
<th>Name</th>
<th>Option</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Cloudflare_Magic_WAN_to_Trust_Allow</code></td>
<td>Rule Type</td>
<td><em>universal (default)</em></td>
</tr>
<tr>
<td></td>
<td>Group Rules by Tag</td>
<td><em>None</em></td>
</tr>
<tr>
<td>Source tab</td>
<td>Source Zone</td>
<td><strong>Cloudflare_L3_Zone</strong></td>
</tr>
<tr>
<td></td>
<td>Source Address</td>
<td><strong>VLAN0010_10-1-10-0&ndash;24</strong> <br> <strong>VLAN0020_10-1-20-0&ndash;24</strong></td>
</tr>
<tr>
<td>Destination tab</td>
<td>Destination Zone</td>
<td><strong>Trust_L3_Zone</strong></td>
</tr>
<tr>
<td></td>
<td>Destination Address</td>
<td><strong>VLAN0100_10-1-100-0&ndash;24</strong></td>
</tr>
<tr>
<td>Actions tab</td>
<td>Action</td>
<td><em>Allow</em></td>
</tr>
<tr>
<td></td>
<td>Log Setting</td>
<td><strong>Log at Session End</strong></td>
</tr>
<tr>
<td></td>
<td>Profile type</td>
<td><em>None</em></td>
</tr>
<tr>
<td></td>
<td>Schedule</td>
<td><em>None</em></td>
</tr>
<tr>
<td></td>
<td>QoS Marking</td>
<td><em>None</em></td>
</tr>
</tbody>
</table>

  </div>
</div>
<p><figure class="image-caption">
    <img alt="Magic WAN to Trust - General" src="/images/magic-wan/third-party/palo-alto/panw_security_rules/13_mwan_to_trust_general_hu9ffd4ebe8581300c3267f3d31119ca84_55485_1266x689_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="689" width="1266"
    style="aspect-ratio:1.8374600870827287;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="Magic WAN to Trust - Source" src="/images/magic-wan/third-party/palo-alto/panw_security_rules/14_mwan_to_trust_source_hufb58f1e2d3585141e5b79ea3d21a7174_58233_1265x736_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="736" width="1265"
    style="aspect-ratio:1.7187635869565216;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="Magic WAN to Trust - Destination" src="/images/magic-wan/third-party/palo-alto/panw_security_rules/15_mwan_to_trust_dest_hu4b9396d63aff3bd43a7ec12496d16fda_55139_1267x735_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="735" width="1267"
    style="aspect-ratio:1.7238231292517006;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="Magic WAN to Trust - Applications" src="/images/magic-wan/third-party/palo-alto/panw_security_rules/16_mwan_to_trust_apps_hu6616db8d575d7896886985a8dc510740_51730_1259x691_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="691" width="1259"
    style="aspect-ratio:1.822011577424023;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="Magic WAN to Trust - Services/URL Categories" src="/images/magic-wan/third-party/palo-alto/panw_security_rules/17_mwan_to_trust_service-url_hu5ea9342f982f89f8ef0d8ef4c8812c49_46320_1266x697_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="697" width="1266"
    style="aspect-ratio:1.8163701578192253;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="Magic WAN to Trust - Action" src="/images/magic-wan/third-party/palo-alto/panw_security_rules/18_mwan_to_trust_action_hubcabfa8fc243752604eb23b8cbaca4e9_72943_1271x644_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="644" width="1271"
    style="aspect-ratio:1.9736180124223601;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<h5 id="magic-wan-to-trust-command-line">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#magic-wan-to-trust-command-line">&#8203;​</a>
    </span>
    <span>Magic WAN to Trust command line</span>
  </h5><div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="set&#43;rulebase&#43;security&#43;rules&#43;Cloudflare_Magic_WAN_to_Trust_Allow&#43;to&#43;Trust_L3_Zone%0Aset&#43;rulebase&#43;security&#43;rules&#43;Cloudflare_Magic_WAN_to_Trust_Allow&#43;from&#43;Cloudflare_L3_Zone%0Aset&#43;rulebase&#43;security&#43;rules&#43;Cloudflare_Magic_WAN_to_Trust_Allow&#43;source&#43;%5B&#43;VLAN0010_10-1-10-0--24&#43;VLAN0020_10-1-20-0--24&#43;%5D%0Aset&#43;rulebase&#43;security&#43;rules&#43;Cloudflare_Magic_WAN_to_Trust_Allow&#43;destination&#43;VLAN0100_10-1-100-0--24%0Aset&#43;rulebase&#43;security&#43;rules&#43;Cloudflare_Magic_WAN_to_Trust_Allow&#43;source-user&#43;any%0Aset&#43;rulebase&#43;security&#43;rules&#43;Cloudflare_Magic_WAN_to_Trust_Allow&#43;category&#43;any%0Aset&#43;rulebase&#43;security&#43;rules&#43;Cloudflare_Magic_WAN_to_Trust_Allow&#43;application&#43;any%0Aset&#43;rulebase&#43;security&#43;rules&#43;Cloudflare_Magic_WAN_to_Trust_Allow&#43;service&#43;application-default%0Aset&#43;rulebase&#43;security&#43;rules&#43;Cloudflare_Magic_WAN_to_Trust_Allow&#43;hip-profiles&#43;any%0Aset&#43;rulebase&#43;security&#43;rules&#43;Cloudflare_Magic_WAN_to_Trust_Allow&#43;action&#43;allow%0Aset&#43;rulebase&#43;security&#43;rules&#43;Cloudflare_Magic_WAN_to_Trust_Allow&#43;rule-type&#43;universal"></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h3 id="policy-based-forwarding---production-traffic">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#policy-based-forwarding---production-traffic">&#8203;​</a>
    </span>
    <span>Policy-based forwarding - production traffic</span>
  </h3><p>Whether traffic ingresses or egresses ​​Palo Alto Networks Next-Generation Firewall​​, it is important to ensure that traffic is routed symmetrically. This is accomplished through the use of policy-based forwarding.</p>
<p>Policy-based forwarding rules are only required for egress traffic.</p>
<p>Any traffic destined for Magic WAN protected sites or Magic WAN protected sites with Gateway egress must be routed across the IPsec tunnels.</p>
<aside class="DocsMarkdown--aside" role="note" data-type="note"><p>Security rules match traffic flows based on source and destination zone. Policy-based forwarding rules are applied per interface. Therefore, two policy-based forwarding rules are required for every one security rule - one for tunnel.1 and one for tunnel.2.</p>
</aside>

<h4 id="dashboard-policy-based-forwarding---magic-wan-production-traffic-via-tunnel1">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#dashboard-policy-based-forwarding---magic-wan-production-traffic-via-tunnel1">&#8203;​</a>
    </span>
    <span>Dashboard policy-based forwarding - Magic WAN production traffic via tunnel.1</span>
  </h4><div class="DocsMarkdown--table-wrap"><div class="DocsMarkdown--table-wrap-inner">
    <table>
<thead>
<tr>
<th>Name</th>
<th>Option</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>PBF_Magic_WAN_Sites_01</code></td>
<td>Group Rules by Tag</td>
<td><em>None</em></td>
</tr>
<tr>
<td><strong>Source tab</strong></td>
<td>Type</td>
<td><em>Zone</em></td>
</tr>
<tr>
<td></td>
<td>Zone</td>
<td><strong>Trust_L3_Zone</strong></td>
</tr>
<tr>
<td></td>
<td>Source Address</td>
<td><strong>VLAN0100_10-1-100-0&ndash;24</strong></td>
</tr>
<tr>
<td><strong>Destination/Application/Service tab</strong></td>
<td>Destination Address</td>
<td><strong>VLAN0010_10-1-10-0&ndash;24</strong> <br> <strong>VLAN0020_10-1-20-0&ndash;24</strong></td>
</tr>
<tr>
<td><strong>Forwarding tab</strong></td>
<td>Action</td>
<td><em>Forward</em></td>
</tr>
<tr>
<td></td>
<td>Egress Interface</td>
<td><em>tunnel.1</em></td>
</tr>
<tr>
<td></td>
<td>Next hop</td>
<td><em>IP Address</em></td>
</tr>
<tr>
<td></td>
<td></td>
<td><em>CF_MWAN_IPsec_VTI_01_Remote</em></td>
</tr>
</tbody>
</table>

  </div>
</div>
<p><figure class="image-caption">
    <img alt="PBF: Trust to Magic WAN via tunnel.1 - General" src="/images/magic-wan/third-party/palo-alto/panw_pbf/09_pbf_mwan_sites_tun01_general_hub57d7ad4e0c5707628d034b651cd5622_48579_1271x646_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="646" width="1271"
    style="aspect-ratio:1.9675077399380805;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="PBF: Trust to Magic WAN via tunnel.1 - Source" src="/images/magic-wan/third-party/palo-alto/panw_pbf/10_pbf_mwan_sites_tun01_source_hu0546cb984f6d641f9127d7adc25b828e_62053_1268x738_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="738" width="1268"
    style="aspect-ratio:1.7181707317073172;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="PBF: Trust to Magic WAN via tunnel.1 - Destinations" src="/images/magic-wan/third-party/palo-alto/panw_pbf/11_pbf_mwan_sites_tun01_dest-app-service_hu3fce180cf1a5b58a964879206a2d3ff3_60040_1273x741_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="741" width="1273"
    style="aspect-ratio:1.7179622132253711;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="PBF: Trust to Magic WAN via tunnel.1 - Forwarding" src="/images/magic-wan/third-party/palo-alto/panw_pbf/12_pbf_mwan_sites_tun01_forwarding_hu996db39adf686da43765ffc6b308522c_74191_1268x982_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="982" width="1268"
    style="aspect-ratio:1.2912525458248472;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<h4 id="command-line-policy-based-forwarding---magic-wan-production-traffic-via-tunnel1">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#command-line-policy-based-forwarding---magic-wan-production-traffic-via-tunnel1">&#8203;​</a>
    </span>
    <span>Command line policy-based forwarding - Magic WAN production traffic via tunnel.1</span>
  </h4><div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="set&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Magic_WAN_Sites_01&#43;action&#43;forward&#43;nexthop&#43;ip-address&#43;CF_MWAN_IPsec_VTI_01_Remote%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Magic_WAN_Sites_01&#43;action&#43;forward&#43;egress-interface&#43;tunnel.1%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Magic_WAN_Sites_01&#43;from&#43;zone&#43;Trust_L3_Zone%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Magic_WAN_Sites_01&#43;enforce-symmetric-return&#43;enabled&#43;no%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Magic_WAN_Sites_01&#43;source&#43;VLAN0100_10-1-100-0--24%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Magic_WAN_Sites_01&#43;destination&#43;%5B&#43;VLAN0010_10-1-10-0--24&#43;VLAN0020_10-1-20-0--24&#43;%5D%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Magic_WAN_Sites_01&#43;source-user&#43;any%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Magic_WAN_Sites_01&#43;application&#43;any%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Magic_WAN_Sites_01&#43;service&#43;any%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Magic_WAN_Sites_01&#43;disabled&#43;no%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Magic_WAN_Sites_01&#43;negate-destination&#43;no"></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h4 id="dashboard-policy-based-forwarding---magic-wan-production-traffic-via-tunnel2">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#dashboard-policy-based-forwarding---magic-wan-production-traffic-via-tunnel2">&#8203;​</a>
    </span>
    <span>Dashboard policy-based forwarding - Magic WAN production traffic via tunnel.2</span>
  </h4><div class="DocsMarkdown--table-wrap"><div class="DocsMarkdown--table-wrap-inner">
    <table>
<thead>
<tr>
<th>Name</th>
<th>Option</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>PBF_Magic_WAN_sites_02</code></td>
<td>Group Rules by Tag</td>
<td><em>None</em></td>
</tr>
<tr>
<td><strong>Source tab</strong></td>
<td>Type</td>
<td><em>Zone</em></td>
</tr>
<tr>
<td></td>
<td>Zone</td>
<td><strong>Trust_L3_Zone</strong></td>
</tr>
<tr>
<td></td>
<td>Source Address</td>
<td><strong>VLAN0100_10-1-100-0&ndash;24</strong></td>
</tr>
<tr>
<td><strong>Destination/Application/Service tab</strong></td>
<td>Destination Address</td>
<td><strong>VLAN0010_10-1-10-0&ndash;24</strong> <br> <strong>VLAN0020_10-1-20-0&ndash;24</strong></td>
</tr>
<tr>
<td><strong>Forwarding tab</strong></td>
<td>Action</td>
<td><em>Forward</em></td>
</tr>
<tr>
<td></td>
<td>Egress Interface</td>
<td><em>tunnel.2</em></td>
</tr>
<tr>
<td></td>
<td>Next hop</td>
<td><em>IP Address</em></td>
</tr>
<tr>
<td></td>
<td></td>
<td><em>CF_MWAN_IPsec_VTI_02_Remote</em></td>
</tr>
</tbody>
</table>

  </div>
</div>
<p><figure class="image-caption">
    <img alt="PBF: Trust to Magic WAN via tunnel.2 - General" src="/images/magic-wan/third-party/palo-alto/panw_pbf/13_pbf_mwan_sites_tun02_general_hu5ec09594ec580658159194347b851933_48712_1266x644_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="644" width="1266"
    style="aspect-ratio:1.9658540372670807;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="PBF: Trust to Magic WAN via tunnel.2 - Source" src="/images/magic-wan/third-party/palo-alto/panw_pbf/14_pbf_mwan_sites_tun02_source_hue262d1a479a2f413273719a569c7ae1a_60753_1262x736_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="736" width="1262"
    style="aspect-ratio:1.7146875;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="PBF: Trust to Magic WAN via tunnel.2 - Destinations" src="/images/magic-wan/third-party/palo-alto/panw_pbf/15_pbf_mwan_sites_tun02_dest-app-service_hu516132da40cd809d0472955597ba9a9f_60000_1268x738_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="738" width="1268"
    style="aspect-ratio:1.7181707317073172;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="PBF: Trust to Magic WAN via tunnel.2 - Forwarding" src="/images/magic-wan/third-party/palo-alto/panw_pbf/16_pbf_mwan_sites_tun02_forwarding_hu10020225d466a7a59ec18f9faf0b0a4d_74639_1271x983_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="983" width="1271"
    style="aspect-ratio:1.2929908443540183;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<h4 id="command-line-policy-based-forwarding---tunnel2">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#command-line-policy-based-forwarding---tunnel2">&#8203;​</a>
    </span>
    <span>Command line policy-based forwarding - tunnel.2</span>
  </h4><div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="set&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Magic_WAN_Sites_02&#43;action&#43;forward&#43;nexthop&#43;ip-address&#43;CF_MWAN_IPsec_VTI_02_Remote%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Magic_WAN_Sites_02&#43;action&#43;forward&#43;egress-interface&#43;tunnel.2%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Magic_WAN_Sites_02&#43;from&#43;zone&#43;Trust_L3_Zone%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Magic_WAN_Sites_02&#43;enforce-symmetric-return&#43;enabled&#43;no%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Magic_WAN_Sites_02&#43;source&#43;VLAN0100_10-1-100-0--24%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Magic_WAN_Sites_02&#43;destination&#43;%5B&#43;VLAN0010_10-1-10-0--24&#43;VLAN0020_10-1-20-0--24&#43;%5D%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Magic_WAN_Sites_02&#43;source-user&#43;any%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Magic_WAN_Sites_02&#43;application&#43;any%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Magic_WAN_Sites_02&#43;service&#43;any%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Magic_WAN_Sites_02&#43;disabled&#43;no%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_Magic_WAN_Sites_02&#43;negate-destination&#43;no"></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h2 id="magic-wan-with-cloudflare-zero-trust-gateway-egress">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#magic-wan-with-cloudflare-zero-trust-gateway-egress">&#8203;​</a>
    </span>
    <span>Magic WAN with Cloudflare Zero Trust (Gateway egress)</span>
  </h2><p>This section covers adding in support for the use of Cloudflare Gateway. Adding Cloudflare Gateway allows you to set up policies to inspect outbound traffic to the Internet through DNS, network, HTTP and egress filtering.</p>
<p>This use case can be supported in one of two ways:</p>
<ul>
<li>
<p><strong>Option 1</strong></p>
<ul>
<li><strong>Security Rule</strong>: Extend the scope of the <code>Trust_to_Cloudflare_Magic_WAN_Allow</code> rule to allow any destination address.</li>
<li><strong>Policy-Based Forwarding</strong>: Extend the scope of <code>PBF_Magic_WAN_Sites_01</code> and <code>PBF_Magic_WAN_Sites_02</code> to allow any destination address.</li>
</ul>
</li>
<li>
<p><strong>Option 2</strong></p>
<ul>
<li><strong>Security Rule</strong>: Add a new rule below <code>Trust_to_Cloudflare_Magic_WAN_Allow</code> called <code>Trust_to_MWAN_Gateway_Egress_Allow</code> to allow traffic to any destination address except for the Magic WAN Protected Sites (using the Negate option).</li>
<li><strong>Policy-Based Forwarding</strong>: Add a new rule below <code>PBF_Magic_WAN_Sites_01</code> and <code>PBF_Magic_WAN_Sites_02</code> to allow any destination address except for the Magic WAN Protected Sites (using the Negate option).</li>
</ul>
</li>
</ul>
<p>The following examples are based on Option 2.</p>
<aside class="DocsMarkdown--aside" role="note" data-type="note"><p>This example assumes the security rules and policy-based forwarding rules from the previous sections have been configured and are directly above the rules configured in this section.</p>
<p>Also, traffic from Trust to the Internet would typically be defined as <code>Trust_L3_Zone</code> to <code>Untrust_L3_Zone</code>. However, since egress Internet traffic will be routed through the Magic IPsec tunnels, the rule must reference <code>Trust_L3_Zone</code> to <code>Cloudflare_L3_Zone</code>.</p>
</aside>

<h3 id="security-rule-trust-to-gateway-egress">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#security-rule-trust-to-gateway-egress">&#8203;​</a>
    </span>
    <span>Security Rule: Trust to Gateway Egress</span>
  </h3><h4 id="dashboard">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#dashboard">&#8203;​</a>
    </span>
    <span>Dashboard</span>
  </h4><div class="DocsMarkdown--table-wrap"><div class="DocsMarkdown--table-wrap-inner">
    <table>
<thead>
<tr>
<th>Name</th>
<th>Option</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Trust_to_MWAN_Gateway_Egress_Allow</code></td>
<td>Rule Type</td>
<td><em>universal (default)</em></td>
</tr>
<tr>
<td></td>
<td>Group Rules By Tag</td>
<td><em>None</em></td>
</tr>
<tr>
<td><strong>Source tab</strong></td>
<td>Source Zone</td>
<td><strong>Trust_L3_Zone</strong></td>
</tr>
<tr>
<td><strong>Destination tab</strong></td>
<td>Destination Zone</td>
<td><strong>Cloudflare_L3_Zone</strong></td>
</tr>
<tr>
<td></td>
<td>Destination Address</td>
<td><strong>VLAN0010_10-1-10-0&ndash;24</strong> <br> <strong>VLAN0020_10-1-20-0&ndash;24</strong> <br> <strong>Negate</strong></td>
</tr>
<tr>
<td><strong>Actions tab</strong></td>
<td>Action</td>
<td><em>Allow</em></td>
</tr>
<tr>
<td></td>
<td>Log Setting</td>
<td><strong>Log at Session End</strong></td>
</tr>
<tr>
<td></td>
<td>Profile Type</td>
<td><em>None</em></td>
</tr>
<tr>
<td></td>
<td>Schedule</td>
<td><em>None</em></td>
</tr>
<tr>
<td></td>
<td>QoS Marking</td>
<td><em>None</em></td>
</tr>
</tbody>
</table>

  </div>
</div>
<p><figure class="image-caption">
    <img alt="Trust to MWAN Egress - General" src="/images/magic-wan/third-party/palo-alto/panw_mwan_egress/01_trust_mwan_egress_general_hu259b25a16b6c73786bff811dd7263599_55888_1266x683_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="683" width="1266"
    style="aspect-ratio:1.853601756954612;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="Trust to MWAN Egress - Source" src="/images/magic-wan/third-party/palo-alto/panw_mwan_egress/02_trust_mwan_egress_source_hu27f087bcc64d22e6ce39111e4226c605_50170_1262x731_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="731" width="1262"
    style="aspect-ratio:1.7264158686730506;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="Trust to MWAN Egress - Destination" src="/images/magic-wan/third-party/palo-alto/panw_mwan_egress/03__trust_mwan_egress_destination_hu52311b5f94c6f5e1d8330545e9f48b2f_69773_1265x736_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="736" width="1265"
    style="aspect-ratio:1.7187635869565216;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="Trust to MWAN Egress - Applications" src="/images/magic-wan/third-party/palo-alto/panw_mwan_egress/04_trust_mwan_egress_apps_hu94f27420b6bb20881a541fe84c29cc34_51746_1267x688_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="688" width="1267"
    style="aspect-ratio:1.8415843023255813;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="Trust to MWAN Egress - Services/URL Categories" src="/images/magic-wan/third-party/palo-alto/panw_mwan_egress/05_trust_mwan_egress_service-url_huea18e302a007feb532394a418349e8d6_46285_1272x694_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="694" width="1272"
    style="aspect-ratio:1.8328674351585015;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="Trust to MWAN Egress - Action" src="/images/magic-wan/third-party/palo-alto/panw_mwan_egress/06_trust_mwan_egress_actions_hu65cd9c7ddd1e801237d1cf040e9a9036_72850_1265x635_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="635" width="1265"
    style="aspect-ratio:1.9921417322834645;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<h4 id="command-line">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#command-line">&#8203;​</a>
    </span>
    <span>Command line</span>
  </h4><div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="set&#43;rulebase&#43;security&#43;rules&#43;Trust_to_MWAN_Gateway_Egress_Allow&#43;to&#43;Cloudflare_L3_Zone%0Aset&#43;rulebase&#43;security&#43;rules&#43;Trust_to_MWAN_Gateway_Egress_Allow&#43;from&#43;Trust_L3_Zone%0Aset&#43;rulebase&#43;security&#43;rules&#43;Trust_to_MWAN_Gateway_Egress_Allow&#43;source&#43;any%0Aset&#43;rulebase&#43;security&#43;rules&#43;Trust_to_MWAN_Gateway_Egress_Allow&#43;destination&#43;%5B&#43;VLAN0010_10-1-10-0--24&#43;VLAN0020_10-1-20-0--24&#43;%5D%0Aset&#43;rulebase&#43;security&#43;rules&#43;Trust_to_MWAN_Gateway_Egress_Allow&#43;source-user&#43;any%0Aset&#43;rulebase&#43;security&#43;rules&#43;Trust_to_MWAN_Gateway_Egress_Allow&#43;category&#43;any%0Aset&#43;rulebase&#43;security&#43;rules&#43;Trust_to_MWAN_Gateway_Egress_Allow&#43;application&#43;any%0Aset&#43;rulebase&#43;security&#43;rules&#43;Trust_to_MWAN_Gateway_Egress_Allow&#43;service&#43;application-default%0Aset&#43;rulebase&#43;security&#43;rules&#43;Trust_to_MWAN_Gateway_Egress_Allow&#43;hip-profiles&#43;any%0Aset&#43;rulebase&#43;security&#43;rules&#43;Trust_to_MWAN_Gateway_Egress_Allow&#43;action&#43;allow%0Aset&#43;rulebase&#43;security&#43;rules&#43;Trust_to_MWAN_Gateway_Egress_Allow&#43;rule-type&#43;universal%0Aset&#43;rulebase&#43;security&#43;rules&#43;Trust_to_MWAN_Gateway_Egress_Allow&#43;negate-destination&#43;yes"></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h3 id="policy-based-forwarding-trust-to-gateway-egress-via-tunnel1">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#policy-based-forwarding-trust-to-gateway-egress-via-tunnel1">&#8203;​</a>
    </span>
    <span>Policy-based forwarding: Trust to Gateway egress via tunnel.1</span>
  </h3><h4 id="dashboard-1">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#dashboard-1">&#8203;​</a>
    </span>
    <span>Dashboard</span>
  </h4><div class="DocsMarkdown--table-wrap"><div class="DocsMarkdown--table-wrap-inner">
    <table>
<thead>
<tr>
<th>Name</th>
<th>Option</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>PBF_MWAN_Egress01</code></td>
<td>Group Rules By Tag</td>
<td><em>None</em></td>
</tr>
<tr>
<td><strong>Source tab</strong></td>
<td>Source Zone</td>
<td><strong>Trust_L3_Zone</strong></td>
</tr>
<tr>
<td><strong>Destination/Application/Service tab</strong></td>
<td>Destination Address</td>
<td><strong>VLAN0010_10-1-10-0&ndash;24</strong> <br> <strong>VLAN0020_10-1-20-0&ndash;24</strong> <br> <strong>Negate</strong></td>
</tr>
<tr>
<td><strong>Forwarding tab</strong></td>
<td>Action</td>
<td><em>Forward</em></td>
</tr>
<tr>
<td></td>
<td>Egress Interface</td>
<td><em>tunnel.1</em></td>
</tr>
<tr>
<td></td>
<td>Next Hop</td>
<td><em>IP Address</em></td>
</tr>
<tr>
<td></td>
<td></td>
<td><em>CF_MWAN_IPsec_VTI_01_Remote</em></td>
</tr>
</tbody>
</table>

  </div>
</div>
<p><figure class="image-caption">
    <img alt="PBF: Trust to Magic WAN Egress via tunnel.1 - General" src="/images/magic-wan/third-party/palo-alto/panw_mwan_egress/07_pbf_trust_mwan_egress_tun01_general_hu3b057ace00613ebe5f673012e60ab2aa_47705_1265x646_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="646" width="1265"
    style="aspect-ratio:1.958219814241486;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="PBF: Trust to Magic WAN via tunnel.1 - Source" src="/images/magic-wan/third-party/palo-alto/panw_mwan_egress/02_trust_mwan_egress_source_hu27f087bcc64d22e6ce39111e4226c605_50170_1262x731_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="731" width="1262"
    style="aspect-ratio:1.7264158686730506;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="PBF: Trust to Magic WAN via tunnel.1 - Destinations" src="/images/magic-wan/third-party/palo-alto/panw_mwan_egress/09_pbf_trust_mwan_egress_tun01_dest_hu08b9f5d4bf679eab9bdd7661d004c2fa_68969_1278x734_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="734" width="1278"
    style="aspect-ratio:1.741158038147139;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="PBF: Trust to Magic WAN via tunnel.1 - Forwarding" src="/images/magic-wan/third-party/palo-alto/panw_mwan_egress/10_pbf_trust_mwan_egress_tun01_forward_hu6a4b54923eb87ef754d538b88e7fb0d4_73638_1272x986_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="986" width="1272"
    style="aspect-ratio:1.2900709939148074;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<h4 id="command-line-1">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#command-line-1">&#8203;​</a>
    </span>
    <span>Command line</span>
  </h4><div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="set&#43;rulebase&#43;pbf&#43;rules&#43;PBF_MWAN_Egress_01&#43;action&#43;forward&#43;nexthop&#43;ip-address&#43;CF_MWAN_IPsec_VTI_01_Remote%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_MWAN_Egress_01&#43;action&#43;forward&#43;egress-interface&#43;tunnel.1%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_MWAN_Egress_01&#43;from&#43;zone&#43;Trust_L3_Zone%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_MWAN_Egress_01&#43;enforce-symmetric-return&#43;enabled&#43;no%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_MWAN_Egress_01&#43;source&#43;VLAN0100_10-1-100-0--24%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_MWAN_Egress_01&#43;destination&#43;%5B&#43;VLAN0010_10-1-10-0--24&#43;VLAN0020_10-1-20-0--24&#43;%5D%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_MWAN_Egress_01&#43;source-user&#43;any%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_MWAN_Egress_01&#43;application&#43;any%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_MWAN_Egress_01&#43;service&#43;any%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_MWAN_Egress_01&#43;disabled&#43;no%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_MWAN_Egress_01&#43;negate-destination&#43;yes"></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h3 id="policy-based-forwarding-trust-to-gateway-egress-via-tunnel2">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#policy-based-forwarding-trust-to-gateway-egress-via-tunnel2">&#8203;​</a>
    </span>
    <span>Policy-based forwarding: Trust to Gateway egress via tunnel.2</span>
  </h3><h4 id="dashboard-2">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#dashboard-2">&#8203;​</a>
    </span>
    <span>Dashboard</span>
  </h4><div class="DocsMarkdown--table-wrap"><div class="DocsMarkdown--table-wrap-inner">
    <table>
<thead>
<tr>
<th>Name</th>
<th>Option</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>PBF_MWAN_Egress02</code></td>
<td>Group Rules By Tag</td>
<td><em>None</em></td>
</tr>
<tr>
<td><strong>Source tab</strong></td>
<td>Source Zone</td>
<td><strong>Trust_L3_Zone</strong></td>
</tr>
<tr>
<td></td>
<td>Source Address</td>
<td><strong>VLAN0100_10-1-100-0&ndash;24</strong></td>
</tr>
<tr>
<td><strong>Destination/Application/Service tab</strong></td>
<td>Destination Address</td>
<td><strong>VLAN0010_10-1-10-0&ndash;24</strong> <br> <strong>VLAN0020_10-1-20-0&ndash;24</strong> <br> <strong>Negate</strong></td>
</tr>
<tr>
<td><strong>Forwarding tab</strong></td>
<td>Action</td>
<td><em>Forward</em></td>
</tr>
<tr>
<td></td>
<td>Egress Interface</td>
<td><em>tunnel.2</em></td>
</tr>
<tr>
<td></td>
<td>Next Hop</td>
<td><em>IP Address</em></td>
</tr>
<tr>
<td></td>
<td></td>
<td><em>CF_MWAN_IPsec_VTI_02_Remote</em></td>
</tr>
</tbody>
</table>

  </div>
</div>
<p><figure class="image-caption">
    <img alt="PBF: Trust to Magic WAN Egress via tunnel.2 - General" src="/images/magic-wan/third-party/palo-alto/panw_mwan_egress/11_pbf_trust_mwan_egress_tun02_general_hu4b4a3aa54ceba40eb2d3c508dca8abaa_47863_1262x645_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="645" width="1262"
    style="aspect-ratio:1.9566046511627906;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="PBF: Trust to Magic WAN via tunnel.2 - Source" src="/images/magic-wan/third-party/palo-alto/panw_mwan_egress/12_pbf_trust_mwan_egress_tun02_source_huee0066ea0a40bf02eb7778cd42a4373e_61220_1259x735_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="735" width="1259"
    style="aspect-ratio:1.7129387755102041;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="PBF: Trust to Magic WAN via tunnel.2 - Destinations" src="/images/magic-wan/third-party/palo-alto/panw_mwan_egress/13_pbf_trust_mwan_egress_tun02_dest_hu83e7b2b234badb775b9a93140f708254_68141_1270x738_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="738" width="1270"
    style="aspect-ratio:1.720880758807588;height: auto;"/>
    <figcaption></figcaption>
</figure>
<figure class="image-caption">
    <img alt="PBF: Trust to Magic WAN via tunnel.2 - Forwarding" src="/images/magic-wan/third-party/palo-alto/panw_mwan_egress/14_pbf_trust_mwan_egress_tun02_forward_hu8aab1a640f49f54815f8f60d457bde9b_73912_1264x980_resize_q75_box_3.png" loading="lazy" class="image-figure lightbox"
    height="980" width="1264"
    style="aspect-ratio:1.2898061224489796;height: auto;"/>
    <figcaption></figcaption>
</figure></p>
<h4 id="command-line-2">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#command-line-2">&#8203;​</a>
    </span>
    <span>Command line</span>
  </h4><div class="code-container">
    <unparsed-codeblock data-language="bash" data-code="set&#43;rulebase&#43;pbf&#43;rules&#43;PBF_MWAN_Egress_02&#43;action&#43;forward&#43;nexthop&#43;ip-address&#43;CF_MWAN_IPsec_VTI_02_Remote%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_MWAN_Egress_02&#43;action&#43;forward&#43;egress-interface&#43;tunnel.2%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_MWAN_Egress_02&#43;from&#43;zone&#43;Trust_L3_Zone%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_MWAN_Egress_02&#43;enforce-symmetric-return&#43;enabled&#43;no%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_MWAN_Egress_02&#43;source&#43;VLAN0100_10-1-100-0--24%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_MWAN_Egress_02&#43;destination&#43;%5B&#43;VLAN0010_10-1-10-0--24&#43;VLAN0020_10-1-20-0--24&#43;%5D%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_MWAN_Egress_02&#43;source-user&#43;any%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_MWAN_Egress_02&#43;application&#43;any%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_MWAN_Egress_02&#43;service&#43;any%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_MWAN_Egress_02&#43;disabled&#43;no%0Aset&#43;rulebase&#43;pbf&#43;rules&#43;PBF_MWAN_Egress_02&#43;negate-destination&#43;yes"></unparsed-codeblock>
    <vue-component name="CodeCopy"></vue-component>
</div><h2 id="troubleshooting">
    <span class="DocsMarkdown--header-anchor-positioner">
      <a class="DocsMarkdown--header-anchor Link Link-without-underline" href="#troubleshooting">&#8203;​</a>
    </span>
    <span>Troubleshooting</span>
  </h2><p>Cloudflare recommends you consult <a href="https://docs.paloaltonetworks.com/pan-os/9-1/pan-os-admin/vpns/set-up-site-to-site-vpn/interpret-vpn-error-messages" class="DocsMarkdown--link" target="_blank" rel="noopener">
  <span class="DocsMarkdown--link-content">PAN-OS 9.1 Administrators Guide - Interpret VPN Error Messages</span><span class="DocsMarkdown--link-external-icon" aria-hidden="true">
  <svg fill="none" stroke="currentColor" stroke-width="1.5" width="23px" height="12px" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg">
    <title id="title-4744738674102027">External link icon</title>
    <path d="M6.75,1.75h-5v12.5h12.5v-5m0,-4v-3.5h-3.5M8,8l5.5-5.5"></path>
  </svg>
  <span is-visually-hidden>Open external link</span>
</span></a> and <a href="https://docs.paloaltonetworks.com/pan-os/10-2/pan-os-admin/vpns/set-up-site-to-site-vpn/interpret-vpn-error-messages" class="DocsMarkdown--link" target="_blank" rel="noopener">
  <span class="DocsMarkdown--link-content">PAN-OS 10.2 Administrators Guide - Interpret VPN Error Messages</span><span class="DocsMarkdown--link-external-icon" aria-hidden="true">
  <svg fill="none" stroke="currentColor" stroke-width="1.5" width="23px" height="12px" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg">
    <title id="title-4744738674102027">External link icon</title>
    <path d="M6.75,1.75h-5v12.5h12.5v-5m0,-4v-3.5h-3.5M8,8l5.5-5.5"></path>
  </svg>
  <span is-visually-hidden>Open external link</span>
</span></a> for general troubleshooting.</p>
</article>
      </div>
    </main>

    <footer class="DocsFooter">
  <div class="DocsFooter--content">
    <div class="DocsFooterResources">      
      <span class="DocsFooter--content-additional-wrapper"><a href="https://dash.cloudflare.com/?to=/:account/magic-wan" class="DocsMarkdown--link" target="_blank" rel="noopener">
  <span class="DocsMarkdown--link-content">Cloudflare Dashboard</span><span class="DocsMarkdown--link-external-icon" aria-hidden="true">
  <svg fill="none" stroke="currentColor" stroke-width="1.5" width="23px" height="12px" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg">
    <title id="title-4744738674102027">External link icon</title>
    <path d="M6.75,1.75h-5v12.5h12.5v-5m0,-4v-3.5h-3.5M8,8l5.5-5.5"></path>
  </svg>
  <span is-visually-hidden>Open external link</span>
</span></a>
      </span>
      
      <span class="DocsFooter--content-dot-spacer"> &nbsp; · &nbsp; </span>

      
      <span class="DocsFooter--content-additional-wrapper"><a href="https://community.cloudflare.com" class="DocsMarkdown--link" target="_blank" rel="noopener">
  <span class="DocsMarkdown--link-content">Community</span><span class="DocsMarkdown--link-external-icon" aria-hidden="true">
  <svg fill="none" stroke="currentColor" stroke-width="1.5" width="23px" height="12px" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg">
    <title id="title-4744738674102027">External link icon</title>
    <path d="M6.75,1.75h-5v12.5h12.5v-5m0,-4v-3.5h-3.5M8,8l5.5-5.5"></path>
  </svg>
  <span is-visually-hidden>Open external link</span>
</span></a>
      </span> 
      
      <span class="DocsFooter--content-dot-spacer"> &nbsp; · &nbsp; </span>

      <span class="DocsFooter--content-additional-wrapper"><a href="https://www.cloudflare.com/learning/network-layer/what-is-the-network-layer/" class="DocsMarkdown--link" target="_blank" rel="noopener">
  <span class="DocsMarkdown--link-content">Learning Center</span><span class="DocsMarkdown--link-external-icon" aria-hidden="true">
  <svg fill="none" stroke="currentColor" stroke-width="1.5" width="23px" height="12px" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg">
    <title id="title-4744738674102027">External link icon</title>
    <path d="M6.75,1.75h-5v12.5h12.5v-5m0,-4v-3.5h-3.5M8,8l5.5-5.5"></path>
  </svg>
  <span is-visually-hidden>Open external link</span>
</span></a></span>

      <span class="DocsFooter--content-dot-spacer"> &nbsp; · &nbsp; </span>

      <span class="DocsFooter--content-additional-wrapper"><a href="/support/contacting-cloudflare-support/" class="DocsMarkdown--link" target="_blank" rel="noopener">
  <span class="DocsMarkdown--link-content">Support Portal</span><span class="DocsMarkdown--link-external-icon" aria-hidden="true">
  <svg fill="none" stroke="currentColor" stroke-width="1.5" width="23px" height="12px" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg">
    <title id="title-4744738674102027">External link icon</title>
    <path d="M6.75,1.75h-5v12.5h12.5v-5m0,-4v-3.5h-3.5M8,8l5.5-5.5"></path>
  </svg>
  <span is-visually-hidden>Open external link</span>
</span></a>
      </span>

      <span class="DocsFooter--content-dot-spacer"> &nbsp; · &nbsp; </span>

      <span class="DocsFooter--content-additional-wrapper">
        
          <a role="button" id="ot-sdk-btn" class="ot-sdk-show-settings">Cookie Settings</a>
        
      </span>
    </div>
    <div>
      <span class="DocsFooter--edit-on-gh-link-wrapper"><a href="https://github.com/cloudflare/cloudflare-docs/blob/production/content/magic-wan/configuration/manually/third-party/palo-alto.md" class="DocsMarkdown--link" target="_blank" rel="noopener">
  <span class="DocsMarkdown--link-content">Edit on GitHub</span><span class="DocsMarkdown--link-external-icon" aria-hidden="true">
  <svg fill="none" stroke="currentColor" stroke-width="1.5" width="23px" height="12px" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg">
    <title id="title-4744738674102027">External link icon</title>
    <path d="M6.75,1.75h-5v12.5h12.5v-5m0,-4v-3.5h-3.5M8,8l5.5-5.5"></path>
  </svg>
  <span is-visually-hidden>Open external link</span>
</span></a></span><span class="DocsFooter--content-dot-spacer"> &nbsp; · &nbsp; </span>

      <span class="DocsFooter--content-time">
        Updated <time
  class="relative"
  datetime=2024-07-15T11:38:02&#43;01:00
  title=2024-07-15
>July 15, 2024</time>
      </span></div>
  </div><script type="module" src="/lightbox.js" defer></script><link rel="stylesheet" href="/lightbox.css">
</footer>

  </div>
<script defer src="https://unpkg.com/littlefoot@4.0.0-11/dist/littlefoot.js" type="application/javascript" ></script>
    <script type="application/javascript"> document.addEventListener('DOMContentLoaded', () => littlefoot.default()) </script>
  </body>
</html>
