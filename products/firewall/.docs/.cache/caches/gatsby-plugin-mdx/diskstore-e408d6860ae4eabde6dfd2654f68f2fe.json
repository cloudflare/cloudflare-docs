{"expireTime":9007200899183226000,"key":"gatsby-plugin-mdx-entire-payload-8ecdb4c2d249d7fb45e44324c99287f8-","val":{"mdast":{"type":"root","children":[{"type":"heading","depth":1,"children":[{"type":"text","value":"Require a valid HMAC token","position":{"start":{"line":2,"column":3,"offset":3},"end":{"line":2,"column":29,"offset":29},"indent":[]}}],"position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":29,"offset":29},"indent":[]}},{"type":"jsx","value":"<Aside type='warning' header='Important'>","position":{"start":{"line":4,"column":1,"offset":31},"end":{"line":4,"column":42,"offset":72},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Access to the HMAC validation function requires a Cloudflare Pro, Business, or Enterprise plan.","position":{"start":{"line":6,"column":1,"offset":74},"end":{"line":6,"column":96,"offset":169},"indent":[]}}],"position":{"start":{"line":6,"column":1,"offset":74},"end":{"line":6,"column":96,"offset":169},"indent":[]}},{"type":"jsx","value":"</Aside>","position":{"start":{"line":8,"column":1,"offset":171},"end":{"line":8,"column":9,"offset":179},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"HMAC token validation","position":{"start":{"line":10,"column":4,"offset":184},"end":{"line":10,"column":25,"offset":205},"indent":[]}}],"position":{"start":{"line":10,"column":1,"offset":181},"end":{"line":10,"column":25,"offset":205},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Use the Rules language ","position":{"start":{"line":12,"column":1,"offset":207},"end":{"line":12,"column":24,"offset":230},"indent":[]}},{"type":"link","title":null,"url":"https://developers.cloudflare.com/ruleset-engine/rules-language/functions#hmac-validation","children":[{"type":"text","value":"HMAC validation function","position":{"start":{"line":12,"column":25,"offset":231},"end":{"line":12,"column":49,"offset":255},"indent":[]}}],"position":{"start":{"line":12,"column":24,"offset":230},"end":{"line":12,"column":141,"offset":347},"indent":[]}},{"type":"text","value":" to validate hash-based message authentication code (HMAC) tokens in a Firewall Rules expression.","position":{"start":{"line":12,"column":141,"offset":347},"end":{"line":12,"column":238,"offset":444},"indent":[]}}],"position":{"start":{"line":12,"column":1,"offset":207},"end":{"line":12,"column":238,"offset":444},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"This example uses HMAC token authentication to protect a static private asset hosted by ","position":{"start":{"line":14,"column":1,"offset":446},"end":{"line":14,"column":89,"offset":534},"indent":[]}},{"type":"inlineCode","value":"example.com","position":{"start":{"line":14,"column":89,"offset":534},"end":{"line":14,"column":102,"offset":547},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":14,"column":102,"offset":547},"end":{"line":14,"column":103,"offset":548},"indent":[]}}],"position":{"start":{"line":14,"column":1,"offset":446},"end":{"line":14,"column":103,"offset":548},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":16,"column":1,"offset":550},"end":{"line":16,"column":5,"offset":554},"indent":[]}},{"type":"inlineCode","value":"http.request.uri","position":{"start":{"line":16,"column":5,"offset":554},"end":{"line":16,"column":23,"offset":572},"indent":[]}},{"type":"text","value":" for this example is","position":{"start":{"line":16,"column":23,"offset":572},"end":{"line":16,"column":43,"offset":592},"indent":[]}}],"position":{"start":{"line":16,"column":1,"offset":550},"end":{"line":16,"column":43,"offset":592},"indent":[]}},{"type":"code","lang":"txt","meta":null,"value":"/download/cat.jpg?verify=1484063787-9JQB8vP1z0yc5DEBnH6JGWM3mBmvIeMrnnxFi3WtJLE%3D","position":{"start":{"line":18,"column":1,"offset":594},"end":{"line":20,"column":4,"offset":687},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"where","position":{"start":{"line":22,"column":1,"offset":689},"end":{"line":22,"column":6,"offset":694},"indent":[]}}],"position":{"start":{"line":22,"column":1,"offset":689},"end":{"line":22,"column":6,"offset":694},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":true,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"/download/cat.jpg?","position":{"start":{"line":24,"column":3,"offset":698},"end":{"line":24,"column":23,"offset":718},"indent":[]}},{"type":"text","value":" represents the path to the asset—the HMAC ","position":{"start":{"line":24,"column":23,"offset":718},"end":{"line":24,"column":66,"offset":761},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"message","position":{"start":{"line":24,"column":68,"offset":763},"end":{"line":24,"column":75,"offset":770},"indent":[]}}],"position":{"start":{"line":24,"column":66,"offset":761},"end":{"line":24,"column":77,"offset":772},"indent":[]}},{"type":"text","value":" to authenticate","position":{"start":{"line":24,"column":77,"offset":772},"end":{"line":24,"column":93,"offset":788},"indent":[]}}],"position":{"start":{"line":24,"column":3,"offset":698},"end":{"line":24,"column":93,"offset":788},"indent":[]}}],"position":{"start":{"line":24,"column":1,"offset":696},"end":{"line":25,"column":1,"offset":789},"indent":[1]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"?verify=","position":{"start":{"line":26,"column":3,"offset":792},"end":{"line":26,"column":13,"offset":802},"indent":[]}},{"type":"text","value":" is the ","position":{"start":{"line":26,"column":13,"offset":802},"end":{"line":26,"column":21,"offset":810},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"separator","position":{"start":{"line":26,"column":23,"offset":812},"end":{"line":26,"column":32,"offset":821},"indent":[]}}],"position":{"start":{"line":26,"column":21,"offset":810},"end":{"line":26,"column":34,"offset":823},"indent":[]}},{"type":"text","value":" between the path to the asset and the timestamp when the HMAC token was issued","position":{"start":{"line":26,"column":34,"offset":823},"end":{"line":26,"column":113,"offset":902},"indent":[]}}],"position":{"start":{"line":26,"column":3,"offset":792},"end":{"line":26,"column":113,"offset":902},"indent":[]}}],"position":{"start":{"line":26,"column":1,"offset":790},"end":{"line":27,"column":1,"offset":903},"indent":[1]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"1484063787","position":{"start":{"line":28,"column":3,"offset":906},"end":{"line":28,"column":15,"offset":918},"indent":[]}},{"type":"text","value":" represents the ","position":{"start":{"line":28,"column":15,"offset":918},"end":{"line":28,"column":31,"offset":934},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"timestamp when the token was issued","position":{"start":{"line":28,"column":33,"offset":936},"end":{"line":28,"column":68,"offset":971},"indent":[]}}],"position":{"start":{"line":28,"column":31,"offset":934},"end":{"line":28,"column":70,"offset":973},"indent":[]}},{"type":"text","value":", expressed as Unix time in seconds","position":{"start":{"line":28,"column":70,"offset":973},"end":{"line":28,"column":105,"offset":1008},"indent":[]}}],"position":{"start":{"line":28,"column":3,"offset":906},"end":{"line":28,"column":105,"offset":1008},"indent":[]}}],"position":{"start":{"line":28,"column":1,"offset":904},"end":{"line":29,"column":1,"offset":1009},"indent":[1]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"9JQB8vP1z0yc5DEBnH6JGWM3mBmvIeMrnnxFi3WtJLE%3D","position":{"start":{"line":30,"column":3,"offset":1012},"end":{"line":30,"column":51,"offset":1060},"indent":[]}},{"type":"text","value":" is a base64-encoded ","position":{"start":{"line":30,"column":51,"offset":1060},"end":{"line":30,"column":72,"offset":1081},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"MAC","position":{"start":{"line":30,"column":74,"offset":1083},"end":{"line":30,"column":77,"offset":1086},"indent":[]}}],"position":{"start":{"line":30,"column":72,"offset":1081},"end":{"line":30,"column":79,"offset":1088},"indent":[]}}],"position":{"start":{"line":30,"column":3,"offset":1012},"end":{"line":30,"column":79,"offset":1088},"indent":[]}}],"position":{"start":{"line":30,"column":1,"offset":1010},"end":{"line":30,"column":79,"offset":1088},"indent":[]}}],"position":{"start":{"line":24,"column":1,"offset":696},"end":{"line":30,"column":79,"offset":1088},"indent":[1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"The Firewall Rule below blocks requests to ","position":{"start":{"line":32,"column":1,"offset":1090},"end":{"line":32,"column":44,"offset":1133},"indent":[]}},{"type":"inlineCode","value":"example.com","position":{"start":{"line":32,"column":44,"offset":1133},"end":{"line":32,"column":57,"offset":1146},"indent":[]}},{"type":"text","value":" that do not include a valid HMAC.","position":{"start":{"line":32,"column":57,"offset":1146},"end":{"line":32,"column":91,"offset":1180},"indent":[]}}],"position":{"start":{"line":32,"column":1,"offset":1090},"end":{"line":32,"column":91,"offset":1180},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The rule supplies the value of the secret key shared between the website and Cloudflare as the first argument to the ","position":{"start":{"line":34,"column":1,"offset":1182},"end":{"line":34,"column":118,"offset":1299},"indent":[]}},{"type":"link","title":null,"url":"https://developers.cloudflare.com/ruleset-engine/rules-language/functions#hmac-validation","children":[{"type":"text","value":"HMAC validation function","position":{"start":{"line":34,"column":119,"offset":1300},"end":{"line":34,"column":143,"offset":1324},"indent":[]}}],"position":{"start":{"line":34,"column":118,"offset":1299},"end":{"line":34,"column":235,"offset":1416},"indent":[]}},{"type":"text","value":", and it uses the value of ","position":{"start":{"line":34,"column":235,"offset":1416},"end":{"line":34,"column":262,"offset":1443},"indent":[]}},{"type":"inlineCode","value":"http.request.uri","position":{"start":{"line":34,"column":262,"offset":1443},"end":{"line":34,"column":280,"offset":1461},"indent":[]}},{"type":"text","value":" for the ","position":{"start":{"line":34,"column":280,"offset":1461},"end":{"line":34,"column":289,"offset":1470},"indent":[]}},{"type":"link","title":null,"url":"https://developers.cloudflare.com/ruleset-engine/rules-language/functions#messagemac","children":[{"type":"text","value":"MessageMAC","position":{"start":{"line":34,"column":290,"offset":1471},"end":{"line":34,"column":300,"offset":1481},"indent":[]}}],"position":{"start":{"line":34,"column":289,"offset":1470},"end":{"line":34,"column":387,"offset":1568},"indent":[]}},{"type":"text","value":":","position":{"start":{"line":34,"column":387,"offset":1568},"end":{"line":34,"column":388,"offset":1569},"indent":[]}}],"position":{"start":{"line":34,"column":1,"offset":1182},"end":{"line":34,"column":388,"offset":1569},"indent":[]}},{"type":"jsx","value":"<table>\n  <thead>\n  <tr>\n    <th>Expression</th>\n    <th>Action</th>\n  </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td><code>http.host eq \"downloads.example.com\" and not is_timed_hmac_valid_v0(\"secretKey\", http.request.uri, 10800, http.request.timestamp.sec,8)</code></td>\n      <td><em>Block</em></td>\n    </tr>\n  </tbody>\n</table>","position":{"start":{"line":36,"column":1,"offset":1571},"end":{"line":49,"column":9,"offset":1901},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":51,"column":1,"offset":1903},"end":{"line":51,"column":5,"offset":1907},"indent":[]}},{"type":"inlineCode","value":"is_timed_hmac_valid()","position":{"start":{"line":51,"column":5,"offset":1907},"end":{"line":51,"column":28,"offset":1930},"indent":[]}},{"type":"text","value":" function compares the value of a MAC generated using ","position":{"start":{"line":51,"column":28,"offset":1930},"end":{"line":51,"column":82,"offset":1984},"indent":[]}},{"type":"inlineCode","value":"secretKey","position":{"start":{"line":51,"column":82,"offset":1984},"end":{"line":51,"column":93,"offset":1995},"indent":[]}},{"type":"text","value":" to the value encoded in ","position":{"start":{"line":51,"column":93,"offset":1995},"end":{"line":51,"column":118,"offset":2020},"indent":[]}},{"type":"inlineCode","value":"http.request.uri","position":{"start":{"line":51,"column":118,"offset":2020},"end":{"line":51,"column":136,"offset":2038},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":51,"column":136,"offset":2038},"end":{"line":51,"column":137,"offset":2039},"indent":[]}}],"position":{"start":{"line":51,"column":1,"offset":1903},"end":{"line":51,"column":137,"offset":2039},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"If the MAC values match and","position":{"start":{"line":53,"column":1,"offset":2041},"end":{"line":53,"column":28,"offset":2068},"indent":[]}}],"position":{"start":{"line":53,"column":1,"offset":2041},"end":{"line":53,"column":28,"offset":2068},"indent":[]}},{"type":"code","lang":"txt","meta":null,"value":"http.request.timestamp.sec < (timestamp-issued + 10800)","position":{"start":{"line":55,"column":1,"offset":2070},"end":{"line":57,"column":4,"offset":2136},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"then the token is valid and the function returns ","position":{"start":{"line":59,"column":1,"offset":2138},"end":{"line":59,"column":50,"offset":2187},"indent":[]}},{"type":"inlineCode","value":"true","position":{"start":{"line":59,"column":50,"offset":2187},"end":{"line":59,"column":56,"offset":2193},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":59,"column":56,"offset":2193},"end":{"line":59,"column":57,"offset":2194},"indent":[]}}],"position":{"start":{"line":59,"column":1,"offset":2138},"end":{"line":59,"column":57,"offset":2194},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Since the expression in this example uses the ","position":{"start":{"line":61,"column":1,"offset":2196},"end":{"line":61,"column":47,"offset":2242},"indent":[]}},{"type":"inlineCode","value":"not","position":{"start":{"line":61,"column":47,"offset":2242},"end":{"line":61,"column":52,"offset":2247},"indent":[]}},{"type":"text","value":" operator, it only matches when the HMAC token is ","position":{"start":{"line":61,"column":52,"offset":2247},"end":{"line":61,"column":102,"offset":2297},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"not","position":{"start":{"line":61,"column":103,"offset":2298},"end":{"line":61,"column":106,"offset":2301},"indent":[]}}],"position":{"start":{"line":61,"column":102,"offset":2297},"end":{"line":61,"column":107,"offset":2302},"indent":[]}},{"type":"text","value":" valid. When the token is not valid, the Cloudflare triggers the action and blocks the request.","position":{"start":{"line":61,"column":107,"offset":2302},"end":{"line":61,"column":202,"offset":2397},"indent":[]}}],"position":{"start":{"line":61,"column":1,"offset":2196},"end":{"line":61,"column":202,"offset":2397},"indent":[]}},{"type":"jsx","value":"<Aside type='warning' header='Important'>","position":{"start":{"line":63,"column":1,"offset":2399},"end":{"line":63,"column":42,"offset":2440},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"When you do not use the optional ","position":{"start":{"line":65,"column":1,"offset":2442},"end":{"line":65,"column":34,"offset":2475},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"flags","position":{"start":{"line":65,"column":35,"offset":2476},"end":{"line":65,"column":40,"offset":2481},"indent":[]}}],"position":{"start":{"line":65,"column":34,"offset":2475},"end":{"line":65,"column":41,"offset":2482},"indent":[]}},{"type":"text","value":" argument for ","position":{"start":{"line":65,"column":41,"offset":2482},"end":{"line":65,"column":55,"offset":2496},"indent":[]}},{"type":"inlineCode","value":"_is_timed_hmac_valid()","position":{"start":{"line":65,"column":55,"offset":2496},"end":{"line":65,"column":79,"offset":2520},"indent":[]}},{"type":"text","value":", you must URL encode the base64 value for ","position":{"start":{"line":65,"column":79,"offset":2520},"end":{"line":65,"column":122,"offset":2563},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"mac","position":{"start":{"line":65,"column":123,"offset":2564},"end":{"line":65,"column":126,"offset":2567},"indent":[]}}],"position":{"start":{"line":65,"column":122,"offset":2563},"end":{"line":65,"column":127,"offset":2568},"indent":[]}},{"type":"text","value":" in the ","position":{"start":{"line":65,"column":127,"offset":2568},"end":{"line":65,"column":135,"offset":2576},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"MessageMAC","position":{"start":{"line":65,"column":136,"offset":2577},"end":{"line":65,"column":146,"offset":2587},"indent":[]}}],"position":{"start":{"line":65,"column":135,"offset":2576},"end":{"line":65,"column":147,"offset":2588},"indent":[]}},{"type":"text","value":" argument.","position":{"start":{"line":65,"column":147,"offset":2588},"end":{"line":65,"column":157,"offset":2598},"indent":[]}}],"position":{"start":{"line":65,"column":1,"offset":2442},"end":{"line":65,"column":157,"offset":2598},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"For more information, refer to ","position":{"start":{"line":67,"column":1,"offset":2600},"end":{"line":67,"column":32,"offset":2631},"indent":[]}},{"type":"link","title":null,"url":"https://developers.cloudflare.com/ruleset-engine/rules-language/functions#hmac-validation","children":[{"type":"text","value":"Functions: HMAC Validation","position":{"start":{"line":67,"column":33,"offset":2632},"end":{"line":67,"column":59,"offset":2658},"indent":[]}}],"position":{"start":{"line":67,"column":32,"offset":2631},"end":{"line":67,"column":151,"offset":2750},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":67,"column":151,"offset":2750},"end":{"line":67,"column":152,"offset":2751},"indent":[]}}],"position":{"start":{"line":67,"column":1,"offset":2600},"end":{"line":67,"column":152,"offset":2751},"indent":[]}},{"type":"jsx","value":"</Aside>","position":{"start":{"line":69,"column":1,"offset":2753},"end":{"line":69,"column":9,"offset":2761},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Use the same secret key to protect multiple paths","position":{"start":{"line":71,"column":4,"offset":2766},"end":{"line":71,"column":53,"offset":2815},"indent":[]}}],"position":{"start":{"line":71,"column":1,"offset":2763},"end":{"line":71,"column":53,"offset":2815},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"You can use the same secret key to protect multiple URI paths.","position":{"start":{"line":73,"column":1,"offset":2817},"end":{"line":73,"column":63,"offset":2879},"indent":[]}}],"position":{"start":{"line":73,"column":1,"offset":2817},"end":{"line":73,"column":63,"offset":2879},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"This is illustrated in the example above, where ","position":{"start":{"line":75,"column":1,"offset":2881},"end":{"line":75,"column":49,"offset":2929},"indent":[]}},{"type":"inlineCode","value":"http.request.uri","position":{"start":{"line":75,"column":49,"offset":2929},"end":{"line":75,"column":67,"offset":2947},"indent":[]}},{"type":"text","value":" is passed as the MessageMAC argument to the validation function.","position":{"start":{"line":75,"column":67,"offset":2947},"end":{"line":75,"column":132,"offset":3012},"indent":[]}}],"position":{"start":{"line":75,"column":1,"offset":2881},"end":{"line":75,"column":132,"offset":3012},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Since ","position":{"start":{"line":77,"column":1,"offset":3014},"end":{"line":77,"column":7,"offset":3020},"indent":[]}},{"type":"inlineCode","value":"http.request.uri","position":{"start":{"line":77,"column":7,"offset":3020},"end":{"line":77,"column":25,"offset":3038},"indent":[]}},{"type":"text","value":" includes the path to the asset and that value is extracted for each request, the validation function evaluates all request URIs to ","position":{"start":{"line":77,"column":25,"offset":3038},"end":{"line":77,"column":157,"offset":3170},"indent":[]}},{"type":"inlineCode","value":"downloads.example.com","position":{"start":{"line":77,"column":157,"offset":3170},"end":{"line":77,"column":180,"offset":3193},"indent":[]}},{"type":"text","value":" using the same secret key.","position":{"start":{"line":77,"column":180,"offset":3193},"end":{"line":77,"column":207,"offset":3220},"indent":[]}}],"position":{"start":{"line":77,"column":1,"offset":3014},"end":{"line":77,"column":207,"offset":3220},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Note that while you can use the same secret key to authenticate multiple paths, you must generate an HMAC token for each unique message you want to authenticate.","position":{"start":{"line":79,"column":1,"offset":3222},"end":{"line":79,"column":162,"offset":3383},"indent":[]}}],"position":{"start":{"line":79,"column":1,"offset":3222},"end":{"line":79,"column":162,"offset":3383},"indent":[]}},{"type":"export","value":"export const _frontmatter = {\"pcx-content-type\":\"configuration\"}","position":{"start":{"line":82,"column":1,"offset":3386},"end":{"line":82,"column":65,"offset":3450},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":82,"column":65,"offset":3450}}},"scopeImports":["import * as React from 'react'"],"scopeIdentifiers":["React"],"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"pcx-content-type\": \"configuration\"\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar Aside = makeShortcode(\"Aside\");\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h1\", {\n    \"id\": \"require-a-valid-hmac-token\"\n  }, \"Require a valid HMAC token\"), mdx(Aside, {\n    type: \"warning\",\n    header: \"Important\",\n    mdxType: \"Aside\"\n  }, mdx(\"p\", null, \"Access to the HMAC validation function requires a Cloudflare Pro, Business, or Enterprise plan.\")), mdx(\"h2\", {\n    \"id\": \"hmac-token-validation\"\n  }, \"HMAC token validation\"), mdx(\"p\", null, \"Use the Rules language \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://developers.cloudflare.com/ruleset-engine/rules-language/functions#hmac-validation\"\n  }, \"HMAC validation function\"), \" to validate hash-based message authentication code (HMAC) tokens in a Firewall Rules expression.\"), mdx(\"p\", null, \"This example uses HMAC token authentication to protect a static private asset hosted by \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"example.com\"), \".\"), mdx(\"p\", null, \"The \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"http.request.uri\"), \" for this example is\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-txt\"\n  }, \"/download/cat.jpg?verify=1484063787-9JQB8vP1z0yc5DEBnH6JGWM3mBmvIeMrnnxFi3WtJLE%3D\\n\")), mdx(\"p\", null, \"where\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/download/cat.jpg?\"), \" represents the path to the asset\\u2014the HMAC \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"message\"), \" to authenticate\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"?verify=\"), \" is the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"separator\"), \" between the path to the asset and the timestamp when the HMAC token was issued\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"1484063787\"), \" represents the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"timestamp when the token was issued\"), \", expressed as Unix time in seconds\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"9JQB8vP1z0yc5DEBnH6JGWM3mBmvIeMrnnxFi3WtJLE%3D\"), \" is a base64-encoded \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"MAC\")))), mdx(\"p\", null, \"The Firewall Rule below blocks requests to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"example.com\"), \" that do not include a valid HMAC.\"), mdx(\"p\", null, \"The rule supplies the value of the secret key shared between the website and Cloudflare as the first argument to the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://developers.cloudflare.com/ruleset-engine/rules-language/functions#hmac-validation\"\n  }, \"HMAC validation function\"), \", and it uses the value of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"http.request.uri\"), \" for the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://developers.cloudflare.com/ruleset-engine/rules-language/functions#messagemac\"\n  }, \"MessageMAC\"), \":\"), mdx(\"table\", null, mdx(\"thead\", null, mdx(\"tr\", null, mdx(\"th\", null, \"Expression\"), mdx(\"th\", null, \"Action\"))), mdx(\"tbody\", null, mdx(\"tr\", null, mdx(\"td\", null, mdx(\"code\", null, \"http.host eq \\\"downloads.example.com\\\" and not is_timed_hmac_valid_v0(\\\"secretKey\\\", http.request.uri, 10800, http.request.timestamp.sec,8)\")), mdx(\"td\", null, mdx(\"em\", null, \"Block\"))))), mdx(\"p\", null, \"The \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"is_timed_hmac_valid()\"), \" function compares the value of a MAC generated using \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"secretKey\"), \" to the value encoded in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"http.request.uri\"), \".\"), mdx(\"p\", null, \"If the MAC values match and\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-txt\"\n  }, \"http.request.timestamp.sec < (timestamp-issued + 10800)\\n\")), mdx(\"p\", null, \"then the token is valid and the function returns \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"true\"), \".\"), mdx(\"p\", null, \"Since the expression in this example uses the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"not\"), \" operator, it only matches when the HMAC token is \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"not\"), \" valid. When the token is not valid, the Cloudflare triggers the action and blocks the request.\"), mdx(Aside, {\n    type: \"warning\",\n    header: \"Important\",\n    mdxType: \"Aside\"\n  }, mdx(\"p\", null, \"When you do not use the optional \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"flags\"), \" argument for \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"_is_timed_hmac_valid()\"), \", you must URL encode the base64 value for \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"mac\"), \" in the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"MessageMAC\"), \" argument.\"), mdx(\"p\", null, \"For more information, refer to \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://developers.cloudflare.com/ruleset-engine/rules-language/functions#hmac-validation\"\n  }, \"Functions: HMAC Validation\"), \".\")), mdx(\"h2\", {\n    \"id\": \"use-the-same-secret-key-to-protect-multiple-paths\"\n  }, \"Use the same secret key to protect multiple paths\"), mdx(\"p\", null, \"You can use the same secret key to protect multiple URI paths.\"), mdx(\"p\", null, \"This is illustrated in the example above, where \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"http.request.uri\"), \" is passed as the MessageMAC argument to the validation function.\"), mdx(\"p\", null, \"Since \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"http.request.uri\"), \" includes the path to the asset and that value is extracted for each request, the validation function evaluates all request URIs to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"downloads.example.com\"), \" using the same secret key.\"), mdx(\"p\", null, \"Note that while you can use the same secret key to authenticate multiple paths, you must generate an HMAC token for each unique message you want to authenticate.\"));\n}\n;\nMDXContent.isMDXComponent = true;","rawMDXOutput":"/* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nexport const _frontmatter = {\n  \"pcx-content-type\": \"configuration\"\n};\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\")\n  return <div {...props}/>\n};\nconst Aside = makeShortcode(\"Aside\");\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <h1 {...{\n      \"id\": \"require-a-valid-hmac-token\"\n    }}>{`Require a valid HMAC token`}</h1>\n    <Aside type='warning' header='Important' mdxType=\"Aside\">\n      <p>{`Access to the HMAC validation function requires a Cloudflare Pro, Business, or Enterprise plan.`}</p>\n    </Aside>\n    <h2 {...{\n      \"id\": \"hmac-token-validation\"\n    }}>{`HMAC token validation`}</h2>\n    <p>{`Use the Rules language `}<a parentName=\"p\" {...{\n        \"href\": \"https://developers.cloudflare.com/ruleset-engine/rules-language/functions#hmac-validation\"\n      }}>{`HMAC validation function`}</a>{` to validate hash-based message authentication code (HMAC) tokens in a Firewall Rules expression.`}</p>\n    <p>{`This example uses HMAC token authentication to protect a static private asset hosted by `}<inlineCode parentName=\"p\">{`example.com`}</inlineCode>{`.`}</p>\n    <p>{`The `}<inlineCode parentName=\"p\">{`http.request.uri`}</inlineCode>{` for this example is`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-txt\"\n      }}>{`/download/cat.jpg?verify=1484063787-9JQB8vP1z0yc5DEBnH6JGWM3mBmvIeMrnnxFi3WtJLE%3D\n`}</code></pre>\n    <p>{`where`}</p>\n    <ul>\n      <li parentName=\"ul\">\n        <p parentName=\"li\"><inlineCode parentName=\"p\">{`/download/cat.jpg?`}</inlineCode>{` represents the path to the asset—the HMAC `}<strong parentName=\"p\">{`message`}</strong>{` to authenticate`}</p>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\"><inlineCode parentName=\"p\">{`?verify=`}</inlineCode>{` is the `}<strong parentName=\"p\">{`separator`}</strong>{` between the path to the asset and the timestamp when the HMAC token was issued`}</p>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\"><inlineCode parentName=\"p\">{`1484063787`}</inlineCode>{` represents the `}<strong parentName=\"p\">{`timestamp when the token was issued`}</strong>{`, expressed as Unix time in seconds`}</p>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\"><inlineCode parentName=\"p\">{`9JQB8vP1z0yc5DEBnH6JGWM3mBmvIeMrnnxFi3WtJLE%3D`}</inlineCode>{` is a base64-encoded `}<strong parentName=\"p\">{`MAC`}</strong></p>\n      </li>\n    </ul>\n    <p>{`The Firewall Rule below blocks requests to `}<inlineCode parentName=\"p\">{`example.com`}</inlineCode>{` that do not include a valid HMAC.`}</p>\n    <p>{`The rule supplies the value of the secret key shared between the website and Cloudflare as the first argument to the `}<a parentName=\"p\" {...{\n        \"href\": \"https://developers.cloudflare.com/ruleset-engine/rules-language/functions#hmac-validation\"\n      }}>{`HMAC validation function`}</a>{`, and it uses the value of `}<inlineCode parentName=\"p\">{`http.request.uri`}</inlineCode>{` for the `}<a parentName=\"p\" {...{\n        \"href\": \"https://developers.cloudflare.com/ruleset-engine/rules-language/functions#messagemac\"\n      }}>{`MessageMAC`}</a>{`:`}</p>\n    <table>\n  <thead>\n  <tr>\n    <th>Expression</th>\n    <th>Action</th>\n  </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td><code>http.host eq \"downloads.example.com\" and not is_timed_hmac_valid_v0(\"secretKey\", http.request.uri, 10800, http.request.timestamp.sec,8)</code></td>\n      <td><em>Block</em></td>\n    </tr>\n  </tbody>\n    </table>\n    <p>{`The `}<inlineCode parentName=\"p\">{`is_timed_hmac_valid()`}</inlineCode>{` function compares the value of a MAC generated using `}<inlineCode parentName=\"p\">{`secretKey`}</inlineCode>{` to the value encoded in `}<inlineCode parentName=\"p\">{`http.request.uri`}</inlineCode>{`.`}</p>\n    <p>{`If the MAC values match and`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-txt\"\n      }}>{`http.request.timestamp.sec < (timestamp-issued + 10800)\n`}</code></pre>\n    <p>{`then the token is valid and the function returns `}<inlineCode parentName=\"p\">{`true`}</inlineCode>{`.`}</p>\n    <p>{`Since the expression in this example uses the `}<inlineCode parentName=\"p\">{`not`}</inlineCode>{` operator, it only matches when the HMAC token is `}<em parentName=\"p\">{`not`}</em>{` valid. When the token is not valid, the Cloudflare triggers the action and blocks the request.`}</p>\n    <Aside type='warning' header='Important' mdxType=\"Aside\">\n      <p>{`When you do not use the optional `}<em parentName=\"p\">{`flags`}</em>{` argument for `}<inlineCode parentName=\"p\">{`_is_timed_hmac_valid()`}</inlineCode>{`, you must URL encode the base64 value for `}<em parentName=\"p\">{`mac`}</em>{` in the `}<em parentName=\"p\">{`MessageMAC`}</em>{` argument.`}</p>\n      <p>{`For more information, refer to `}<a parentName=\"p\" {...{\n          \"href\": \"https://developers.cloudflare.com/ruleset-engine/rules-language/functions#hmac-validation\"\n        }}>{`Functions: HMAC Validation`}</a>{`.`}</p>\n    </Aside>\n    <h2 {...{\n      \"id\": \"use-the-same-secret-key-to-protect-multiple-paths\"\n    }}>{`Use the same secret key to protect multiple paths`}</h2>\n    <p>{`You can use the same secret key to protect multiple URI paths.`}</p>\n    <p>{`This is illustrated in the example above, where `}<inlineCode parentName=\"p\">{`http.request.uri`}</inlineCode>{` is passed as the MessageMAC argument to the validation function.`}</p>\n    <p>{`Since `}<inlineCode parentName=\"p\">{`http.request.uri`}</inlineCode>{` includes the path to the asset and that value is extracted for each request, the validation function evaluates all request URIs to `}<inlineCode parentName=\"p\">{`downloads.example.com`}</inlineCode>{` using the same secret key.`}</p>\n    <p>{`Note that while you can use the same secret key to authenticate multiple paths, you must generate an HMAC token for each unique message you want to authenticate.`}</p>\n\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;"}}