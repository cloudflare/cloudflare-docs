---
pcx_content_type: troubleshooting
language_tag: japanese
source: https://support.cloudflare.com/hc/ja/articles/360038696631-Cloudflare%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E5%88%86%E6%9E%90-v1%E3%82%92%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B
title: Cloudflareネットワーク分析 v1を理解する
---

# Cloudflareネットワーク分析 v1を理解する

_Magic TransitとCloudflare Spectrumのお客様がアカウントレベルのネットワーク分析を使って、レイヤー3とレイヤー4トラフィックと攻撃の詳細を調べる方法をご紹介します。_

### 本記事の内容

-   [概要](https://support.cloudflare.com/hc/ja/articles/360038696631-Cloudflare%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E5%88%86%E6%9E%90-v1%E3%82%92%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B#7rrlY887ZX7ZDVmx2V4bcm)
-   [ネットワーク分析を表示する](https://support.cloudflare.com/hc/ja/articles/360038696631-Cloudflare%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E5%88%86%E6%9E%90-v1%E3%82%92%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B#7x2T95w9RGgg782pVMujPb)
-   [ネットワーク分析を確認する](https://support.cloudflare.com/hc/ja/articles/360038696631-Cloudflare%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E5%88%86%E6%9E%90-v1%E3%82%92%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B#h_3WlP6WsWFl28h92oS2k8O2)
-   [データにフィルターを適用する](https://support.cloudflare.com/hc/ja/articles/360038696631-Cloudflare%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E5%88%86%E6%9E%90-v1%E3%82%92%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B#h_4Agjkc3QlLuhrCW43NsN3p)
-   [プロットする範囲を選択する](https://support.cloudflare.com/hc/ja/articles/360038696631-Cloudflare%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E5%88%86%E6%9E%90-v1%E3%82%92%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B#h_4UZtmYClrU0N7OYwZgHHoh)
-   [アクテビティログを表示する](https://support.cloudflare.com/hc/ja/articles/360038696631-Cloudflare%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E5%88%86%E6%9E%90-v1%E3%82%92%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B#h_6GOQ2ficyicPxirroGewJP)
-   [ログデータとレポートをエクスポートする](https://support.cloudflare.com/hc/ja/articles/360038696631-Cloudflare%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E5%88%86%E6%9E%90-v1%E3%82%92%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B#h_3grb6OPVreABUQaQBekfHn)
-   [制限事項](https://support.cloudflare.com/hc/ja/articles/360038696631-Cloudflare%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E5%88%86%E6%9E%90-v1%E3%82%92%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B#h_6tCVFw0V6ufdvQnRIxu19t)
-   [関連リソース](https://support.cloudflare.com/hc/ja/articles/360038696631-Cloudflare%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E5%88%86%E6%9E%90-v1%E3%82%92%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B#7flIreW1Np8fuxZYTbduF2)
-   [よくある質問](https://support.cloudflare.com/hc/ja/articles/360038696631-Cloudflare%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E5%88%86%E6%9E%90-v1%E3%82%92%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B#h_2CqXhNxV03M5IUwklSR3n6)

___

## 概要

ネットワーク分析にアクセスするには、次が必要になります。

-   CloudflareのEnterprise プラン
-   Cloudflare [Magic Transit](/magic-transit/) または[Spectrum](/spectrum/)

Cloudflareの**ネットワーク分析**ビューでは、ネットワーク層とトランスポート層におけるトラフィックパターンとDDoS攻撃についてほぼリアルタイムの可視性を実現します。ネットワーク分析では、パケットとビットレベルのデータ、[GraphQL API分析](/analytics/graphql-api/)を介して利用できるのと同じデータを視覚化します。

![分析パネルではタイプ別にパケットのサマリーを表示](/images/support/na-main-dashboard.png)

ネットワーク分析は、悪意のあるトラフィック報告と調査を加速します。次のパラメーターでデータを絞り込むことができます。

-   Cloudflareによって実行された軽減アクション
-   ソースIP、ポート、ASN
-   送信先IPとポート
-   トラフィックが観測されたCloudflareデータセンターの都市名と国名
-   攻撃の規模、種類、発生率、攻撃継続時間
-   TCPフラグ
-   IPバージョン
-   プロトコル

ネットワーク分析を使って、主要なインテリジェンスを瞬時に特定する

-   ネットワークを狙った攻撃ベクトルの上位
-   時系列のトラフィック軽減、アクション別
-   攻撃ソース、国別またはデータセンター別

___

## ネットワーク分析を表示する

Cloudflareアカウントのホームページから**ネットワーク分析**ビューにアクセスできます。

**ネットワーク**分析ビューにアクセスするには、次の手順に従ってください。

1.  Cloudflareアカウントにログインします。
2.  複数のアカウントをお持ちの場合は、Magig TransitまたはSpectrumにアクセス権を持つアカウントを1つ選んでください。
3.  アカウントの**ホーム**ページ上で、**ネットワーク分析**をクリックします。

___

## ネットワーク分析を確認する

### ヘッドラインの概要とサイドパネル

**時間枠**ドロップダウンリストで選択した期間のアクティビティの概要が、ヘッドラインとサイドパネルに表示されます。

![ヘッドラインとサイドパネルが過去24時間までのアクティビティを要約](/images/support/na-navigate.png)

ヘッドラインには、パケットまたはビットの合計と検出・軽減された攻撃数が表示されます。攻撃が進行中の場合、ヘッドラインにはパケット（またはビット）の合計ではなく、これらの最大値が表示されます。

データ表示を切り替えるには、**パケット**サイドパネル、または**ビット**サイドパネルをクリックします。

### 表示する時間枠を設定する

**時間枠**ドロップダウンリストを使って、ネットワーク分析がデータを表示する期間を変更できます。時間枠を選択するとビュー全体が更新され、選択した内容が反映されます。

_30分前_を選択すると、**ネットワーク分析**ビューに過去30分間のデータが表示され、20秒ごとに更新されます。統計ドロップダウンリストの横に_Live_通知が表示され、ビューが自動的に更新され続けることがわかります。

![ネットワーク分析は自動更新が有効化](/images/support/hc-dash-Network_Analytics-auto_refresh.png)

_カスタム範囲_のオプションを選択すると、過去365日間のどの時点でも、最長30日間の期間が指定できます。

### 平均発生率、または総容量別に表示する

ドロップダウンリストから統計を選択し、プロットする_平均レート_と_合計数_を切り替えます。 

### 「IPプレフィックスのアドバタイズ/取り消し」イベントを表示する

\[**注釈の表示**\] トグルを有効にして、**ネットワーク分析**ビューでアドバタイズ/取り消されたIPプレフィックスイベントの注釈を表示または非表示にします。各注釈をクリックすると、詳細が表示されます。

![トグルボタンでネットワーク分析チャートに注釈を表示](/images/support/hc-dash-Network_Analytics-show_annotations.png)

### パケットの概要を拡大させる

グラフ領域をクリックし、マウスをドラッグして拡大します。このやり方なら、３分という短い範囲まで拡大することができます。

![パケットサマリーにズームイン ](/images/support/unnamed.gif)

縮小表示するには、**時間枠**セレクターにある**X**アイコンをクリックします。

___

## データにフィルターを適用する

複数の絞り込み条件と除外条件を適用して、ネットワーク分析に表示するデータ範囲を調整できます。

フィルターを適用すると、ネットワーク分析ページで表示されるデータすべてに影響があります。

ネットワーク分析データを絞り込む方法は二つあります。**フィルターの追加**ボタンを使う方法と、**統計フィルター**の1つをクリックする方法です。

### フィルターを追加するボタンを使う

**フィルターの追加**ボタンをクリックして**新規フィルター**ポップオーバーを開きます。フィールド、演算子、値を指定して、filter expression（フィルター式）を完成させます。**適用**をクリックしてビューを更新します。

フィルターを適用する際、次のガイドラインに従ってください。

-   ワイルドカードはサポートされません。
-   値を引用符で囲む必要はありません。
-   ASN番号を指定する場合は、プレフィックスの_AS_を外してください。たとえば、_AS1423_の代わりに、_1423_と入力します。

### 統計フィルターを使う

ネットワーク分析統計の1つと関連づけられているデータタイプに基づいて絞り込むには、統計にポインタを置くときに表示される**フィルター**ボタン、または**除外**ボタンを使います。

この例では、**フィルター**ボタンをクリックして、ビュー範囲を_許可_アクションと関連づけられるトラフィックのみに絞り込んでいます。

### 適用されたフィルターからMagic Firewallルールを作成する

ネットワーク分析で選択したフィルターと一致するトラフィックをすべてブロックする[Magic Firewall](/magic-firewall)ルールを作成できます。現在サポートされているフィルターは次のとおりです。

-   送信先IP
-   プロトコル
-   ソースデータセンター
-   ソースIP
-   TCPフラグ

その他のタイプのネットワーク分析フィルターは、新しいルールの定義に追加されません。ただし、Magic Firewallでは、ルールをさらに設定することができます。

次の操作を行ってください：

1\. ネットワーク分析で1つ以上のフィルターを適用します。

2\. **Magic Firewall ルールの作成**をクリックします。

![ネットワーク分析でファイアウォールルールリンクを作成](/images/support/hc-dash-Network_Analytics-create_firewall_rule.png)

Magic Firewall ルールエディターに、選択したフィルターと値が表示されます。

3\. Magic Firewall ルールエディターでルール定義を確認します。

4\. **新規追加**をクリックします。

### サポートされるフィルターフィールド、演算子、値 

次の表は、ネットワーク分析を絞り込むために使えるフィールド、演算子、値の範囲を示しています。

| フィールド | 演算子 | 値 |
| --- | --- | --- |
| 
アクション

 | 

等号

不等号

 | 

\- 許可：Cloudflareの自動DDoS攻撃対策システムで許可されるトラフィックです。ファイアウォールルール、flowtrackd（フロートラッキングデーモン）、L7ルールで軽減されたトラフィックを含むことがあります。

\- ブロック：Cloudflareの自動DDoS攻撃対策システムでブロックされたトラフィックです。

\- 接続追跡：Magic Transitがスコープから外され、Magic Transit プレフィックスに対して、conntrackが実行されないため、L7のみで適用されます。

\- レート制限：送信元IP、サブネット、またはどの接続でもそれぞれに適用できます。ヒューリスティック（経験則）に基づき、プログラムによって決定されます。

\- モニタリング：攻撃の内、特定されてはいるものの、観察するのみで、どのルールでも軽減しないと決めたものが対象となります。

 |
| 

攻撃ID

 | 

等号

不等号

 | 

攻撃番号

 |
| 

攻撃タイプ

 | 

等号

不等号

 | 

UDPフラッド

SYNフラッド

ACKフラッド攻撃

RSTフラッド

LDAPフラッド

クリスマスフラッド

FINフラッド

GREフラッド

ICMPフラッド

 |
| 

送信先IP

 | 

等号

不等号

 | 

IPアドレス

 |
| 

送信先ポート

 | 

等号

不等号

次より大きい

次より大きい/等号

次より小さい

次より小さい/等号

 | 

ポート番号

ポート範囲

 |
| 

送信先IPの範囲

 | 

等号

不等号

 | 

IPの範囲＆マスク

 |
| 

IPバージョン

 | 

等号

不等号

 | 

4または6

 |
| 

プロトコル

 | 

等号

不等号

 | 

TCP

UDP

ICMP

GRE

 |
| 

ソースASN

 | 

等号

不等号

 | 

AS番号

 |
| 

送信元の国

 | 

等号

不等号

 | 

国名

 |
| 

ソースデータセンター

 | 

等号

不等号

 | 

データセンターの場所

 |
| 

ソースIP

 | 

等号

不等号

 | 

IPアドレス

 |
| 

ソースポート

 | 

等号

不等号

次より大きい

次より大きい/等号

次より小さい

次より小さい/等号

 | 

ポート番号

ポート範囲

 |
| 

TCPフラグ

 | 

等号

不等号

次を含む

 | 

SYN、SYN-ACK、FIN、ACK、RST

 |

___

## プロットする範囲を選択する

様々な範囲でネットワーク分析データをプロットできます。デフォルトで、ネットワーク分析はアクションごとにデータを分類して表示します。

**サマリー**タブの1つを選択すると、別のディメンションでデータを表示できます。

![多元的にデータをビジュアル化](/images/support/unnamed__1_.gif)

次のオプションから選ぶことができます。

-   アクション
-   攻撃タイプ
-   送信先IP
-   送信先ポート
-   IPバージョン
-   プロトコル
-   ソースASN
-   送信元の国
-   ソースデータセンター
-   ソースIP
-   ソースポート
-   TCPフラグ

### ネットワーク分析のフィルターを共有する

ネットワーク分析ページの時間枠にフィルターを追加して特定すると、こうしたパラメーターを反映して、URLが変わります。

データ表示を共有するには、URLをコピーして、他のユーザーに送信します。そうすると、同じビューで作業ができるようになります。

![ネットワーク分析ページのURLを選択](/images/support/hc-dashboard-network-analytics-6.png)

___

## アクテビティログを表示する

ネットワーク分析の**アクティビティログ**は、現在選択されている時間枠で最大500件のログを表示します。結果は、時間枠ビューごとに1ページあたり10件ずつ表示されます。（[GraphQL API分析](/analytics/graphql-api/)には、この制限がありません。） 

イベントの詳細を表示するには、イベントに関連する拡張ウィジェットをクリックします。

### 列を構成する

アクティビティログに表示する列を設定するには、**列を編集する**ボタンをクリックしてください。 

これは、DDoS 攻撃を特定したいときに、非常に便利です。IP アドレス、最大ビットレート、攻撃IDなど、使いたい属性を指定することができます。

### トップ項目を表示する

**送信元の国**、**送信元**、**宛先**パネルで、各ビューの上位項目を表示します。

表示する項目数を選ぶには、ビューに関連するドロップダウンリストを使います。

上位データセンターを表示するには、**送信元の国**ビューのドロップダウンリストから_データセンター_を選択してください。**送信元の国**ビューから、**送信元データセンター**ビューに切り替わります。

___

## ログデータとレポートをエクスポートする

### アクティビティログデータをエクスポートする

アクテビティログから、一度に最大500件の未加工のイベントをエクスポートできます。このオプションは、セキュリティ情報およびイベント管理（SIEM）などの別のシステムまたはデータベースで保存されるデータと、Cloudflareのデータを組み合わせて分析する必要がある場合に便利です。

ログデータをエクスポートするには、**エクスポート**をクリックしてください。

エクスポートしたデータをレンダリングするために、CVSフォーマットか、JSONフォーマットのどちらかを選択します。次のパターンを使って、ダウンロードしたファイル名に選択した時間枠を反映させます。

_network-analytics-attacks-\[start time\]-\[end time\].json_

### ネットワーク分析レポートをエクスポートする

**ネットワーク分析**からスナップショットレポートを印刷する、またはダウンロードするには、次の手順に従ってください。

**レポートを印刷する**をクリックします。Webブラウザの印刷インターフェースに、印刷するか、PDFとして保存するかのオプションが表示されます。

___

## 制限事項

現在、ネットワーク分析には次のような制限があります。

-   ネットワーク分析 v1は、[サービス拒否デーモン（dosd）](https://blog.cloudflare.com/who-ddosd-austin/)攻撃に関するインサイトを提供します。データのタイムリーなビューを提供しますが、すべてのイベントの完全なビューがあるわけではありません。 
-   次のデータソースはネットワーク分析 v1では入手できません。
    -   ファイアウォールルール_（ネットワーク分析 v1で利用可能）_
    -   アプリケーション層のルール
    -   Gatekeeperと手動で適用されたルール
    -   [Flowtrackd](https://blog.cloudflare.com/announcing-flowtrackd/) （高度なTCP 保護）_（ネットワーク分析 v2で利用可能）_
    -   WARPトラフィックと[オレンジ色の雲](https://support.cloudflare.com/hc/ja/articles/205177068)のトラフィック ）
-   CDNなど、トラフィックをプロキシするCloudflareサービスからのデータはネットワーク分析では利用できません。

___

## 関連リソース

-   [Cloudflareネットワーク分析 v2](/analytics/network-analytics/)
-   [ネットワーク分析 v1 からネットワーク分析 v2 への移行](/analytics/graphql-api/migration-guides/network-analytics-v2)
-   [CloudflareのGraphQL API](/analytics/graphql-api/)
-   [Cloudflareの分析：簡単な概要](https://support.cloudflare.com/hc/articles/360037684111)
-   [IANAポート番号とサービス名](https://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xhtml?&page=1)

___

## よくある質問

### Cloudflareは、ネットワーク分析ポータルにどのぐらいの期間、データを保持するのか

ネットワーク分析 v2（NAv2）を使用する場合、クエリできる履歴データの範囲は**90日間**です。

ネットワーク分析 v1（NAv1）は、GraphQLノードを使って、１分、1時間、１日のIPフローにデータをロールアップします。たとえば、ipFlows1mGroupsノードは、分単位の集約でデータを保存します。

NAv1 でクエリできる履歴データの範囲の確認については、こちらの表を参照してください。保存期間のインジケーターとして、_**notOlderThan**_（次の期間より新しい）列を使います。

| 
GraphQLデータ ノード

 | 

maxDuration\*

 | 

notOlderThan\*\*

 | 

ネットワーク分析における時間範囲の選択

 | 

データポイント数

 |
| --- | --- | --- | --- | --- |
| 

ipFlows1mGroups

 | 

25時間

 | 

30日間

 | 

30分

 | 

30

 |
| 

6時間

 | 

71

 |
| 

12時間

 | 

48

 |
| 

24時間

 | 

96

 |
| 

ipFlows1dGroups

 | 

6か月間

 | 

1年間

 | 

1週間

 | 

168

 |
| 

1か月

 | 

30

 |

_**\*maxDuration**__（最長期間）は、一回のクエリでリクエストできるタイムウィンドウを定義します（データノードによって異なります）。_

_**\*\*notOlderThan**__は、クエリがレコードでさかのぼって検索できる期間を制限します。これは、当社のデータベースに残っている期間を示しています。_

ダッシュボードで攻撃ログで作業をする場合、次のことに気をつけてください。

-   攻撃ログには、開始タイムスタンプと終了タイムスタンプ、パケット/ビット統計の最小値、最大値、平均値、合計値、攻撃タイプ、実行されたアクションが保存されます。
-   ソースIP アドレスは、個人を特定できる情報と見なされます。そのため、Cloudflareは、30日間しか保存しません。30日を過ぎると、ソースIP アドレスは破棄され、ログが1時間グループ、それから1日グループにロールアップされます。1時間ロールアップは、6か月間保存されます。1日ロールアップは、1年間保存されます。

クエリとログデータへのアクセスに関する詳細については、[GraphQL分析API](/analytics/graphql-api/limits)をご参照ください。

### ネットワーク分析が、宛先IPを「利用不可」と表示する理由は？

宛先IPが_利用不可_と表示されるのは、宛先IPが当社の[DDoS攻撃対策システム](https://blog.cloudflare.com/mitigating-a-754-million-pps-ddos-attack-automatically/)で生成されるリアルタイムシグネチャに含まれていなかった場合です。

宛先IPを表示するには、**攻撃ID**でフィルター処理して、トップ項目リストで**宛先**までスクロールしてください。特定の攻撃IDでフィルター処理すると、ネットワーク分析ダッシュボード全体が攻撃レポートになります。
