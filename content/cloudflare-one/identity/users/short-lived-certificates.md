---
title: Short-lived certificates
pcx_content_type: how-to
weight: 4
meta:
  title: Configure short-lived certificates
---

# Configure short-lived certificates

Cloudflare Access can replace traditional SSH key models with short-lived certificates issued to your users based on the token generated by their Access login. In traditional models, users generate a keypair and commit their public key into an infrastructure management tool, like [Salt](https://github.com/saltstack/salt), or otherwise upload it to an administrator. These keys can remain unchanged for months or years.

Cloudflare Access removes the burden on the end user of generating a key, while also improving security of access to infrastructure with ephemeral certificates.

## 1. Secure a server behind Cloudflare Access

To protect a resource behind Cloudflare Access, first follow [these instructions](/cloudflare-one/tutorials/ssh/) to secure the server.

## 2. Ensure Unix usernames match user SSO identities

Cloudflare Access will take the identity from a token and, using short-lived certificates, authorize the user on the target infrastructure.

{{<render file="_ssh-usernames.md">}}

## 3. Generate a short-lived certificate public key

1. On the Zero Trust dashboard, navigate to **Access > Service Auth**.

2. In the dropdown, choose the application that represents the resource you secured in Step 1.

   ![New Cert](/cloudflare-one/static/documentation/applications/non-http/slc-dropdown.png)

3. Click **Generate certificate**. A row will appear with a public key scoped to your application.

4. Save the key or keep it somewhere convenient for configuring your server.
   You can return to copy this public key any time in the Service Auth dashboard.

   ![Pub Key Cert](/cloudflare-one/static/documentation/applications/non-http/slc-key.png)

## 4. Save your public key

1. Copy the public key generated from the dashboard in Step 2.

{{<render file="_ssh-public-key.md">}}

## 5. Modify your SSHD config

{{<render file="_ssh-modify-sshd.md">}}

## 6. Restart your SSH server

{{<render file="_ssh-restart-server.md">}}

## 7. Connect as a user

### Configure your client SSH config

On the client side, follow [this tutorial](/cloudflare-one/tutorials/ssh/) to configure your device to use Cloudflare Access to reach the protected machine. To use short-lived certificates, you must include the following settings in your SSH config file.

To save time, you can use the following cloudflared command to print the required configuration command:

```sh
cloudflared access ssh-config --hostname vm.example.com --short-lived-cert
```

If you prefer to configure manually, these are the required commands:

```bash
Host vm.example.com
    ProxyCommand bash -c '/usr/local/bin/cloudflared access ssh-gen --hostname %h; ssh -tt %r@cfpipe-vm.example.com >&2 <&1'
```

```bash
Host cfpipe-vm.example.com
    HostName vm.example.com
    ProxyCommand /usr/local/bin/cloudflared access ssh --hostname %h
    IdentityFile ~/.cloudflared/vm.example.com-cf_key
    CertificateFile ~/.cloudflared/vm.example.com-cf_key-cert.pub
```

### Connect through a browser-based terminal

End users can connect to the SSH session without any configuration by using Cloudflare's browser-based terminal. Users visit the URL of the application and Cloudflare's terminal handles the short-lived certificate flow. To enable, follow the instructions [here](/cloudflare-one/tutorials/ssh-browser/).

Your SSH server is now protected behind Cloudflare Access â€” users will be prompted to authenticate with your identity provider before they can connect. You can also enable SSH command logging by configuring a [Gateway Audit SSH policy](/cloudflare-one/policies/filtering/network-policies/ssh-logging).
