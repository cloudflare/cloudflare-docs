---
pcx-content-type: how-to
title: Use curl to query the Analytics API
weight: 61
---

# Use curl to query the Analytics API

You can submit a [query built with the GraphiQL client](/analytics/graphql-api/getting-started/compose-graphql-query/) as the payload in the `data` field of a POST request to the Analytics API.

The advantage of executing a request with [curl](https://curl.se/) is that you can redirect the response to a file and execute other post processing methods.

The GraphQL endpoint requires valid JSON, so you must pass the query as the `value` part of a JSON `key:value` pair with a key named `query`.

Pass the list of variables in another JSON `key:value` pair with a key named `variables`.

The script below returns the firewall events in one zone over the last 24 hours:
{{<raw>}}<pre class="CodeBlock CodeBlock-with-rows CodeBlock-scrolls-horizontally CodeBlock-is-light-in-light-theme CodeBlock--language-bash" language="bash"><span class="CodeBlock--header">Example bash script that uses curl to query Analytics API</span><code><span class="CodeBlock--rows"><span class="CodeBlock--rows-content"><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-shebang CodeBlock--token-important">#!/bin/bash</span><span class="CodeBlock--token-plain">
</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-comment">#</span><span class="CodeBlock--token-plain">
</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-comment"># This script fetches the last 24 hours of firewall events for the ZoneID passed</span><span class="CodeBlock--token-plain">
</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-comment"># in as the first parameter using the global key passed in as the second parameter.</span><span class="CodeBlock--token-plain">
</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-comment">######################################################################################</span><span class="CodeBlock--token-plain">
</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">
</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-assign-left CodeBlock--token-variable">ZoneID</span><span class="CodeBlock--token-operator">=</span><span class="CodeBlock--token-string">&quot;</span><span class="CodeBlock--token-string CodeBlock--token-variable">$1</span><span class="CodeBlock--token-string">&quot;</span><span class="CodeBlock--token-plain">
</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-assign-left CodeBlock--token-variable">global_key</span><span class="CodeBlock--token-operator">=</span><span class="CodeBlock--token-string">&quot;</span><span class="CodeBlock--token-string CodeBlock--token-variable">$2</span><span class="CodeBlock--token-string">&quot;</span><span class="CodeBlock--token-plain">
</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-assign-left CodeBlock--token-variable">Email</span><span class="CodeBlock--token-operator">=</span><span class="CodeBlock--token-string">&quot;user@domain.com&quot;</span><span class="CodeBlock--token-plain">
</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-comment">#</span><span class="CodeBlock--token-plain">
</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-comment"># Calculate 24 hours back and produce the start and end times in the appropriate format.</span><span class="CodeBlock--token-plain">
</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-assign-left CodeBlock--token-variable">back_seconds</span><span class="CodeBlock--token-operator">=</span><span class="CodeBlock--token-number">60</span><span class="CodeBlock--token-plain">*60*24  </span><span class="CodeBlock--token-comment"># 24 hours</span><span class="CodeBlock--token-plain">
</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-assign-left CodeBlock--token-variable">end_epoch</span><span class="CodeBlock--token-operator">=</span><span class="CodeBlock--token-variable CodeBlock--token-variable">$(</span><span class="CodeBlock--token-variable CodeBlock--token-function">date</span><span class="CodeBlock--token-variable"> +</span><span class="CodeBlock--token-variable CodeBlock--token-string">'%s'</span><span class="CodeBlock--token-variable CodeBlock--token-variable">)</span><span class="CodeBlock--token-plain">
</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-builtin CodeBlock--token-class-name">let</span><span class="CodeBlock--token-plain"> </span><span class="CodeBlock--token-assign-left CodeBlock--token-variable">start_epoch</span><span class="CodeBlock--token-operator">=</span><span class="CodeBlock--token-variable">$end_epoch</span><span class="CodeBlock--token-plain">-</span><span class="CodeBlock--token-variable">$back_seconds</span><span class="CodeBlock--token-plain">
</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-assign-left CodeBlock--token-variable">start_date</span><span class="CodeBlock--token-operator">=</span><span class="CodeBlock--token-variable CodeBlock--token-variable">$(</span><span class="CodeBlock--token-variable CodeBlock--token-function">date</span><span class="CodeBlock--token-variable"> --date</span><span class="CodeBlock--token-variable CodeBlock--token-operator">=</span><span class="CodeBlock--token-variable CodeBlock--token-string">&quot;@</span><span class="CodeBlock--token-variable CodeBlock--token-string CodeBlock--token-variable">$start_epoch</span><span class="CodeBlock--token-variable CodeBlock--token-string">&quot;</span><span class="CodeBlock--token-variable"> +</span><span class="CodeBlock--token-variable CodeBlock--token-string">'%Y-%m-%dT%H:%M:%SZ'</span><span class="CodeBlock--token-variable CodeBlock--token-variable">)</span><span class="CodeBlock--token-plain">
</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-assign-left CodeBlock--token-variable">end_date</span><span class="CodeBlock--token-operator">=</span><span class="CodeBlock--token-variable CodeBlock--token-variable">$(</span><span class="CodeBlock--token-variable CodeBlock--token-function">date</span><span class="CodeBlock--token-variable"> --date</span><span class="CodeBlock--token-variable CodeBlock--token-operator">=</span><span class="CodeBlock--token-variable CodeBlock--token-string">&quot;@</span><span class="CodeBlock--token-variable CodeBlock--token-string CodeBlock--token-variable">$end_epoch</span><span class="CodeBlock--token-variable CodeBlock--token-string">&quot;</span><span class="CodeBlock--token-variable"> +</span><span class="CodeBlock--token-variable CodeBlock--token-string">'%Y-%m-%dT%H:%M:%SZ'</span><span class="CodeBlock--token-variable CodeBlock--token-variable">)</span><span class="CodeBlock--token-plain">
</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">
</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-assign-left CodeBlock--token-variable">PAYLOAD</span><span class="CodeBlock--token-operator">=</span><span class="CodeBlock--token-string">'{ &quot;query&quot;:</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-string">  &quot;query {</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-string">    viewer {</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-string">      zones(filter: { zoneTag: $zoneTag }) {</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-string">      firewallEventsAdaptive(</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-string">        filter: $filter</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-string">        limit: 10000</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-string">        orderBy: [datetime_DESC, rayName_DESC]</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-string">      ) {</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-string">          action,</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-string">          datetime,</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-string">          rayName,</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-string">          clientRequestHTTPHost,</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-string">          userAgent</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-string">        }</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-string">      }</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-string">    }</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-string">  }&quot;,'</span><span class="CodeBlock--token-plain">
</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-assign-left CodeBlock--token-variable">PAYLOAD</span><span class="CodeBlock--token-operator">=</span><span class="CodeBlock--token-string">&quot;</span><span class="CodeBlock--token-string CodeBlock--token-variable">$PAYLOAD</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-string">
</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-string">  </span><span class="CodeBlock--token-string CodeBlock--token-entity">\&quot;</span><span class="CodeBlock--token-string">variables</span><span class="CodeBlock--token-string CodeBlock--token-entity">\&quot;</span><span class="CodeBlock--token-string">: {</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-string">    </span><span class="CodeBlock--token-string CodeBlock--token-entity">\&quot;</span><span class="CodeBlock--token-string">zoneTag</span><span class="CodeBlock--token-string CodeBlock--token-entity">\&quot;</span><span class="CodeBlock--token-string">: </span><span class="CodeBlock--token-string CodeBlock--token-entity">\&quot;</span><span class="CodeBlock--token-string CodeBlock--token-variable">$ZoneID</span><span class="CodeBlock--token-string CodeBlock--token-entity">\&quot;</span><span class="CodeBlock--token-string">,</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-string">    </span><span class="CodeBlock--token-string CodeBlock--token-entity">\&quot;</span><span class="CodeBlock--token-string">filter</span><span class="CodeBlock--token-string CodeBlock--token-entity">\&quot;</span><span class="CodeBlock--token-string">: {</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-string">      </span><span class="CodeBlock--token-string CodeBlock--token-entity">\&quot;</span><span class="CodeBlock--token-string">datetime_gt</span><span class="CodeBlock--token-string CodeBlock--token-entity">\&quot;</span><span class="CodeBlock--token-string">: </span><span class="CodeBlock--token-string CodeBlock--token-entity">\&quot;</span><span class="CodeBlock--token-string CodeBlock--token-variable">$start_date</span><span class="CodeBlock--token-string CodeBlock--token-entity">\&quot;</span><span class="CodeBlock--token-string">,</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-string">      </span><span class="CodeBlock--token-string CodeBlock--token-entity">\&quot;</span><span class="CodeBlock--token-string">datetime_leq</span><span class="CodeBlock--token-string CodeBlock--token-entity">\&quot;</span><span class="CodeBlock--token-string">: </span><span class="CodeBlock--token-string CodeBlock--token-entity">\&quot;</span><span class="CodeBlock--token-string CodeBlock--token-variable">$end_date</span><span class="CodeBlock--token-string CodeBlock--token-entity">\&quot;</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-string">    }</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-string">  }</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-string">}&quot;</span><span class="CodeBlock--token-plain">
</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">
</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-comment"># Run query to GraphQL API endpoint</span><span class="CodeBlock--token-plain">
</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-plain">
</span></div></span><span class="CodeBlock--row"><span class="CodeBlock--row-indicator"></span><div class="CodeBlock--row-content"><span class="CodeBlock--token-function">curl</span><span class="CodeBlock--token-plain"> -s -X POST -H </span><span class="CodeBlock--token-string">&quot;Content-Type: application/json&quot;</span><span class="CodeBlock--token-plain"> -H </span><span class="CodeBlock--token-string">&quot;X-Auth-Email: </span><span class="CodeBlock--token-string CodeBlock--token-variable">$Email</span><span class="CodeBlock--token-string">&quot;</span><span class="CodeBlock--token-plain"> -H  </span><span class="CodeBlock--token-string">&quot;X-Auth-Key: </span><span class="CodeBlock--token-string CodeBlock--token-variable">$global_key</span><span class="CodeBlock--token-string">&quot;</span><span class="CodeBlock--token-plain"> --data </span><span class="CodeBlock--token-string">&quot;</span><span class="CodeBlock--token-string CodeBlock--token-variable CodeBlock--token-variable">$(</span><span class="CodeBlock--token-string CodeBlock--token-variable CodeBlock--token-builtin CodeBlock--token-class-name">echo</span><span class="CodeBlock--token-string CodeBlock--token-variable"> $PAYLOAD</span><span class="CodeBlock--token-string CodeBlock--token-variable CodeBlock--token-variable">)</span><span class="CodeBlock--token-string">&quot;</span><span class="CodeBlock--token-plain"> https://api.cloudflare.com/client/v4/graphql/</span></div></span></span></span></code></pre>{{</raw>}}
