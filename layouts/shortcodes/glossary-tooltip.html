{{- $id := .Get "term_id" -}}
{{- $length := "short" -}}
{{- $prepend := .Get "prepend" -}}
{{- $text := .Inner -}}

{{- $glossaryDefinition := partial "glossary-definition.html" (dict "id" $id "length" $length "prepend" $prepend) -}}

{{- $definition := $glossaryDefinition | $.Page.RenderString -}}
{{- if not (in $definition "<p>")}}
{{- $definition = (printf "<p>%s</p>" $definition) | safeHTML }}
{{- end -}}

{{- $tooltip := $definition | replaceRE "(?s)<span class='glossary-tooltip'.*?>(.*?).*</span>" "$1" -}}
{{- $tooltip := trim $tooltip " \n" -}}
<span class='glossary-tooltip' title='{{- $tooltip | safeHTML -}}' data-toggle='tooltip' data-placement='top' aria-label='{{ $text }}'>
{{- $text -}}
</span>