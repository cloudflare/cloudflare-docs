{{- $dataArray := slice }}
{{- $availableOptions := slice -}}

{{- range readDir "./data/" -}}
{{- if in .Name ".yml"}}
{{- $productName :=  replace .Name ".yml" "" -}}
{{ $dataArray = $dataArray | append (index $.Site.Data $productName) }}
{{- end -}}
{{- end -}}

{{- range $dataArray -}}
{{- with .product.group -}}
{{ $availableOptions = $availableOptions | append . }}
{{- end -}}
{{- end -}}
{{- $availableOptions = $availableOptions | uniq | sort -}}

<style>
  .ProductGrid--content {
    --n: 1;
    display: grid;
    flex-direction: column;
    grid-template-columns: repeat(var(--n), 1fr);
    gap: 5px;
    padding-bottom: 1em;
    border-bottom: 1px solid gray;
  }

  .ProductGrid--title {
    font-size: 1.3em;
    font-weight: 600;
    margin: 1.2em 0;
  }

  @media screen and (min-width: 600px) {
    .ProductGrid--content {
      --n: 2;
    }
  }

  @media screen and (min-width: 978px) {
    .ProductGrid--content {
      --n: 3;
    }
  }

  @media screen and (min-width: 1200px) {
    .ProductGrid--content {
      --n: 4;
    }
  }
</style>

<div class="ProductGrid">
  <div id="ProductGrid--range">
  {{- range $availableOptions -}}
  {{- $currentOption := . }}
  <div class="ProductGrid--title">
    <span>{{$currentOption}}</span>
  </div>
  <div class="ProductGrid--content">
    {{- range $dataArray -}} 
      {{- if eq $currentOption .product.group -}}
        {{- $product := .product -}} 
        {{- $wrap := default false $product.wrap -}}
        <a
          class="ProductGrid--link"
          data-wrap-title="{{ $wrap }}"
          href="{{ $product.url }}"
        >
          <div>{{ safeHTML .logo }}</div>
          <span>{{ $product.title }}</span>
        </a>
        {{- end -}}
      {{- end -}}
  </div>
  {{- end -}}
</div>
</div>

<script>
  function filterProducts() {
    // Search input and items
    var input = document.getElementById("search"); // User input
    var query = input.value.toUpperCase(); // Make input non-case sensitive
    var grid = document.getElementById("ProductGrid--range"); // Convert Hugo range to JS
    var items = grid.getElementsByTagName("a"); // Extract tiles

    // TODO: Search by URL, description (i.e. "cloudflare one" = Cloudflare Zero Trust)

    // Iterate through products
    for (var i = 0; i < items.length; i++) {
      var item = items[i];
      var text = item.innerText.toUpperCase();
      if (text.indexOf(query) > -1) {
        item.style.display = "";
      } else {
        item.style.display = "none";
      }
    }
  }
</script>
